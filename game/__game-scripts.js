var Timer={_timers:[],_timercounter:0,addTimer:function(q,e,a,t){const n="t_"+this._timercounter;return Timer._timers[n]={time:q,callback:e,scope:a,once:t,__elapsedTime:0},Timer._timercounter++,n},addTimerManually:function(q){const e="t_"+this._timercounter;return Timer._timers[e]={time:q||0,__elapsedTime:0},Timer._timercounter++,e},checkElapsed:function(q){const e=this._timers[q];return!!(e.time&&e.__elapsedTime>=e.time)&&(e.__elapsedTime=0,!0)},destroyTimer:function(q){return delete this._timers[q],null},clearAllTimers:function(){for(let q in this._timers)this.destroyTimer(q);this._timers=[],Timer._timercounter=0},evaluateTimers:function(q){for(let a in this._timers){var e=this._timers[a];e.__elapsedTime+=q,e.time&&e.__elapsedTime>=e.time&&(e.callback.call(e.scope),e.once?this.destroyTimer(a):e.__elapsedTime=0)}}};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(q,e){function s(q,e){for(var a in e)try{q.style[a]=e[a]}catch(q){}return q}function H(q){return null==q?String(q):"object"==typeof q||"function"==typeof q?Object.prototype.toString.call(q).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof q}function R(q,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(q);for(var a=0,t=e.length;a<t;a++)if(e[a]===q)return a;return-1}function I(){var q,e=arguments;for(q in e[1])if(e[1].hasOwnProperty(q))switch(H(e[1][q])){case"object":e[0][q]=I({},e[0][q],e[1][q]);break;case"array":e[0][q]=e[1][q].slice(0);break;default:e[0][q]=e[1][q]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(q){return 1===(q=Math.round(255*q).toString(16)).length?"0"+q:q}function S(q,e,a,t){q.addEventListener?q[t?"removeEventListener":"addEventListener"](e,a,!1):q.attachEvent&&q[t?"detachEvent":"attachEvent"]("on"+e,a)}function D(q,e){function g(q,e,a,t){return A[0|q][Math.round(Math.min((e-a)/(t-a)*Y,Y))]}function r(){B.legend.fps!==L&&(B.legend.fps=L,B.legend[l]=L?"FPS":"ms"),h=L?w.fps:w.duration,B.count[l]=999<h?"999+":h.toFixed(99<h?0:C.decimals)}function m(){for(o=a(),Q<o-C.threshold&&(w.fps-=w.fps/Math.max(1,60*C.smoothing/C.interval),w.duration=1e3/w.fps),f=C.history;f--;)v[f]=0===f?w.fps:v[f-1],F[f]=0===f?w.duration:F[f-1];if(r(),C.heat){if(b.length)for(f=b.length;f--;)b[f].el.style[t[b[f].name].heatOn]=L?g(t[b[f].name].heatmap,w.fps,0,C.maxFps):g(t[b[f].name].heatmap,w.duration,C.threshold,0);if(B.graph&&t.column.heatOn)for(f=E.length;f--;)E[f].style[t.column.heatOn]=L?g(t.column.heatmap,v[f],0,C.maxFps):g(t.column.heatmap,F[f],C.threshold,0)}if(B.graph)for(y=0;y<C.history;y++)E[y].style.height=(L?v[y]?Math.round(d/C.maxFps*Math.min(v[y],C.maxFps)):0:F[y]?Math.round(d/C.threshold*Math.min(F[y],C.threshold)):0)+"px"}function k(){20>C.interval?(c=i(k),m()):(c=setTimeout(k,C.interval),M=i(m))}function G(q){(q=q||window.event).preventDefault?(q.preventDefault(),q.stopPropagation()):(q.returnValue=!1,q.cancelBubble=!0),w.toggle()}function U(){C.toggleOn&&S(B.container,C.toggleOn,G,1),q.removeChild(B.container)}function V(){if(B.container&&U(),t=D.theme[C.theme],!(A=t.compiledHeatmaps||[]).length&&t.heatmaps.length){for(y=0;y<t.heatmaps.length;y++)for(A[y]=[],f=0;f<=Y;f++){var e,a=A[y],n=f;e=.33/Y*f;var i=t.heatmaps[y].saturation,o=t.heatmaps[y].lightness,c=void 0,l=void 0,u=void 0,p=u=void 0,M=c=l=void 0;M=void 0;0===(u=.5>=o?o*(1+i):o+i-o*i)?e="#000":(l=(u-(p=2*o-u))/u,M=(e*=6)-(c=Math.floor(e)),M*=u*l,0===c||6===c?(c=u,l=p+M,u=p):1===c?(c=u-M,l=u,u=p):2===c?(c=p,l=u,u=p+M):3===c?(c=p,l=u-M):4===c?(c=p+M,l=p):(c=u,l=p,u-=M),e="#"+N(c)+N(l)+N(u)),a[n]=e}t.compiledHeatmaps=A}for(var h in B.container=s(document.createElement("div"),t.container),B.count=B.container.appendChild(s(document.createElement("div"),t.count)),B.legend=B.container.appendChild(s(document.createElement("div"),t.legend)),B.graph=C.graph?B.container.appendChild(s(document.createElement("div"),t.graph)):0,b.length=0,B)B[h]&&t[h].heatOn&&b.push({name:h,el:B[h]});if(E.length=0,B.graph)for(B.graph.style.width=C.history*t.column.width+(C.history-1)*t.column.spacing+"px",f=0;f<C.history;f++)E[f]=B.graph.appendChild(s(document.createElement("div"),t.column)),E[f].style.position="absolute",E[f].style.bottom=0,E[f].style.right=f*t.column.width+f*t.column.spacing+"px",E[f].style.width=t.column.width+"px",E[f].style.height="0px";s(B.container,C),r(),q.appendChild(B.container),B.graph&&(d=B.graph.clientHeight),C.toggleOn&&("click"===C.toggleOn&&(B.container.style.cursor="pointer"),S(B.container,C.toggleOn,G))}"object"===H(q)&&undefined===q.nodeType&&(e=q,q=document.body),q||(q=document.body);var t,A,o,c,M,d,h,f,y,w=this,C=I({},D.defaults,e||{}),B={},E=[],Y=100,b=[],T=C.threshold,x=0,Q=a()-T,v=[],F=[],L="fps"===C.show;w.options=C,w.fps=0,w.duration=0,w.isPaused=0,w.tickStart=function(){x=a()},w.tick=async function(){o=a(),T+=(o-Q-T)/C.smoothing,w.fps=1e3/T,w.duration=x<Q?T:o-x,Q=o},w.pause=function(){return c&&(w.isPaused=1,clearTimeout(c),n(c),n(M),c=M=0),w},w.resume=function(){return c||(w.isPaused=0,k()),w},w.set=function(q,e){return C[q]=e,L="fps"===C.show,-1!==R(q,u)&&V(),-1!==R(q,p)&&s(B.container,C),w},w.showDuration=function(){return w.set("show","ms"),w},w.showFps=function(){return w.set("show","fps"),w},w.toggle=function(){return w.set("show",L?"ms":"fps"),w},w.hide=function(){return w.pause(),B.container.style.display="none",w},w.show=function(){return w.resume(),B.container.style.display="block",w},w.destroy=function(){w.pause(),U(),w.tick=w.tickStart=function(){}},V(),k()}var a,t=q.performance;a=t&&(t.now||t.webkitNow)?t[t.now?"now":"webkitNow"].bind(t):function(){return+new Date};for(var n=q.cancelAnimationFrame||q.cancelRequestAnimationFrame,i=q.requestAnimationFrame,A=0,o=0,c=(t=["moz","webkit","o"]).length;o<c&&!n;++o)i=(n=q[t[o]+"CancelAnimationFrame"]||q[t[o]+"CancelRequestAnimationFrame"])&&q[t[o]+"RequestAnimationFrame"];n||(i=function(e){var t=a(),n=Math.max(0,16-(t-A));return A=t+n,q.setTimeout((function(){e(t+n)}),n)},n=function(q){clearTimeout(q)});var l="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],p="position zIndex left top right bottom margin".split(" ")}(window),function(q,e){e.theme={};var a=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},a,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},a,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},a,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},a,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var TracerScript={linesValues:{},div:null,divValues:null,timer:null,__tracer_busy:!1},GameManager=pc.createScript("gameManager");function onYouTubeIframeAPIReady(){GameManager.backgroundMusicYTPlayer=new YT.Player("backgroundMusicYTPlayer",{height:"0",width:"0",videoId:"M7lc1UVf-VE",events:{}})}async function Trace(q,e){TracerScript&&TracerScript.print(q,e)}async function Tracer(q,e){TracerScript&&TracerScript.print(q,e)}function uiGameMainMenuCircularHTML(){return'\n\n<style type="text/css">\n    *:not(canvas) {\n        transition: all 0.3s ease-in-out;\n        outline: none;\n    }\n\n    html,\n    body {\n        background-color: black;\n        color: white;\n        margin: 0;\n        padding: 0;\n    }\n\n\n    /************************************************/\n    .fade-out {\n        opacity: 0;\n        transition: opacity 1s ease-in-out;\n    }\n\n    /************************************************/\n    .menu-center {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        position: absolute;\n        top: 0px;\n        left: 0px;\n        right: 0px;\n        bottom: 0px;\n    }\n\n    .menu {\n        color: white;\n        background-color: rgb(1, 1, 1);\n        /* Color de fondo del menú */\n        padding: 20px;\n        border-radius: 8px;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n        /* Sombra opcional */\n        text-align: center;\n        max-width: 80%;\n        /* Ancho máximo del menú para evitar que sea demasiado ancho en pantallas grandes */\n        border: 2px solid rgb(4, 4, 4);\n    }\n\n    .menu h1 {\n        margin-bottom: 20px;\n    }\n\n    .menu ul {\n        list-style-type: none;\n        padding: 0;\n    }\n\n    .menu ul li {\n        margin-bottom: 10px;\n    }\n\n    .menu ul li a {\n        text-decoration: none;\n        color: #6f6f6f;\n        /* Color del texto de las opciones */\n        font-weight: bold;\n        font-size: 18px;\n\n    }\n\n    .menu ul li a:hover {\n        color: #007bff;\n        /* Cambia el color al pasar el mouse por encima */\n    }\n</style>\n\n\n<style type="text/css">\n    .circular-menu {\n        font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "STHeitiSC-Light", "Microsoft YaHei", Arial, sans-serif;\n        /*z-index: 1040;*/\n        border-radius: 50%;\n        background: transparent;\n        opacity: 0;\n        position: fixed;\n        display: none;\n        cursor: default;\n        transform: scale(0.1);\n        pointer-events: none;\n        overflow: hidden;\n        /*cover to prevent extra space of anchors from being clickable*/\n    }\n\n\n    .circular-menu.circular-sub-menu {\n        /*transition: all 0s ease 0s;*/\n    }\n\n\n    .circular-menu.circular-sub-menu:after {\n        display: none;\n    }\n\n\n    .circular-menu:after {\n        content: ".";\n        display: block;\n        position: absolute;\n        left: 50%;\n        top: 50%;\n        border-radius: 50%;\n        z-index: 10;\n        color: transparent;\n        box-sizing: border-box;\n    }\n\n\n    .circular-menu.opened-nav {\n        opacity: 1;\n        transform: scale(1);\n        pointer-events: auto;\n    }\n\n    .circular-menu.opened-nav li {\n        pointer-events: none;\n    }\n\n    .circular-menu.opened-nav li a {\n        pointer-events: auto;\n    }\n\n    .circular-menu.opened-nav li a .horizontal {\n        pointer-events: none;\n    }\n\n    .circular-menu ul {\n        box-sizing: border-box;\n        margin: 0;\n        padding: 0;\n        list-style: none;\n    }\n\n    .circular-menu ul li {\n        box-sizing: border-box;\n        margin: 0;\n        padding: 0;\n        position: absolute;\n        overflow: hidden;\n        border: 1px solid transparent;\n        transform-origin: 100% 100%;\n    }\n\n    .circular-menu ul li a {\n        box-sizing: border-box;\n        position: absolute;\n        display: block;\n        border-radius: 50%;\n        cursor: pointer;\n        color: #fff;\n        padding-top: 10px;\n        text-align: center;\n        text-decoration: none;\n        backface-visibility: hidden;\n    }\n\n    .circular-menu ul li a span.cm-icon {\n        display: inline-block;\n        background-size: cover;\n    }\n\n\n    .circular-menu ul li a span.text {\n        display: block;\n        font-size: 13px;\n        line-height: 1;\n        position: relative;\n    }\n\n\n    .circular-menu ul li a .cn-icon:before {\n        display: table;\n    }\n\n\n    .circular-menu ul li a.disabled {\n        -webkit-filter: grayscale(100%);\n        pointer-events: none !important;\n        cursor: default;\n    }\n\n\n    .circular-menu ul li a:focus {\n        position: fixed;\n        /* fix the displacement bug in webkit browsers when using tab key */\n    }\n\n    .circle-menu-center {\n        position: absolute;\n        top: 0px;\n        left: 0px;\n        right: 0px;\n        bottom: 0px;\n        /**/\n    }\n</style>\n\n\n<style type="text/css">\n    .cn-menu1 {\n        position: absolute;\n        left: 50%;\n        top: 50%;\n    }\n\n    .cn-menu2 {\n        position: absolute;\n        left: 40%;\n        top: 50%;\n    }\n\n    .cn-menu3 {\n        position: absolute;\n        left: 60%;\n        top: 50%;\n    }\n\n    .cn-menu4 {\n        position: absolute;\n        left: 80%;\n        top: 50%;\n    }\n\n    .rect-icon {\n        background: #fff;\n        display: inline-block !important;\n    }\n\n    .circle-icon {\n        background: #f94321;\n        display: inline-block !important;\n        border-radius: 50%;\n    }\n\n    .my-icon {\n        /* background: url("./images/circular-menu.png");*/\n    }\n\n    .icon1 {\n        background-position: 0 0;\n    }\n\n    .icon2 {\n        background-position: 0 -56px;\n    }\n\n    .icon3 {\n        background-position: 0 -116px;\n    }\n</style>\n\n<style type="text/css">\n    .MusicYTPlayer {\n        display: none;\n    }\n</style>\n\n    <div class="circle-menu-center" tabindex="-1">\n        <div id="circle-menu1" class="cn-menu1" tabindex="-1"></div>\n    </div>\n\n\n    <audio id="audio-menu-hover" class="MusicYTPlayer" tabindex="-1">\n    <source src="data:audio/mp3;base64,//vgRAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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sxs6BJWY4FBCcY8JmAjg4JAobDCUw0ECgaFgYMBxIRAQMFQYvuXoFgYtigiS3SsRKQDIMqaKjTBSqYSzhf6vkvWYOWp5dS0VHmvuc2rWmYtAe5tWHN1cdqLEm4vo1tvWHNxdt+F3ODAENva/0Ax2DHmd12n1gpqTut1hh/3Vf6IzUFxSGYaguHIu7r7ROgkEPQzGI24N2KzUce59Y5PyG/ZhrK3elV29nSyq9lj++VZmzV3rlNTbq4UvLWuY6q/q1vnaXn5/v8sv5WvirLN001HLrLUiEAKEQA2FQDoLAPpgB4JcYEYNMmH7jqZhF4UAYlOJMHCEWnx80I7gYw8C+mEmgWBgpgDOeiSCX6Z+ImBjo6IJoxqpxo57xFzHWV6nYlLnRpNR5FuOKqoth47GjiG7oXMmqiOX8fU9+VERKP2sWhPuqVajk1VZDWnVfPcfdN0Oqv6h7++t8eG4ie5Gn////9NVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQaAAEwAMUAAIsARhACIHAXZgiQISYn2B1GDwgghgeYj8Y4/+//74kQSD/OeOz6D/BqgcQfH0H+DVBEc+vQP9MqCoSRdwf4ZiGGTzhVR37zmYXEYiQJg0lEAnBAKEgAUAJT1sFntYcKZr8YvkekizTQqa1ZjNZ37ZIM2mph2lKHkqX1Re+kHnMju4PeEwVLAnXFUMm0aVe+kwAkAKipQADEwBSHAMxgOwAeYJqFfGGeAXxhgwOeYUcPImJ+fX5xfwc+ej4BnR+mVUoYkL5gUXDoPQvGgSv6Epm8nhASZwvMoX/vTzwAs2xYmksht0iNW5zORGfz+n9Miz6syM8hugj5uo4sjbXsAN6pIo6QAAwJAEzAAgDIwB0CZMBuCVjH1wwIwD4DbHg2UzQH/IMp2BWjzEnTUgNDKUFzFwDDDsDTBwEDAQCEE8QrwbC1YA4fC9y0v035L1UPpaCmWSx2+EQSUHO15RfM1tyP6vuG3S562iYOinqcSRlpN3UuBa2O2fXLMWGA2SADYCnmjBx7s0VPvUYAIAKjIBQMgJpgAAD8YAmB2mAZBExgL4diYioW6mFLh2hj5oWAd193hni1BDRkZAGCYfKBYGEcAJp1sIG5g0aHJ5islggXEoHh4EWmkgLAZ4KcJKIFKZi9tPg3MTbOgkTImJkAIQTRs5LVm4GGQckVRJXX9hla6++QbHEHo3whVMxyNpkaopaUwylFQiUldMSmDdudlvFYkcWoUm5ChBJC7aCbfUj933ExBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqiywblgEAbCABowB8BxMCAC0DGJwRIwJICJMGcApzClO2I1iQlqPEtM04HjPolGhqBiWBggigoHk1tr0ZqOW5buSCCn4cB+I5ehh2wTAsVhsVisubDAgJFBQgMMHFTq4/rVpryxiLpxxGzBeKDaYcdXRTo3P/IHlLjVUjfr93W9hjqyvcc27dHNQEyz3/++JERg/0sT88g/xK0I5HR7B/hlwV/QjuD+UtQqOe3oH9paAn3PYYGyKQgmj0uKJAAY8AAmAUgC5gGAAUYEyAqmCWBihhfgAAYXiC5GBzjzBhjnVgdOEBJHJ+iYIcwWSJgEgGARaYMCgGAgcD2rW4Gt1WHuPSfQRSIOJcrQxG5W/8vm6enlcjCCGPRAZEHSet7TxMrP8+Nq4jPGRm8Pbp32hlRHamd3X3stPPjZ9LUPDAZALYcQjURs7+zTVFAAsYAIDAJgBEAgDhgFACeYGeEUGQqgwBgKoCyYH8B1GDQ+Eh1ZhO+YBkDWGAyAN5gP4EYcC55/LMNR+ZA4IqCYAa3QISmGLCsoQyfNBZdit0vXc+rBW3fmJOrADive7gVJgXBcCdTWCoCDU1lQsSAVolYCq4lUDMhZgVNhaxfRVMhsS+LQhgyzSqKDWUQkrU1GZJ3Qp5XUKSfQ5XplFiz2ZIbm4NDHgyIUktt/b6S4QiAEyoAGGAEAGJgEIEIYCUCwmCBjLRggRE4YXgGBmLIC+pzxffadJQRAmOKhPBhNQISYLmBNHvIJ15AZsAGGBhjROj0KApd1ki201YAghTJt38catZeKJy4BVR4ZHSKIgHRQRCU9qaBoLNRWJrIhNFlCwqZSshQSRIlET8JnyTZ1Xy7opVCpO8u0rX9QtXK6u2rnW2kTQWeCrjp91J0gyvv//6////9dVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWTRERgAClJgAoAkYBIA5mBvheBjM4NkYHQCnmC0AQZi0vGwZSiVYmJTg/xgzgHKYGCAnHoYmvHExVYAurH0Bjrq4ijDW1ZfKLzbtOdqlpYhCZBKZVMyurHqUjjKIDkN7khgfW0tAiGNSaTSJUZB//viRDcP9Js+O4P6M1ByBFfAf4ZYGPke5A/xLYJLnx3B/Rmg2XXKZKZhb7LzcnUz7G07S+Ttat45uuZbLc5RgSoK3mcvc1m2/Y864E1zADAAAwBUAHMBaAJjAuwSwxQ4OBMGsAmxCJMmo9eSZngQKEcToBgRPmEy0Qi8KAgdA6V6aqZ0PyrdyibFQ3LMRIEAQ1AkHgoQS1fQgi5VG7cuXZbfv62uU8TlWkXCJQBjmNSPrvxJdcVO73///WQgCQjAITACAFQwDsB7MByBEDAkwhEwg4c6MMBGqDAhQmcxhoT2NJF5NjMBzmYy8EJdMSABCjChQGU8EUDmqTNeIAzUdDFZFBxMKgCCohLbIC3YRDamXBV3GWhKpteVvcRfUNNqs6dZFVkjO3DfV7oow+A32j8BQYVJR8za6eCMojOhMlJRSLoBGkJzE5CIyS86KlTCwsNPksmkyoRMJok1E2JB4TYo/kCBlMxZFBRKWTXpAszLUpVe3i22sFCKhKUlAMoU3/T2IYsGLKmAFgCwEASTAOwKowLoA0Mp+AgDB7QYowo8QaM5L+lThiBN4xEoE/MGHAkDA6gFM/5w5REwYFC5OaHW4ubDrSWjV4FaS+LLYxSQ9TSyM8kQYmVzjR2kgpJEFOMYkuQQ+X2yjTT+lO4aB59OORMwsqCXlvyvyaobM/t1ZOtm+dLf59k09L6LFjbv/b////spTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQaABCAANP/74kQDD/SsPrqD+0tAaaRXkH+GVg00YPINf4SCPBidgf2lkGQBIcAKQCA6GAKAmpgDIkkYs8N4GEmBTJh/AcCbwv8mmrPCYhjVoCsYTMBUmCqgLR7xeNg5pAUBBoGiqbTQl9OPGW8cqKz8DSGCnro2ux+XvQtUjEo0gUIif4bdN0Iwj4mSqQ9e1jTa0X9fNZZ8LkrF1VeVku6GqTqFe59B3bd1GVe7jTVsTOHA281sl+7+uRuqtdPgwCEADMA+ANDA7wFAxRoAuMGiA1TBKhBEw8r2hNiiIQzwlSMyqUxwSjDI5MJBYwOETAYDUgt7r8TF2GTCS0zKACA8jxkpJMvcukuU2XXeXfWS+b/JkVAKGPKpb7kdoc0jFJIf9kDMkLTmKCGjGnUZGB0gZ5iAwIiYPIBbmBTCYZjq3MaYUoCjndsAZHTJjIzA0WmGBIAQWYJAaXD/zLl0t6kl8HUt+thS7uVL+F7dXXOfjd8RLCQkNrDIDUSE5NhMwNlHGXAetE1jrq6IW6loiAAEMALAHzAGgCgwC0BrMBsBIDBDw2sxQoSNMDcBVjDFwpk0z75jMs/CQTEEgVwweECpMFAAWjqQ03w0NROzJy0EAxatrD9rCOQzsDwdEQRG5CgEBOJOmTgmJiuLSRBTU0aiZaeIPbGrqIIN7FKfuW2tCd7be1BBHL2Of3GdLkRMFBp4WE2KCrws620tqUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUwAIALAoBQKgG5gDAEUYBWBsmAPBDBga4/mZBgVhmGLh8hjaIuEeUJ5rm+zhRpmBALCYgeAPmFEAMp3URnEAsaFL5ishmBhU8Y4BGRwOwVzmmTjAH7lFNNsugJ/qGWvhTurSxF8I+ZDR1UnsiXUIdTRiy8pqdkxP9RC0xyyyEnYSlFUmTUuEH/++JEQ4/1ej44g/xLUKiIFzB/hmwWOR7gD+0tgbyTXgH+GWClKqd0gjSxfJQrpSMV7fD4ll5Vo5A8oAGSjaDpFdrY+opyTkf7P0f6TABgA8wA0AiMACAPzAHQHowFIDjMCtCBDCLhX8wmUpZMXTFajH9S+I7DDmANRwQPDKDBG0w9kHcMJCBQzsaQN2EMzWLwSRTFI4CwLZ0kmqVLdMZZadTEl3NDghXjEoG07s+yyVM1g/CUU8VlUM16s7Ka8WlZlJMCkgkEWRYnS4NMdMTK1msyZZMiepuiVlY7Ns42qppi5d4N7yZF0+2hnhduWqmeCb7vpBwACIwAAvIDgFMwGIArMCnAujBfBMcYA1TE7QqIxKUt8MjV/iDjaxI0xzYK5MJ/ByDBhgQs++oNgDRoaBgeOBBccMDR4HSaaOWqWHRKXI5EGM1WuuuQr4hxe7eNyqPqzppfJLegaBWwTc7HJt/wPXshGEfP0HiEVKrHCNRlReaA6ycbbFIqRsYiYfWlUVsKK6qlpx91Ik8jlEjWRW1eOzMfJSqebcf51K81DYhXCWwW1raCrGEAAhgDIACYBwAQGA+gHpgiAUwYVqD7GEsgihgYo0cZnj6YHA6Ao5n7VmA3EYDQoyTjCYxMIBIFAQeCS4XKed6JmY9/qSLS4hyR6lpC69M2rVU2jnyNmf9er7TjtHn9KH2PWrYsC7mEBCSc/HpMQU1FMy45OS41qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqux8wA4AWMATACzAGAEowOcBBMIKBdjGzw4QwJkC5MDcBrjPT+pIzdk4iMHFDJzARASQwFoEHMEqjD4E14kNUAAERmCAIFFg4HZOpm+7R0AyCqqiaLetDXVJH1jBeIo6hGJZ4FQMB0FpMNvQj8KW2AtWHx+dYUnmmyKWTU6LVpXGy//vgRECP9f1ItoP7Y0CW58dAf2ZmFKj43A/xK0nWlR1B/o1ouUhdVnStehJHjx69cT6oo+huvnK9pdRG8xEycShSkK7DbBbZpSjSxu9aszMV698czkD1Hn1NXS9pku0fj/9hgAYAQDAA8wAMAgMAUAOTAOwJ4wE4FfMEXHBjEiR/Aw0gN3MYyGkzh2TBU+FYYBMaxC2DCrgV0wZUC+P2czmwo0gMCw0DBMwcAaopq2vX8kbXmlxW6EBZ4KC7iJ4gJBwJZAfG4Zts7OtqcllEXVJ829mOeX2vIaWMpu0+e2bX9qj/ZePsy+4c7/ufbRwvWzaYT/9P///+hdKixIAKmANgFwCAeDAaQHIwPgASMY9D0zB5wR4wv8RCNHs6fjqqBgA7xXzb5cNSE8AiYwoLzDIcMAA1K4SABED0klaEhy6Teq7Zo05ZyuHVaO4EVe0NkzVlwoOF2QD4JRUUTesCIWQicmJFSIU6mYXcZkgJVEZkUJVq2lz4PQrWRnI6xaBDamlLxp+NJdBpZ7D4On8+0eM2iEYD9OvWpL9a7/7/7Q2JgAwiAIh4BNHgLowMwARMJpAqgEDemHwBQphVxEGYr1zHmPcHCZtf/BnE5pjijRhsWJgSORgGE4sHYsGo0CSZjzvpT09LGIDlMml9XdJdthRDmKeEA8UUJDpSZfRSNbbnhc5wvMyw4DkI4SDaT01s2POXfRVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWlNIEQAAKgEohANjAGQL0wHsQ6MSfEmjArgREwtgF2Ndz/HDcJBt879UIyaNUzJDgx4CUwlBwIBQCA0MAOyynRPfVnaAxgCdT9Rp7m3UjLZ2AoLU4YFYfhxHaFIEzjeqDE+Pmrrkh6VXhJg2sB0gpLsZdp5Yo/YNzjGqGtdrmQsPH8cFmWr//WrLNWnImL5r3uZOL7w1rr7sAGnBKAyRulc8/0Xv2XcBwA+YBEATGAigHZgTAEQYOuJymEcBaphAgF2//viRGEP9SFBtwP9YtCDJEdAf0lkI/FsyA7/ZQGzDh1B/qVQYLGKHmXTSfZ8iZUiYRAF/GBtgu5gQgGgdHmb64a9iaEmZgIk2kQ6cPPM7BINgTxQRTH3rHXxhKFocyz1pMXs0pWkn/GHn5vPCFAMFQmwEDIsJsyBTCDKVi6mOQbsd/+n/R////pMKQwMHgHAw7GvRymZp4G4UYmIKk6hpPI28ZIQN6mXUHRplR/0CeUUmCmWAjNBioQV6YgiE8GEbA+pgNYHcYEYArmfIJ616byFjhWYcnjUGZIOGgkBCLmDkoVCRGCiQqCmZE5bjZzEA8CgoyIFrhGCsgMABaUCgJMUpXKwF016jgNL0xVBUti0LFW5oGNcXkOgAYBKKuFE09ngaWuZ50ZXeboj8wNiMqf2DYBXy6Tyxx/I27b8vvk/LTYfbR85qLO83sEPDfaQ3GKvI3Vi7SHmgZ1msNFo7TSqR4Im6UxATNasqyeaIyt26SGuxaVz9i/yfkN16sdWuTuN+7l+Nukl9q5Vp8cO8u3dU2tb/DuHdct3GGBGyk+yuqU5dES0f6GUqJFUADGABIKgHIAAmDAIRZcwasLxMBlBEjCSwVsyhYUmP/VCZTqIJTRkJjJIDQwszCoCjA8ARGA7dH1iS4DTOqDiPTsRIS7lJwelU7jWvd7+zWsg0PjCTRYRLUIiZd7Ueg69V+z1deylX/6FTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVLvmMARkg6Z0cHSsZ4hkYZaKumH4iJ5g8gZSYKmJ/mMf3ah+wKkuYFKEEGAihHpgJgLgaXvmauRsauDiI0M+MhAAcDGKiDETDRYwkMEgEwYIAgoX3WSzlOlCc5SCRUCeBKBqbN4pyhKQTuFDLlIZOCsqHUM7MMsVCwDDzCmhr7pYmsG1Z3n+k8Mrxft6YpAFMk+ibL3gda++s1CGENjdSQPLZkkOum6rOYTbl7TqPGzI4TEs3dvuw+zzWIhJXnmoHpsKPdqDMYz2Qz//74kRlD/fIWDKDf9kwdgS3QH+mWFtJLM4P7Y2ByBQcwf0ZmGUDSq/rCtuWVquFLu5D8/ynv3ccPtW897ym918a1e7+697////VtSsY04M/0/toUtL9FsQEAVGAWACJgOoBYYMMJ7mF5hyJhVYPYYXqKbGhdd7B8/JOEbuVSZyoUY6F6YcjcYFBun4XwCAGXa2zLXIpnds7iT40gNgtEXhFE4mboRIGZWFwxVHYnKVblnS9ZnfFuVcuHQlDlWun5CnPlrdft/L/+yEAZWIYAWALmAFgEBgIoFyYGkCgAwaZMilDQzDngBUxPMeTMdYu1j57zzYxlYDmMKjAvjBYAGI/EGOcFzNR0Ap5lR8KiTOzBBQGGDfLCCwiAidBOnOAhNO9PeB22Q6qMoTX3Z0mHAkCOkzdaST0Zch8Lll3GeSQDwljquHceB8ehOihgbF4Oyc2JT5i+Ux2PiOYkJ4e1jImmClKZJo7pUSdMfxkyNYaRpjx5SU15ZUYXa2Krr8Ze1brUGnvOXXVyb0iY6Bda/RQ6wsLBQ2BXhUOkyEfk17rOv/7V4FlzADAAgwBEAtMBKAUDAmwOsiDMTDbxHowhkAQMJGGZDTgeaA5gMbqMMfCHTBUgPYwMcClPdoObDNk8MwaDDbaTcWjb/QiVuVJqaGQkqS8yS6TKXA5MbW+EVXrXDoM1bG5G7T+nvP0R4smR7FcW9LalUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVK1lzymANgABgEwAeYDGA4GCBA7piTYjqYUmDzGFKiaBs43pcYyiE9H/O2bPaxpBDmMTEYWCaTwOAJgkEF+U11HnNpZ5lEVmILrCj/++JEJY/0bj63A/xKwJ+IJuBz6y4RfKzcD/WLAgwUHAH+mWgHQwKA8JLaNkio6cVHEzYpJU122UP6k7i9V8nip6z10oXsdhLEnJ+02Y/1v2o5jGff/Uqj5Vmy8M/9Wyu+ndRNV3+8wSEDCAhMKiIwMPTFKYNCYkwV8D6MDbJzjEvhHsxuwnNOpn7uT0mwrsxmMJOMMEBVzB6wOAwSQB1MCvAHgEBMBYAMMAUADS71dgqJi45akjJ25tylYD0PpKJwxIjhvIAjpFkCCcIhDGogFlB03myVm6RPdR1rVdFZRRI4queTUXLulkOq+VIfJx3Vtl1Tba7fte9le2bl9fcKpGPG7WWbm7KLiAAKMAVAFTASAD4wFcC3MDSC8jELxP4wQsBxMIcDZDZC+/g1CoWuPIy/NFBcMdQ9BR8GIYEmGAJIKGB4BjwATq+2VtUtwU0OKtNia0OTAS9J4lnTTxm+dLUz12DtltOvmHsefX2zmunbQPzXl1NhtHmV1uEGipgCEj60vKE0upA6Ye3qv5dHt/S+4MACDABQCMwCAA2MBdAazAlgP4wVMYxMBSGNQEHumFVjJ5u4nQKfi+Fun2DpGz5fmbxNGR4zmLAdGF4amBIPgIHI26q7I/GoPh+1chcod2pK5mpePC8KipTXlwSRNpb2k+Zpaffmcp/MzH1uphlgKoeueU4pfWEWT1rv//+j/2f/9KpMQU1FMy45OS41qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqowBcAQEgEEHAQwQCUmBMgThgtwH+YgCG8Gbzijhj2Qs+Y4Ylnm3L/KJw7zBSYh+NAGF6Bj5gloOIbejZndPEBfDkUY6FZECw4JAkAiIAjwYBoJYsupZ7doZonhh1/a1irCHZbtBtWacx/9Pqxe7bfjPKWEsfRBK9oR5IBqvKR9E6FDJ7qqMwbahBdaVrN2ue0jrsDHQJDxO47GusraO0RCjaX1SdU58/WbzDvl//viRFYP9m5SMwP8Y2B8Q+cAb/0kFuEE0A/pjQJ0HxrB/qVol20Fne2n9ldz/fRLuv/bP9TO+u7WZWyXQKI4Uxpr/V/toLumBgRhgCZKCGhFJvMkYL8KEmEACEZhyIU4Yf2PzGjlfpx9YYj8dtTyaxqMZiF6ZBjoYcB2BQOAgAgYHgwEYfpYaiUPUcbij+Tt2AqkRmYGrY1cuyS1R553sb+vy3ln+uZ8vBomEj4hclyIu5yQ+JzhB4qmbnELQ0d7dmpqqRBgAIASYBwAoGApgMpgSgE0YQOImmGUjmZgzQASYSSLbnCbfnh8752WYPOETGASgx5gHgEoaLmahoZVqYkvBZQaKwxYFK+U4LfKVIVwY0x4mquVFHYgymHoSyyLh6AKMYwmN1y4uaTxnANQ5HxyhFs0PG1TDa8mtIa1UjLTJYLz7Lhk/AyveXQMo6IT1bv22+wflpV8uhs4hswXq8/2fivduzMutFHggWAxl9mORLHtn///+2hdAKACwEAGGAPgH5gMQDwYF6CHmFGBbJj0pI8YQOAvGFuBfB5YtH4ffKihHqvimlUNGcJ5mWBHGI4imEAmGGARGEoCiQGl7FOlb2hQC2rCYfgBmsca1AbwOxCBOJgqBQoGYdNOa9jbY4s0IDEjZVIkNpUur6MTq7MMR06yxihhPr109SXktPGuvHPk12fu3KF793aTWksAjNbX3rHJTEFNRTMuOTkuNaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqd5HtDICgBpgDQDYYBGBsmBdBipjHIn8YGOCJmFvB+xt1Ntof2aRRGKkgQJgnQC4YEyAxh4waKPmRGRkQgYSCsrZOOhKYiAZqigpepurT0qE1mcvHMRtxIB/cI5ECUMtYF1nBDXXeUH7Ua5YtiOy4rVdVD584WwFRfR9cfsdvcmYmy6kTHY4zDm/B8M81E1a9t3ulyXL7p17AtIhIqv/74kROj/VVPrQD+2NAp0e2kH9MaBWdAM4P6S2CP52agf4ZeFJ8BMcwZGomUUf///9axlgEUjAQgAQwCEATMCAAjjA2RQ0w0UabMLQBPTAiB287XbiIOYlI+jD6geYwQsDnMBGAQjNwwQqMSjMOBIQseTaRUBohQVZzFHRf122/dNpy0YZaHDocE8UPFVodFihYtNR/FisoOrh5ahxMhc+kp2OPrF65NA6d3hnj1L+H3ny9m8ra93y+xTIutNInna03c/f75oxccwawMAABYECrVNpoeBH1V9QoAFjwAMYAEAGgIBGGQAUwBEBIMEwD6TFARKEwY8E+MLNCwDRnoiA/ocEAML9B6zAhATwwEwDtOGOOASM4sNgGZOWQEIUHAh4qpIIDMyZ0pcqZmCu27NdZWtzKUvO0Bcs9DXulFIOf9vpJG3ZxzhtEGfJuQkJy8m4RJaCyiCih0UIO84oKds5pZdpRpvZx91mEjp3SsckpK/HJNK7U2s2KVvEZw04pAR7NrwIvomF9oAiIASLTiEAsMExEATHqxHoFAixgQgZcbKjFRH+Ion55ykGP2yZBKQWG4yOh4nhw/Ig6n26aQpclhjh0jG5E16KRKDn9gOceuA5NBV6pIpqHJZTyOIy2MRmal88Exai8HJTlMkp/GyBh0aXHK/ar8I0d2yaS14baZ21WEHL35JGkcdgWyjV3/5D////bRUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVFEu+BgRMHwTBw6GTITnIijGfh1HM6eHI92GMq+JRgZaI4YYWG/kANoYAwB6hUCYMAVAbzAIAC4iAWDAFwA0IADGLXkQ3/++JEIo/0kzq0g79CYICG1rB/hlwUANzQD/TLwhCVWsH9JZBN2/mXGXm4Mjdde6tkB3bAUMCMP2RQRODkWERw+g7D4wWtBpB6EVKoUbLmygb4GuzqQPubbZGZ7paknfhKGLPfWNomdEwWIJLKN1yLPXFaF1UTjAFAAMwEkAMMD2EBzEUxHkwWUEMMJPCEjV8MoQ+500MNn1cwKzjAhXAAwMCCEWCCFLNoYl7ZF9qawUvZUjDoNilPuKw9Ls6eZpcZbHJbJg4BRIJlWXiO3601AqrRY0nyrKMRicjyrV7NaXHx/u568/+v6KrQ4CwEcrdWLR4gABzAGgAwSADzAOAGAwKkDLMIwGDjBDw3wSDnjCYghQwktN2P+eIYD12eTVpJjKctzD4ijEUVzFgOjBwGhIVy6AJAJH13GCKmcNwE5mRxOe+gddluDvrFkMqf+QQSuiMwmxnGn/na1aoTBN5VC6BmMIsTpRiRHDxxthtRNTOl8xNyRc/7ebZvo99MLYGlguIQAhRPmyLdDq/9if///9DoITzADgAwwCkAjMAkAKDAdQNMBBYhgu4hsYO+AVGEtC+BoA/rgbauMJGCshPZgewGwYDeBNnmfHJdmwNGaFGRLsca6/sAtVowWJUYQBiwzINCcSkpG9l4+RxZPNrkz/Oc6ki24xtNKr9XcvlKxy73Ir4J4EABRL3IHLXETheSWoVo/+tMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUWQ6qmJABElASgSBBmAfimxhsAfQYJoCfmGfAJBoTbs2fQ0HPHg5VGpAbmWoVA4rRYhzAQAgUAyBctsy1nMvZtBMqj7XpVIm//viRCQP8+ExNQP9SsCQhtaAf2ZqUCzY1A/0a8KvH5lB/iVwEkKLkZIyaGKaQFpY5BB7pqX563aOdym/EoM202+vVu9etv7s//t4vJ6wWEOprthJv/R/9KDzQTACQA4wAQAlMAnAQjATAM8wP8BIMVTFMjCTgi0wtoUXNrf8rzmMSNUxQ8HyMH+A3zBDQC47pRA08ZYCmKjDUwwKRfXMwVlqHkNKx00VnnwcF/bMfsPQ69ucnK9WlNCyBMCAlJcaIMUUXQCQ7uzOxMtfM/Y8vWl9u8wrMbf2+78+P3X26T4RWwgO+57v/+rWL0BwA+YBIAFGAlgG5gWwFAYPeCBGCYAIhhlAKmYBYPTmN6/752VRE2exWEaKr6YpG0YrlOYcC8YZhWYNguCgoCAfRtjK1pY+ss5Er0RtQzyxXpZzkxJZTZnrs1f5cmvyr2q0HxQMGjnXfFZzNc/czhNwyuq33PPtKWjh0omxV5RDEAgAANAHzABQEowBkB1MAgAgjATBcUx5ggPMCJBNjDswbo5XRkgP9dKzDO0XNeoYzoUTKoMEYnMHh0wqBysFgIHgUDI3I0o5o2seSuTadhfiVvuE2R6IagVd7v4PoymzJT5CHkJGCJoDAGGgAispTRcQAHQMDsQQX7qXQroVF2or8lgxLIp6q3OKt9PJ+ov1dtqErWW+Tj05eMkn2QBYwila2qFv29H///+lTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQoABg0AOEIBOYAEAtGAMgT5gIAMMYLWG+mBclyJhEoXUYsSCrHxLQWhmL6TqYvEEOGEvgWZgwwCMe2anPEBvqmYmThAwYaComL5eOTJksPXdE5PFGmNzgt0rdqIwi691/CmgV/I1Ab/2ocpaWN0IfE67iont0SUQePSBCNLocEkkKLmazELF8XLxMU69//74kRGj/TsPbMD+0NgsifWMH+JXg/MqtAP6M0CwZ9ZAf4lqDV81Hft8WUVQldyHWij/363CMAJAITAFADowB8AZMA0AWjAMwKEwSQNlMFSIUDBAwNUxGQYsOkln5z9DwHQ30cTYUYNHmMREgy+QDHQkFhMWAaCQCYBAI8GSIXFl1bZ1M5GReyrmXM4hpdDnvq3dS5cjSoddt1loRCJP1GWptKd+H7lQIjTZcRIQBlmuYIXEkAamWKdZI1NJFdo2D2UnNVSaLsapZ1Ah8tmib2dp4xqS8E6Unaq5YiD6XkER5ByfXezc0hB8wAYAKMAVANzAPgG4wF0DLMFYCPjA8xbgwfkCQMG6GMDgwePIx/4d2MMtBoTBLgLowK0CFOhgN+nM8oMwaMCXSoWDYavOAnheCtWgl/JTKJXHeWAUexNSzRc1aQ2nMlzyHRS0RDyQ7POftmXm9m5VsMcBLomMGXViyW7KiAAJMAIAHDABQCkwBYBIMABApzApAXQwUcfnMLnGFzCMgCoxOUkHNFuxoz4gw8AyAQCYMKvAlTBfAEoPAZoQjGkS2HHswwDiYXA4AqWCABOiiqpeqBIls2o2wWNyx/Woxt23zgiAIS12RlidFY2JAaCS7KMlPiQF0otIorkjZAgI0OkKJFhxaTWo1EKjm4W1Nupyy71Klq33X958vM+wn5KYth1LhzHiiN3/d/1f/+9SkxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqjAQIHBoOOjOg018kOkszBXQuAw10PiMRiDlzFpCfkx2/5jNZ+BzSEKEMDsBTTBBQQwwGwCVMA1AVjAFADldYQAGlniYAbh1jyNLK1NlPSW4s0Fwik2AptQZokVSXFjh9BH/++JEMI/0gzWyg39JcHlktpB/plpXxSTAD+2NQioSmYHP7JgNKwOGy8mtQkR/YnmzjdQh1t5FFHsobN0qy5qwjBTahPq5D/11IoYUWUFHo9mtAqiqXSHgAUwBcAGMAwABTAmQFYwUYJ9MIFFVzDHwiQwx8bKNus9XDYhQNQ3umk0ZS4yUK0xZGIwAC8FANHgUDwcALJ3AfZz6dpzlt2jtu9lE7VScCQCTBFNa1oX2gnGNOt8/lLrnHfsdq3RqfkpFcXl51m/cVtf+Pf3ouaYAeAEBcA9MAiAbDANQMswCID6MJNFtzDLi/UwoEH6MZ3I/j7YDZs7l17BMaKCjjBuwL0wMYBQPDizXAcz9FMFHzEhYOIwQJmIhjDkEoAAraLw0LMrZKuhFYhApttFovwkgyCCWnLRhuFlgG69eO9hRzA4i4lHfLkqK28lHo1K6sSz9TCOXo84mNocQ8kRZU6t5wup2VbZs8+4vyfyb5zFLb2wbX3NSsUi+8zM5tJnKzNP553f2sSj/2fo/0ioEJAeIg4YFJ5g5bGb8GYGQIDGFElyBgdASeYq4Cjn4Q2OxiVYDYY8eAtmFHAKRgu4AifYcHPh5qhMZgbCMJL/FALJWS3XInHV7Ll+uLegaAZVXlkzFeSC7TXeTsqt0EVr6+xzP8u7u1pzusu65lutsRgGDYaB54zScGIRdQko9gsaXbT6////t/TVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUQAAzFhGAHGABgHJgIwCYYFSCGmFGAWBiLBHwYSaAGGEyD9h8scgweyytIGLfhtJg/QJUYJeA+m5URs5eZsyGFsBlICYkAgwGQ/LywSSAqVAGDU+1u//vgRCqP9Y8+MAP7Y0BxRLZwa+kuFZT8wA/xLUHYjhnBv+yYN1RzcynfuDHdJA5AQHgVl4My4IRuUqig+MR6NEgIhwPaz/Oi0pMkh9GyqKv4yXH78vuk5tARVZWI4rJIfYda3vrBFMNKL08sdZ7P/L/P9El4JKWQNqBMYJvO60tU2yAAwYUzRo24knwGBzgLphRonOYXAC3mCjDz5vUHkyZ9GIoGEWgkhgKAEmYBiAaGAIAFYhADFV0SxYAcQXdhdl6GuQ3C9ujIERZJJNoQqNIkLbWpKEVOry3/5S21Lwr/7i+SWWdHFgxcbl4DXqexFMyuIwBYABMAJADTAOAEIwIcA/MC2BZDBMxZEw9UWzMPMBdzB2iHk4OD0fNYEKsDJNAQ4wtsEDMFqAwjkZfMsH4yiLzCIhMLA5CaFQHTKPJzLFaKMgpNxSc6j5J3WbPacBtn4i77SO06MTIBMGTsmwWFQIkQo6pLpkROJTuEqp5LqbeqoSH1NZFiZHNtVtVu4s+aKUf1GIfNgvsqjCDX/yqcwsFTaDr0AqBIBV+zoAwCBg4mNTMwY2JFPVcDCogSYxAwTDMTrDYjEwy8o1CD6+NrAP6DDsBE0wYEIYMDSBSTadgyJ3HRomQBZOBwSkE5l223N0GPu7RXoXNR7cp7yXVJDHb9/GkwpbdN38bvLQGIhywTCmIDIcCBQVxes+re6P7VL9BMQU1FMy45OS41qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//viRAAP9LY9sYP7G3Bjo2aQa/skC+Bi0A1/pIHREhmB/qVQQSgQASAIA+CQEYwCkCxMBcBijBzRpsx5sZRMEjCvjFkwxQ1QrrSN7FSPzHJAgQwvsDjMGCAmj7006RENpTzJTcxgigMSCQMFMwRHUHWuzNsEXjb0RS5ZhiT1OySH4nffyzSz1Llcm5Zeq5zMqrTdNY5qluyyoLdXV+rGiBso4K4kpmRnH1ttpfIV/+/0Jaz//+r////XuaMtMQAjAmTKJjW6TArhB4wQ0VeMAlAvTCcgVI3HEc8PoSEWDK8E1peNLKTLg4xcHMQCi0C13la/G5TAtmN0tjkplnbdzLWFrPDLdbHv4fr/s8LMArBkWHLrriK5n+37F////TRK1p4lYUzQ44L0wJQChMQFBBTBrwPwwPUNeMXW6XDgPQhE8DL8zEHww/EMwgBowVA8DBQhIaKny0t2YAiUul1HUo4/Asxu3qkq8s6wy3yktZWUmHOoFWOWaAxwe329SfRMAEEQAuYA4AJGAugB5gWwBcYSuIHGDxhpphvgOeYLIR5mmuYxp9RiP+ZJdMYPNOYMncYEE+YICkYDh6GCeAg1SCWxIAYBTJ5xs8FCJ4626BH0U0JAINa1o7sIvu53jOb0/PE8qFOrCFwDiPTbnrXX8r9KYgpqKZlxyclxrVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVRGABDIBCYAIAnDIDCYBQBsGBZg8JhGAooYdaVGGBiBZpjKAN2d2fwdGlGr2BkP4SuYcgB9GD0gP50ojG//74kQeD/RcLjED/EMwpGal8H9sZg8w+MgOfKfCEZHYwf2ZoGSeaONxjgjGLQu0ZWNJhMCGW5zuok77lGhOeMB4wGLCKZBvaDQYJ1u2UhizjERhZHYQpkUTHK/V+XA6B1/HB7hwGF4qnY2mPXTp////9v6W4JtjAAIRAG5gAQAgYAsA6mB7jbhjbwcKYKyAoGDOiRBoFlQcfyUNvmMFg5Bg1AH6YG+AkHEGJiIEBBhCQWlAw8JCQKElepol02XsURJfdkYnMj+VgPE0fqkRE0RDsbmZwFh5gbl2YTBliCq1lw0se1vecfKUD0q0TiqNfBr2adtTkNaXmsLTGd/3ggAYMrBVoQAr0jTKcLItLP7jaLn1J////9qlwcBRoVAIkmRQcaSBZ6k1nL7oYcUEImFbEMZgwv1SYsWXWmBwBQhgWQKCYDuBmGAWAOpgCIB8QgC6fQkACukterCnKc1nUH3r9JGcZ+tFZ0DCoqBA0o4kcccYjDjKMIUo0tEVinGKxTsaxiHVFkdNWf//rvfp+O/9AFABAQAGgEAgFAEcwBUCIMBeBQTBMRPYxY4hMMM2DFTFxBps4oP5lNqWJ/TGOQqIwqIEvMGHAtD2lE4koM4AjCBYwANXMk7Yc1uTbu89bnxiEO5PTNNbpAtZ51qjumcpFLeyZSvlV3nLIw+mGS4aOiYoeKtzlk7kq6mRk8n/////////rUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/++JEAA/0Tyowg/1KwFIDJnB3/EAQQKrAD+jNQhuVmIH9pZhZIwACCMAXAACgYBOAimAnAbxgf4qOYlIM2mBqghBhN4Bab6ATVn5Rjyp7I4hquXZkkLxieGpicChhyDpedBI3qsKl8laQ6rwuYqeq11phxpk0gJScPaTU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8UDKwIAABQNiZiqViDD1YZA58qnnMZTFnPjkCzExLY1GojFnFiskm4BjNW1fqUyMUESZtZsQBooRJp4SrJDrrubDTV0tBL4h3U5+MGV8yn/925mNjO3/l19vx9798P5J7pi/0/+2EMHRxAQBWYAgAgGAogMpgsgAOZAUERmBhgRhghoH+Z1txMnaalrhic4ViYJwB3GBdgZZ8IBx5pmlQwQBoUiKs8LuJCTS82S3GhPZGY44kan5FFECADjgWJkEjRG84kSFHqJ09hj3Gc6bklL7UPHJZn/7qSPBFaI8M9i5rMf///t////9NUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVBoICATEoTPCwFeAcEwaUJMMTsCzDEVgvMwmYoDMUvSJT4uA3kz7/++JkEw/0sDGrA1/pIIulpZB/aWgR/PiuD+ytgZiMl0Gv5JjygwWXkwjKAwRIcECUOACDgbMAAJLssMTuKwFKAHQTq4bpCpG3Fn6sDXKWH77SYxTT7pXIdil2ij8l7L4Mlu+QJGKftyIZZWvtVcZyexyx38vnKbti5hl+NL3Letf3nN/jfOkph50ShlFxoNwxX8ceYILABQCA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JgIcXJVud1abzO8/TcWzNeoex7kR+zubsz87fqztft2xhM3e/2hEJVUwVB0+TUy4sEtLkbmdCfIpiDVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//viZAAP87IcKoP9YqCC5CUwc/wmCexCsg7/RolYilYB3/TILVCIAbEYBQAQD8RgPBgBAI6YDKLGGJGEfhhDwVOYo4H9nRg8NJ9UQqOeen4buFOaPiUZYBKEHcYMAMYIAsCAJfpYUMQUJSCSjokIRSOjOjx+tb9l3GYWVlvXO3b37QrAAQUsOrY08nInPWT///t//5P/////+0QgIEhMwINjE5ZMZLI0jrzBYhZww6IxqMCnCPzFcg4I/w9iSMj2FDjH7QcMwvAB6MGTAUzigcNakcz0PDFA2MHh0EgpBCVgOy+8CubTOI89K++UipYvLvnMdYxOxM16lmdyuY52Pw5e5zeqm7l9glAUFgMuSuY1RNKWfp/9v//T/7f0vOhQBgDMHAOMOwrMhB4Ni0RNzqlMJsBDTAQBdszYbqvMf8H0TBhAjQwIUEVMBIAqjR3zLRDOozIkQ4opfDMPwZlcp6GzQfRbNIuwDTsu7XUCT5GgDGggMHwAMggZNOQeORBCMMABvTCaB38xwT8DMVND3zS2GDKJCTFcoDDIYRCGQ4CJMAZEAq/rMKkdNENymnzpe02NbvbPbmgGBBYew0nRr098omIKaimZccnJcaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuOTkuNaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/74mQAD/P+HqiDH+iweiOFMHP7JhAQmqAOf2TBsJNUgf6lWDEM30Nmz64wDwCNMAxBQDAaBmsyLop3MTRD1DGqy/I8oCniPtpKkT0YeTmEljXQiTNsOjJAAQUK4yEYWAZCSpdHn8aHPvCzKiVjlbwQTEZJLMLGv7Lb+Fr52pT28ceSy7Y5cwysnQbAYTAKVopIlUDoTvc++7+d9yur/93///+9aI4CAuETCA2MXokx9PjBRRm8xrQczMEpCAjEKQKg3UTNZPiXNMzE1AS4wjMCHMEuATjuws2QYNLNTGykw4EVTliQ8QlDjLpf+lsyWUSSaj1+Q085JbOOfbFv7Exbxv919YgLAqCMFR1goIGrHZ5Gh3Z/R///6P///9IwAgKFTBA4Mmk8082Da+VMKqD5DFZC2Qw2UDNMQ6KXD6F2585kFV6MfFDNzCmge4wcMEHPWtjw4s45uMyLDMSkDBj9LBRKHWXTz2Po5jkslzk0M8jMrvSmKalH2Yxa53O9nzGZvXcO913V6/3+cx5//y3w80MG9ytn79X///6//WrlUQ8AECQCkCgFgBAiRg1QhaYqcCYGFCgzxhMYrUZg2UFH+0mBxgXQJhokxiMUZgOOQoJ5g0CBgIAQQD6rX1b1/XSfpzwGIAQBI4iBYVkRHTpxRMHb3MpdLav1leFp7C78/dVG8e8ZAAd7/oTEFNRTMuOTkuNaqkxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/++JkAA/ynRSqg1/hIIkFBOBv+iYKCFSqD3+oAcgQFAGv9JBhy5U2gAHMSeMRdMAZBejFhAAIwToEdMGkCQzIAOJEyPoHaDdmcIEJo8QAZSjxXMJAAuA0t3pTFb8Odgqkpb2cZwpu2Jq/nftB82cJzqnvlXt//10zdzAAwycLN0Mji6kwZwPHMa0DEjAoQH8wtwHxMdr9ozv50OIwhwLZMBiA4DAaQKkw+Q5pszQQUcDRJlw0CMWGYAtp3S4au3Wp3Xnn9n6kQt2IjBDbSqVTOOVBIpyanbFL/ZRascyuXO/zVvOrq9n/2ct/S3AMto8S3IQk1FLk/v///5L////TTN0jnqpBUCMwAgTjAbBpNdAIAwdABDAzD7MeR5TTI5BPQXSgFM0YpAAYYgWDg4AwNlq1oOPOQxLqkji8Xy27t6p/N8rbv1+mlhoDPPWvsjPQ+6cikiJSZkIYiMYHOGqmKcAexgugFOFxDExwvjpOf9Jwzh4yDQ0TzFgQjFEHzCQLjA8E0QWRP2xJrTas6gtkkUfV4H6swmzGorNU9Jy3TVZbb73PKbu1alaxhN4Y4dzufEJcOzw4OIg+Otvu/bb////QmIKaimZccnJca1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV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SzKQzAqKVUAhvIbi7sZyHqUL8s/z09iHe3///01MQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" \n        type="audio/mp3" tabindex="-1" />\n    </audio>\n\n<div id="backgroundMusicYTPlayer" class="MusicYTPlayer"  tabindex="-1"></div>\n\n\n\n\n  '}GameManager.attributes.add("cameraOptions",{title:"Camera Options",type:"json",schema:[{name:"cameratype",title:"cameratype",type:"string",enum:[{FirstPerson:"FirstPerson"},{ThirdPerson:"ThirdPerson"},{ThirdPersonPointMove:"ThirdPersonPointMove"},{FlyCamera:"FlyCamera"}],default:"ThirdPerson",description:"General style of player view for this game."}]}),GameManager.attributes.add("cameraPostProcessing",{title:"CameraPostProcessing",description:"CameraPostProcessing effects",type:"json",schema:[{name:"enabled",type:"boolean",default:!0,title:"enabled",description:"enables CameraPostProcessing"},{name:"bloom",type:"boolean",default:!0,title:"bloom",description:"bloom"},{name:"ssao",type:"boolean",default:!0,title:"ssao",description:"ssao"},{name:"taa",type:"boolean",default:!0,title:"taa",description:"taa"},{name:"lut",type:"boolean",default:!0,title:"lut",description:"lut"}]}),GameManager.attributes.add("scenesConfig",{title:"scenesConfig",type:"json",schema:[{name:"mainMenuScene",title:"mainMenuScene",type:"boolean",array:!1,default:!0,description:"mainMenuScene"}]}),GameManager.attributes.add("mouseOptions",{title:"Mouse Options",type:"json",schema:[{name:"hideMousePointer",title:"hideMousePointer",type:"boolean",default:!1,description:"hideMousePointer"},{name:"fireMenuEventOnMouseMove",title:"fireMenuEventOnMouseMove",type:"boolean",default:!1,description:"fireMenuEventOnMouseMove"},{name:"mouseSensitivity",type:"number",default:10,title:"Mouse Sensitivity"}]}),GameManager.attributes.add("ui",{title:"UI",type:"json",schema:[{name:"mainMenuType",type:"string",enum:[{none:"none"},{default:"default"},{custom:"custom"}],default:"default",description:"mainMenuType"},{name:"mainMenuHtmlFile",type:"asset",assetType:"html",array:!1,default:null,description:"mainMenuHtmlFile"},{name:"hudHtmlFile",type:"asset",assetType:"html",array:!1,default:null,description:"hudHtmlFile"},{name:"showMenuOnEnabledPointer",type:"boolean",default:!0}]}),GameManager.attributes.add("followCamera",{title:"Follow Camera",type:"json",schema:[{name:"targetName",type:"string",default:"targetEntity",title:"Target Entity Name",description:"Select the entity name around which the camera will orbit. recoment use: 'targetEntity'. "},{name:"orbitRadius",type:"number",default:3,title:"Orbit Radius"},{name:"bottomClamp",type:"number",default:320,min:320,max:340,precision:0,title:"bottomClamp",description:"The maximum value in angle degrees for the camera downwards movement."},{name:"topClamp",type:"number",default:70,min:50,max:70,precision:0,title:"topClamp",description:"The maximum value in angle degrees for the camera upwards movement."},{name:"smoothFactor",type:"number",default:.2,min:.01,max:1,title:"Smooth Factor",description:"Adjusts the smoothness of camera movement (0.1 for more smooth, 1 for immediate response)"},{name:"autofov",type:"boolean",default:!1,title:"autofov"}]}),GameManager.attributes.add("flyCamera",{title:"Fly Camera",description:"Only works for playerPersonStyle = FlyCamera.",type:"json",schema:[{name:"speed",type:"number",default:20,title:"speed",description:"speed",min:10,max:20,precision:1}]}),GameManager.attributes.add("subtitles",{title:"subtitles",type:"json",schema:[{name:"enabled",type:"boolean",default:!0,title:"enabled",description:"enables subtitles"},{name:"enableSubtitles",type:"boolean",default:!0}]}),GameManager.attributes.add("tracer",{title:"Tracer",type:"json",schema:[{name:"enabled",type:"boolean",default:!1,title:"enabled",description:"enables Tracer"},{name:"trenablefps",title:"FPS Enabled",type:"boolean",default:!0},{name:"trshowstats",type:"boolean",default:!1},{name:"trenablelightingdebugLayer",type:"boolean",default:!1},{name:"tralwaysshow",title:"Always show",type:"boolean",default:!1},{name:"trordermode",title:"Order mode",type:"string",enum:[{newlestlast:"newlestlast"},{oldestfirst:"oldestfirst"}],default:"oldestfirst"},{name:"trgamesleep",title:"gamesleep",type:"number",default:0,min:0,max:100,precision:0},{name:"trgametimescale",title:"trgametimescale",type:"number",default:1,min:0,max:1,precision:2}]}),GameManager._app=null,GameManager.showMenuOnEnabledPointer=!0,GameManager.__menuchecktime=0,GameManager.__subtitleTimeout=null,GameManager.__assetLoaderTimeout=null,GameManager.currentCamera=null,GameManager.cameraOptions={},GameManager.followCamera={},GameManager.mouseOptions={mouseSensitivity:10},GameManager.__gameMouseMoved=!1,GameManager.__gameMouse_busy=!1,GameManager.input={cameratype:GameManager.cameraOptions.cameratype||"",x:0,z:0,esc:!1,jump:!1,sprint:!1,interact:!1,attack:!1,camera:null,previousY:0,previousX:0,mouseSensitivity:GameManager.mouseOptions.mouseSensitivity,mouseX:0,mouseY:0,mouseDx:0,mouseDy:0,mousePrimaryButton:!1,mouseSecondaryButton:!1,mouseXButton:0,mouseYButton:0,mouseWheel:0,lookLastDeltaX:0,lookLastDeltaY:0,dt:0,mode:0},GameManager.prototype.initialize=function(){GameManager.showMenuOnEnabledPointer=this.ui.showMenuOnEnabledPointer,GameManager.mainScene="game",GameManager.currentScene=GameManager.mainScene,GameManager._app=this.app,GameManager._app.mouse.disableContextMenu(),GameManager._app.isMenuMode=!1,GameManager.cameraOptions=this.cameraOptions,GameManager.currentCamera=GameManager.calculateCameraScene(),GameManager.cameraPostProcessing=this.cameraPostProcessing,GameManager.applyCameraPostProcessing(this.cameraPostProcessing),GameManager.input.camera=GameManager.currentCamera,GameManager.input.cameratype=this.cameraOptions.cameratype||"",GameManager.followCamera=this.followCamera,GameManager.followCamera.initialFov=GameManager.currentCamera?GameManager.currentCamera.fov:45,GameManager.followCamera.eulers=new pc.Vec3,GameManager.followCamera.smoothedPosition=new pc.Vec3,GameManager.followCamera.target=null,GameManager.playerEntity=null,GameManager.playerEntityScript=null,GameManager.checkForPlayerAndTargetEntities=!0,GameManager.mouseOptions=this.mouseOptions,GameManager.flyCamera=this.flyCamera,GameManager.flyCamera.moved=!1,GameManager.flyCamera.ex=0,GameManager.flyCamera.ey=0,GameManager.enableSubtitles=this.subtitles.enabled;var q=this.app.graphicsDevice.canvas;q.focus(),q.requestPointerLock=q.requestPointerLock||q.mozRequestPointerLock||q.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,TracerScript.trenable=this.tracer.enabled,TracerScript.tralwaysshow=this.tracer.tralwaysshow,TracerScript.trordermode=this.tracer.trordermode,TracerScript.trenablefps=!!TracerScript.trenable&&this.tracer.trenablefps,TracerScript.trshowstats=!!TracerScript.trenable&&this.tracer.trshowstats,TracerScript.trenablelightingdebugLayer=!!TracerScript.trenable&&this.tracer.trenablelightingdebugLayer,TracerScript.trenablefps&&(TracerScript.fps=new FPSMeter({heat:!0,graph:!0})),TracerScript.trenable?(TracerScript.trgamesleep=this.tracer.trgamesleep,TracerScript.trgametimescale=this.tracer.trgametimescale):(TracerScript.trgamesleep=0,TracerScript.trgametimescale=1),this.app.root.name="APPROOT",this.app.maxDeltaTime=.2,document.body.style.backgroundColor="#000";var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var a=document.getElementsByTagName("script")[0];if(a.parentNode.insertBefore(e,a),GameManager.backgroundMusicYTPlayer=null,this.createHudDIV(q),this.createMenuDIV(q),this.createSceneLoaderDIV(q),this.createSubtitleDIV(q),this.createLoadingDIV(q),"default"===this.ui.mainMenuType&&(GameManager.menuDIV.innerHTML=uiGameMainMenuCircularHTML(),GameManager.createCircularMenu()),"custom"===this.mainMenuType&&this.ui.mainMenuHtmlFile){var t=this.ui.mainMenuHtmlFile.getFileUrl();fetch(t).then((q=>{if(!q.ok)throw new Error("Network response was not ok");return q.text()})).then((q=>{GameManager.menuDIV.innerHTML+=q})).catch((q=>{console.error("Error fetching HTML:",q)}))}if(this.ui.hudHtmlFile){t=this.ui.hudHtmlFile.getFileUrl();fetch(t).then((q=>{if(!q.ok)throw new Error("Network response was not ok");return q.text()})).then((q=>{GameManager.hudDIV.innerHTML+=q})).catch((q=>{console.error("Error fetching HUD HTML:",q)}))}this.app.on("showmenu",(function(){GameManager._app&&!GameManager._app.isMenuMode&&(GameManager._app.graphicsDevice.canvas.focus(),GameManager.fadeIn(GameManager.menuDIV,200,(function(){GameManager._app.isMenuMode=!0,!1===GameManager.showhideMousePointer("show")&&(GameManager.menuDIV.style.display="none",GameManager.menuDIV.style.opacity="0",GameManager._app.isMenuMode=!1)})))}),this),this.app.on("hidemenu",(function(){GameManager._app&&GameManager._app.isMenuMode&&(GameManager._app.graphicsDevice.canvas.focus(),GameManager.createAudioListener(),GameManager.fadeOut(GameManager.menuDIV,200,(function(){GameManager._app.isMenuMode=!1,!1===GameManager.showhideMousePointer("hide")&&(GameManager.menuDIV.style.display="block",GameManager.menuDIV.style.opacity="1",this.app.isMenuMode=!0)})))}),this),this.app.assets.on("load",(function(q){GameManager.assetLoaded(q)}),this),TracerScript.initialize(),GameManager.bindInputs(),this.on("destroy",(function(){GameManager.unbindInputs()}),this),q.setAttribute("tabindex","0"),q.focus(),GameManager.cameraPostProcessing=this.cameraPostProcessing,this.on("attr:cameraPostProcessing",(function(q){GameManager.applyCameraPostProcessing(q),GameManager.cameraPostProcessing=q}),this)},GameManager.prototype.postInitialize=function(){this.app.on("update",GameManager.updateGameManager,this),GameManager.currentScene===GameManager.mainScene&&this.app.fire("showmenu")},GameManager.bindInputs=function(){GameManager._app.mouse.on(pc.EVENT_MOUSEMOVE,GameManager._onMouseMove,GameManager),GameManager._app.mouse.on(pc.EVENT_MOUSEUP,GameManager._onMouseDownUp,GameManager),GameManager._app.mouse.on(pc.EVENT_MOUSEWHEEL,GameManager._onMouseWheel,GameManager)},GameManager.unbindInputs=function(){GameManager._app.mouse.off(pc.EVENT_MOUSEMOVE,GameManager._onMouseMove),GameManager._app.mouse.off(pc.EVENT_MOUSEDOWN,GameManager._onMouseDownUp),GameManager._app.mouse.off(pc.EVENT_MOUSEWHEEL,GameManager._onMouseWheel)},GameManager.readKeyboardInput=function(){const q=GameManager._app.keyboard;q.isPressed(pc.KEY_A)||q.isPressed(pc.KEY_LEFT)?GameManager.input.x=-1:q.isPressed(pc.KEY_D)||q.isPressed(pc.KEY_RIGHT)?GameManager.input.x=1:GameManager.input.x=0,q.isPressed(pc.KEY_W)||q.isPressed(pc.KEY_UP)?GameManager.input.z=1:q.isPressed(pc.KEY_S)||q.isPressed(pc.KEY_DOWN)?GameManager.input.z=-1:GameManager.input.z=0,GameManager.input.esc=q.isPressed(pc.KEY_ESCAPE),GameManager.input.jump=q.isPressed(pc.KEY_SPACE),GameManager.input.sprint=q.isPressed(pc.KEY_SHIFT),GameManager.input.interact=q.isPressed(pc.KEY_E),GameManager.input.attack=q.isPressed(pc.KEY_F),GameManager.input.impact=q.isPressed(pc.KEY_I),GameManager.input.death=q.isPressed(pc.KEY_U)},GameManager._onMouseMove=function(q){if(!GameManager.__gameMouseMoved&&!GameManager.__gameMouse_busy){GameManager.__gameMouse_busy=!0;const t=q.x,n=q.y;var e=q.clientX?q.clientX-GameManager.input.previousX:q.dx,a=q.clientY?q.clientY-GameManager.input.previousY:q.dy;GameManager.input.mouseX=t,GameManager.input.mouseY=n,GameManager.input.mouseDx=e,GameManager.input.mouseDy=a,GameManager.input.lookLastDeltaX===e&&(e=0),GameManager.input.lookLastDeltaY===a&&(a=0),GameManager.currentCamera&&GameManager.onMouseMoveFollowCamera(),GameManager.input.lookLastDeltaX=e,GameManager.input.lookLastDeltaY=a,GameManager.input.previousX=q.clientX,GameManager.input.previousY=q.clientY,GameManager.__gameMouseMoved=!0,GameManager.__gameMouse_busy=!1}},GameManager.onMouseMoveFollowCamera=function(){GameManager.followCamera.eulers.x-=GameManager.input.mouseSensitivity*GameManager.input.mouseDx/60%360,GameManager.followCamera.eulers.y+=GameManager.input.mouseSensitivity*GameManager.input.mouseDy/60%360,GameManager.followCamera.eulers.x=(GameManager.followCamera.eulers.x+360)%360,GameManager.followCamera.eulers.y=(GameManager.followCamera.eulers.y+360)%360,GameManager.flyCamera.ex-=GameManager.input.mouseDy/GameManager.input.mouseSensitivity,GameManager.flyCamera.ex=pc.math.clamp(GameManager.flyCamera.ex,-90,90),GameManager.flyCamera.ey-=GameManager.input.mouseDx/GameManager.input.mouseSensitivity,GameManager.followCamera.eulers.y>GameManager.followCamera.topClamp&&GameManager.followCamera.eulers.y<GameManager.followCamera.topClamp+180&&(GameManager.followCamera.eulers.y=GameManager.followCamera.topClamp),GameManager.followCamera.eulers.y<GameManager.followCamera.bottomClamp&&GameManager.followCamera.eulers.y>GameManager.followCamera.bottomClamp-180&&(GameManager.followCamera.eulers.y=GameManager.followCamera.bottomClamp)},GameManager.updateCameraOrientation=function(){"FlyCamera"!==GameManager.input.cameratype?GameManager.followCamera&&GameManager.followCamera.eulers&&(GameManager.currentCamera.entity.setEulerAngles(new pc.Vec3(-GameManager.followCamera.eulers.y,GameManager.followCamera.eulers.x+180,0)),"FirstPerson"===GameManager.input.cameratype&&GameManager.playerEntity&&GameManager.playerEntityScript):this.mouseOptions.hideMousePointer?pc.Mouse.isPointerLocked()&&this.camera.setLocalEulerAngles(this.flyCamera.ex,this.flyCamera.ey,0):this.camera.setLocalEulerAngles(this.flyCamera.ex,this.flyCamera.ey,0)},GameManager.updateCameraPosition=function(q){if("FlyCamera"===GameManager.input.cameratype)return this.input.x<0&&this.camera.translateLocal(-this.flyCamera.speed*q,0,0),this.input.x>0&&this.camera.translateLocal(this.flyCamera.speed*q,0,0),this.input.z<0&&this.camera.translateLocal(0,0,this.flyCamera.speed*q),void(this.input.z>0&&this.camera.translateLocal(0,0,-this.flyCamera.speed*q));if(!GameManager.followCamera.target)return;if(!GameManager.followCamera.smoothedPosition)return;var e=GameManager.followCamera.target.getPosition();if("FirstPerson"===GameManager.input.cameratype)return void GameManager.currentCamera.entity.setPosition(e);var a=e.clone().add(GameManager.currentCamera.entity.forward.scale(-GameManager.followCamera.orbitRadius));a.y=pc.math.clamp(a.y,.5,Number.POSITIVE_INFINITY);const t=GameManager._app.systems.rigidbody.raycastFirst(e,a);if(t&&t.entity&&!t.entity.isPlayer&&"charactersensor"!==t.entity.name.toLowerCase()&&!t.entity.tags.has("ignore-camera-collision")){var n=GameManager.followCamera.target.getPosition().sub(t.point).normalize();a=t.point.clone().add(n.scale(.1))}const i=q/(1/60),A=GameManager.followCamera.smoothFactor*i;A>0&&A<1?GameManager.followCamera.smoothedPosition.lerp(GameManager.followCamera.smoothedPosition,a,A):GameManager.followCamera.smoothedPosition=a,GameManager.currentCamera.entity.setPosition(GameManager.followCamera.smoothedPosition),e=GameManager.followCamera.target.getPosition(),GameManager.currentCamera.entity.lookAt(e);var o=e.distance(GameManager.currentCamera.entity.getPosition());if(GameManager.followCamera.autofov){var c=GameManager.followCamera.initialFov+GameManager.followCamera.initialFov*(1-Math.min(o,GameManager.followCamera.orbitRadius)/GameManager.followCamera.orbitRadius);c=pc.math.clamp(c,GameManager.followCamera.initialFov,90),GameManager.currentCamera.fov=c}},GameManager._onMouseDownUp=function(q){GameManager.input.mouseXButton=q.x,GameManager.input.mouseYButton=q.y,GameManager.input.mousePrimaryButton=q.buttons[pc.MOUSEBUTTON_LEFT],GameManager.input.mouseSecondaryButton=q.buttons[pc.MOUSEBUTTON_RIGHT]},GameManager._onMouseWheel=function(q){GameManager.input.mouseWheel=q.wheelDelta},GameManager.sleep=function(q){if(!q)return;const e=Date.now()+q;for(;Date.now()<e;);},GameManager.updateGameManager=async function(q){if(GameManager._app.dt=q,GameManager.input.dt=q,Timer.evaluateTimers(q),GameManager.checkForPlayerAndTargetEntities&&(GameManager._app.scene.root.find((function(q){q.name.trim().toLowerCase()===(GameManager.followCamera.targetName||"").trim().toLowerCase()&&(GameManager.followCamera.target=q),q.isPlayer&&(GameManager.playerEntity=q,GameManager.playerEntityScript=GameManager.playerEntity.script.character)})),GameManager.followCamera.target||(GameManager.followCamera.target=GameManager.playerEntity),GameManager.checkForPlayerAndTargetEntities=!1),GameManager.readKeyboardInput(),GameManager.sleep(TracerScript.trgamesleep),GameManager._app.timeScale=TracerScript.trgametimescale,TracerScript.trenablefps&&TracerScript.fps.tick(),TracerScript.trshowstats){if(window.performance&&window.performance.memory){var e=window.performance.memory;Trace("totalJSHeapSize",parseInt(e.totalJSHeapSize/1048576)+"mb"),Trace("usedJSHeapSize",parseInt(e.usedJSHeapSize/1048576)+"mb"),Trace("jsHeapSizeLimit",parseInt(e.jsHeapSizeLimit/1048576)+"mb")}const q=GameManager._app.stats.vram;Trace("vram",parseInt((parseInt("0"+(q.tex||0))+parseInt("0"+(q.vb||0))+parseInt("0"+(q.ib||0))+parseInt("0"+(q.ub||0))+parseInt("0"+(q.sb||0)))/1048576)+"mb"),Trace("triangles",GameManager._app.stats.frame.triangles)}GameManager.__menuchecktime+=q,GameManager.__menuchecktime>=.5&&(GameManager._app&&(GameManager.showMenuOnEnabledPointer&&(pc.Mouse.isPointerLocked()||GameManager._app.fire("showmenu")),GameManager._app.isMenuMode?pc.Mouse.isPointerLocked()||GameManager.showhideMousePointer("show"):pc.Mouse.isPointerLocked()&&GameManager.showhideMousePointer("hide")),GameManager.__menuchecktime=0),GameManager.currentCamera&&(GameManager.updateCameraOrientation(),GameManager.updateCameraPosition(q)),GameManager.__gameMouseMoved=!1},GameManager.createAudioListener=function(){GameManager.audiolistener||(GameManager.audiolistener=GameManager._app.scene.root.addComponent("audiolistener"))},GameManager.showhideMousePointer=function(q){function sleepPointerLock(q){return new Promise((e=>setTimeout(e,q)))}function isLockedElement(q){return function getLockedElement(){return document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement}()===q}var e=GameManager._app.graphicsDevice.canvas;e.focus();var a=!1;try{if("show"===q)if(isLockedElement(e))try{document.exitPointerLock(),a=!0,async function(){await sleepPointerLock(500)}()}catch{}else a=!0;if("hide"===q)if(isLockedElement(e))a=!0;else try{e.requestPointerLock(),a=!0,async function(){await sleepPointerLock(500)}()}catch{}}catch{}return a},GameManager.prototype.createLoadingDIV=function(q){GameManager.loadingDIV=document.getElementById("loadingDIV"),GameManager.loadingDIV||(GameManager.loadingDIV=document.createElement("DIV"),GameManager.loadingDIV.id="loadingDIV",GameManager.loadingDIV.style.backgroundColor="black",GameManager.loadingDIV.style.color="white",GameManager.loadingDIV.style.position="absolute",GameManager.loadingDIV.style.right="0px",GameManager.loadingDIV.style.bottom="0px",GameManager.loadingDIV.style.display="none",GameManager.loadingDIV.innerHTML='<style type="text/css">.loader {width: 48px; --b: 8px; aspect-ratio: 1; border-radius: 50%; background: azure; -webkit-mask: repeating-conic-gradient(#0000 0deg,#000 1deg 70deg,#0000 71deg 90deg), radial-gradient(farthest-side,#0000 calc(100% - var(--b) - 1px),#000 calc(100% - var(--b))); -webkit-mask-composite: destination-in; mask-composite: intersect; animation: l5 1s infinite;} @keyframes l5 {to{transform: rotate(.5turn)}}</style><div class="loader"></div>',q.parentElement.appendChild(GameManager.loadingDIV))},GameManager.prototype.createHudDIV=function(q){if(GameManager.hudDIV=document.getElementById("hudDIV"),!GameManager.hudDIV){function adjustOverlay(){const e=q.getBoundingClientRect();GameManager.hudDIV.style.width=e.width+"px",GameManager.hudDIV.style.height=e.height+"px",GameManager.hudDIV.style.top=e.top+window.scrollY+"px",GameManager.hudDIV.style.left=e.left+window.scrollX+"px"}GameManager.hudDIV=document.createElement("DIV"),GameManager.hudDIV.id="hudDIV",GameManager.hudDIV.style.position="absolute",GameManager.hudDIV.style.left="0px",GameManager.hudDIV.style.top="0px",GameManager.hudDIV.style.right="0px",GameManager.hudDIV.style.bottom="0px",GameManager.hudDIV.style.margin="0px",GameManager.hudDIV.style.padding="0px",GameManager.hudDIV.style.backgroundColor="transparent",q.parentElement.appendChild(GameManager.hudDIV),function addResizeHandler(q){const e=window.onresize;window.onresize=function(a){e&&e(a),q(a)}}(adjustOverlay),adjustOverlay()}},GameManager.prototype.createMenuDIV=function(q){GameManager.menuDIV=document.getElementById("mainmenuDIV"),GameManager.menuDIV||(GameManager.menuDIV=document.createElement("DIV"),GameManager.menuDIV.id="mainmenuDIV",GameManager.menuDIV.style.position="absolute",GameManager.menuDIV.style.left="0px",GameManager.menuDIV.style.top="0px",GameManager.menuDIV.style.right="0px",GameManager.menuDIV.style.bottom="0px",GameManager.menuDIV.style.margin="0px",GameManager.menuDIV.style.padding="0px",GameManager.menuDIV.style.display="none",GameManager.menuDIV.style.backgroundColor="rgba(0, 0, 0, 0.5)",GameManager.menuDIV.style.opacity="0",q.parentElement.appendChild(GameManager.menuDIV))},GameManager.prototype.createSceneLoaderDIV=function(q){GameManager.sceneLoaderDIV=document.getElementById("sceneloaderDIV"),GameManager.sceneLoaderDIV||(GameManager.sceneLoaderDIV=document.createElement("DIV"),GameManager.sceneLoaderDIV.id="sceneloaderDIV",GameManager.sceneLoaderDIV.style.position="absolute",GameManager.sceneLoaderDIV.style.left="0px",GameManager.sceneLoaderDIV.style.top="0px",GameManager.sceneLoaderDIV.style.right="0px",GameManager.sceneLoaderDIV.style.bottom="0px",GameManager.sceneLoaderDIV.style.margin="0px",GameManager.sceneLoaderDIV.style.padding="0px",GameManager.sceneLoaderDIV.style.display="none",GameManager.sceneLoaderDIV.style.backgroundColor="black",GameManager.sceneLoaderDIV.style.opacity="1",GameManager.sceneLoaderDIV.style.justifyCcontent="center",GameManager.sceneLoaderDIV.style.alignItems="center",q.parentElement.appendChild(GameManager.sceneLoaderDIV))},GameManager.prototype.createSubtitleDIV=function(q){GameManager.subtitleDIV=document.getElementById("subtitleDIV"),GameManager.subtitleDIV||(GameManager.subtitleDIV=document.createElement("DIV"),GameManager.subtitleDIV.id="subtitleDIV",GameManager.subtitleDIV.style.position="absolute",GameManager.subtitleDIV.style.left="2em",GameManager.subtitleDIV.style.right="2em",GameManager.subtitleDIV.style.bottom="2em",GameManager.subtitleDIV.style.margin="0px",GameManager.subtitleDIV.style.display="none",GameManager.subtitleDIV.style.opacity="1",GameManager.subtitleDIV.style.justifyCcontent="center",GameManager.subtitleDIV.style.alignItems="center",GameManager.subtitleDIV.style.textAlign="center",GameManager.subtitleDIV.style.padding="0.1em",GameManager.subtitleBackgroundDIV=document.createElement("DIV"),GameManager.subtitleBackgroundDIV.id="subtitleBackgroundDIV",GameManager.subtitleBackgroundDIV.style.position="absolute",GameManager.subtitleBackgroundDIV.style.left="0px",GameManager.subtitleBackgroundDIV.style.right="0px",GameManager.subtitleBackgroundDIV.style.bottom="0px",GameManager.subtitleBackgroundDIV.style.top="0px",GameManager.subtitleBackgroundDIV.style.margin="0px",GameManager.subtitleBackgroundDIV.style.padding="0px",GameManager.subtitleBackgroundDIV.style.backgroundColor="black",GameManager.subtitleBackgroundDIV.style.opacity="0.5",GameManager.subtitleDIV.appendChild(GameManager.subtitleBackgroundDIV),GameManager.subtitleTextDIV=document.createElement("LABEL"),GameManager.subtitleTextDIV.id="subtitleTextDIV",GameManager.subtitleTextDIV.style.justifyCcontent="center",GameManager.subtitleTextDIV.style.alignItems="center",GameManager.subtitleTextDIV.style.textAlign="center",GameManager.subtitleTextDIV.style.position="relative",GameManager.subtitleTextDIV.style.justifyCcontent="center",GameManager.subtitleTextDIV.style.alignItems="center",GameManager.subtitleTextDIV.style.fontSize="1.1em",GameManager.subtitleTextDIV.style.fontWeight="bold",GameManager.subtitleTextDIV.style.textShadow="1px 1px 0px night",GameManager.subtitleTextDIV.style.letterSpacing="2px",GameManager.subtitleTextDIV.style.color="white",GameManager.subtitleDIV.appendChild(GameManager.subtitleTextDIV),document.body.appendChild(GameManager.subtitleDIV))},GameManager.resumeGame=function(){GameManager._app.fire("hidemenu")},GameManager.newGame=function(){GameManager.loadScene("mansion")},GameManager.loadScene=function(q){var e=GameManager._app;if(!e)return;e.scenes.find(q)?(e.autoRender=!1,GameManager.showsceneloader(q,(function(){GameManager.showAssetLoader(),Timer.clearAllTimers(),GameManager.freeAssets();for(var a=e.root,t=a.findComponents("anim"),n=0;n<t.length;n++)t[n].entity.removeComponent("anim");var i=a.findComponents("rigidbody");for(n=0;n<i.length;n++)i[n].entity.removeComponent("rigidbody");var A=a.findComponents("render");for(n=0;n<A.length;n++)A[n].entity.removeComponent("render");var o=a.findComponents("script");for(n=0;n<o.length;n++){var c=o[n].entity;if(c.script){let q=Object.getOwnPropertyNames(c.script);for(var l=0;l<q.length;l++)if(c.script[q[l]]instanceof pc.ScriptType&&q[l]!==this.__name)try{c.script.destroy(q[l])}catch(e){console.warn("script "+q[l]+" destruido con error: "+e)}}c.removeComponent("script")}e.scenes.changeScene(q,(function(a,t){a?(console.error(a),alert(a)):(GameManager.currentScene=q,GameManager.calculateSceneAssets(t,(function(){for(let q in e.loader._cache)if(e.loader._cache.hasOwnProperty(q)){e.loader._cache[q]instanceof pc.Texture&&e.loader.clearCache(q,"texture")}GameManager.currentCamera=GameManager.calculateCameraScene(),GameManager.applyCameraPostProcessing(GameManager.cameraPostProcessing),GameManager.input.camera=GameManager.currentCamera,GameManager.followCamera.initialFov=GameManager.currentCamera?GameManager.currentCamera.fov:45,GameManager.checkForPlayerAndTargetEntities=!0,e.autoRender=!0,e.fire("hidemenu"),GameManager.hidesceneloader(),GameManager.showSubtitle("The scene "+GameManager.currentScene+" has loaded...")})))}))}))):console.error("The scene '"+q+"' does not exists.")},GameManager.calculateCameraScene=function(){var q=GameManager._app;if(!q)return null;var e=q.scene.root.findComponents("camera");return(e=e.sort(((q,e)=>q.priority-e.priority))).length,e.length?e[0]:void 0},GameManager.applyCameraPostProcessing=function(q){var e=GameManager._app;if(!e)return null;if(q.enabled){var a=new pc.CameraFrame(e,GameManager.currentCamera);e.scene.skyboxHighlightMultiplier=100,e.scene.lighting.physicalUnits=!1,a.rendering.samples=4,a.rendering.toneMapping=pc.TONEMAP_LINEAR,a.bloom.enabled=q.bloom,a.bloom.intensity=.1,a.vignette.inner=.5,a.vignette.outer=1,a.vignette.curvature=.5,a.vignette.intensity=.75,a.taa.enabled=q.taa,a.taa.jitter=1,a.ssao.type=q.ssao?"combine":"none",a.ssao.blurEnabled=q.ssao,a.ssao.intensity=1,a.ssao.power=1,a.ssao.radius=1,a.ssao.samples=4,a.ssao.minAngle=0,a.ssao.scale=1;var t=e.assets.find("luck.cube-s32.png");a.colorLUT.texture=t.resource,a.colorLUT.intensity=q.lut?1:0,a.update()}else GameManager.currentCamera.renderPasses=[]},GameManager.freeAssets=function(){var q=GameManager._app;if(!q)return;var e=q.assets.list(),a=0;const t=e.length,n=["container","render","texture","material"];for(;a<t;a++){var i=e[a];if(n.some((q=>q.toLowerCase()===i.type.toLowerCase()))&&i.loaded){for(var A=0;A<i.resources.length;A++)i.resources[A];i.unload()}}},GameManager.showAssetLoader=function(q){GameManager.__assetLoaderTimeout&&clearTimeout(GameManager.__assetLoaderTimeout),GameManager.fadeIn(GameManager.loadingDIV,250,(function(){GameManager.__assetLoaderTimeout=setTimeout((function(){GameManager.fadeOut(GameManager.loadingDIV,250,(function(){}))}),1e3)}))},GameManager.assetLoaded=function(q){GameManager.showAssetLoader(q.name),q.type},GameManager.fadeOut=function(q,e,a){let t=null;const n=parseFloat(window.getComputedStyle(q).opacity),i=n/(e/1e3*60);requestAnimationFrame((function animate(A){t||(t=A);const o=A-t;let c=n-i*o;c=Math.max(c,0),q.style.opacity=c,o<e?requestAnimationFrame(animate):(q.style.display="none","function"==typeof a&&a())}))},GameManager.fadeIn=function(q,e,a){let t=null;const n=parseFloat(window.getComputedStyle(q).opacity),i=(1-n)/(e/1e3*60);q.style.opacity=n,q.style.display="block",requestAnimationFrame((function animate(A){t||(t=A);const o=A-t;let c=n+i*o;c=Math.min(c,1),q.style.opacity=c,o<e?requestAnimationFrame(animate):"function"==typeof a&&a()}))},GameManager.hidesceneloader=function(q){GameManager.fadeOut(GameManager.sceneLoaderDIV,1e3,(function(){"function"==typeof q&&q()}))},GameManager.showsceneloader=function(q,e){GameManager.fadeIn(GameManager.sceneLoaderDIV,1e3,(function(){"function"==typeof e&&e()}))},GameManager.calculateSceneAssets=function(q,e){(function waitForAssetsToLoad(q,e,a){const t=Date.now();return new Promise(((n,i)=>{const checkAssets=()=>{const A=[];q.findComponents("render").filter((q=>"asset"===q.type&&0!==q.materialAssets.length)).forEach((q=>{if(0!==q.asset&&!A.find((e=>e.id===q.asset))){const a=e.assets.get(q.asset);a.loaded||A.push(a)}(Array.isArray(q.material)?q.material:[q.material]).forEach((q=>{const a=q._assetReferences;for(const q in a)if(a.hasOwnProperty(q)){const t=((a[q]||{}).asset||{}).id||0;if(0!==t&&!A.find((q=>q.id===t))){const q=e.assets.get(t);q.loaded||A.push(q)}}}))})),0===A.length?n():Date.now()-t>=a?i(new Error("Tiempo máximo de carga de assets alcanzado.")):setTimeout(checkAssets,100)};checkAssets()}))})(q,GameManager._app,6e4).then((()=>{"function"==typeof e&&e()})).catch((q=>{"function"==typeof e&&e(q)}))},GameManager.showSubtitle=function(q){GameManager.enableSubtitles&&(GameManager.__subtitleTimeout&&clearTimeout(GameManager.__subtitleTimeout),GameManager.subtitleTextDIV.innerHTML=q,GameManager.subtitleBackgroundDIV.style.display="block",GameManager.fadeIn(GameManager.subtitleDIV,250,(function(){GameManager.__subtitleTimeout=setTimeout((function(){GameManager.fadeOut(GameManager.subtitleDIV,1e3,(function(){GameManager.subtitleTextDIV.innerHTML="",GameManager.subtitleBackgroundDIV.style.display="none"}))}),5e3)})))},GameManager.setHudParameter=async function(q,e){const a=GameManager.hudDIV.querySelector("#"+q);a&&requestAnimationFrame((function(){a.innerText=e}))},TracerScript.initialize=function(){TracerScript.div=document.createElement("DIV"),TracerScript.div.id="tracer",TracerScript.div.style.backgroundColor="black",TracerScript.div.style.color="white",TracerScript.div.style.position="absolute",TracerScript.div.style.left="0px",TracerScript.div.style.top="2em",TracerScript.div.style.buttom="2em",document.body.appendChild(TracerScript.div),TracerScript.divValues=document.createElement("DIV"),TracerScript.divValues.id="tracer_values",TracerScript.divValues.style.color="#80FF00",TracerScript.divValues.style.backgroundColor="black",TracerScript.divValues.style.position="absolute",TracerScript.divValues.style.fontFamily="'Courier New', Courier, monospace",TracerScript.divValues.style.backgroundColor="rgba(0, 0, 0, 0.5)",TracerScript.divValues.style.top="2em",TracerScript.divValues.style.buttom="2em",TracerScript.divValues.style.right="0px",TracerScript.divValues.style.left="60%",document.body.appendChild(TracerScript.divValues),TracerScript.trenablelightingdebugLayer&&(GameManager._app.scene.lighting.debugLayer=GameManager._app.scene.layers.getLayerByName("World").id),TracerScript.__tracer_busy=!1},TracerScript.print=async function(q,e){TracerScript.trenable&&(TracerScript.timer&&clearTimeout(TracerScript.timer),TracerScript.timer=setTimeout((function(){TracerScript.tralwaysshow?(TracerScript.div.style.display="block",TracerScript.divValues.style.display="block"):(TracerScript.div.style.display="none",TracerScript.divValues.style.display="none")}),3e3),function esperar(){TracerScript.__tracer_busy?requestAnimationFrame(esperar.bind(this)):(TracerScript.__tracer_busy=!0,"none"===TracerScript.div.style.display?(TracerScript.div.style.display="block",TracerScript.divValues.style.display="block",TracerScript.div.innerHTML=q+""):requestAnimationFrame((function(){if(void 0===e){var a=TracerScript.div.innerHTML.split("<br>");"oldestfirst"===TracerScript.trordermode?(a.unshift(q),a=a.slice(0,25)):"newlestlast"===TracerScript.trordermode&&(a.push(q),a=a.slice(-25)),TracerScript.div.innerHTML=a.join("<br>")}else{TracerScript.linesValues[q||"unnamed"]=e;try{TracerScript.divValues.innerHTML=JSON.stringify(TracerScript.linesValues,null,0).replace(/,/g,"<br>").replace(/{/g,"").replace(/}/g,"")}catch{}}})),TracerScript.__tracer_busy=!1)}())},GameManager.createCircularMenu=function(q){var e=document.getElementById("circle-menu1");if(!e)return;const a=GameManager.menuDIV.getBoundingClientRect();var t=CMenu(e).config({totalAngle:360,spaceDeg:2,background:"#323232",backgroundHover:"#123321",pageBackground:"#0c0c0c",percent:.25,diameter:(a.width||screen.width||600)/4,position:"top",horizontal:!0,start:-45,animation:"into",hideAfterClick:!1,menus:[{title:"resume",icon:"fa fa-circle",click:function(q,e){GameManager.resumeGame()},menus:[{title:"menu1-1",icon:"fa fa-circle"},{title:"menu1-2",icon:"fa fa-cc-visa"}]},{disabled:!0,title:"菜单2",icon:"my-icon icon1",href:"#2"},{title:"menu3",disabled:function(){return!0},icon:"",href:"#3"},{title:"菜单4",icon:"my-icon icon2",href:"#4",menus:[{title:"menu4-1",icon:"fa fa-circle"},{title:"menu4-2",icon:"fa fa-cc-visa"},{title:"menu4-3",icon:"fa fa-cc-visa"},{title:"menu4-1",icon:"fa fa-circle"},{title:"menu4-2",icon:"fa fa-cc-visa"},{title:"menu4-3",icon:"fa fa-cc-visa"}]},{title:"menu5",icon:"",href:"#5",menus:[{title:"menu1-1",icon:"fa fa-circle"},{title:"menu1-2",icon:"fa fa-cc-visa"}]},{title:"菜单6",icon:"",href:"#6",menus:[{title:"menu6-1",icon:"fa fa-circle"}]},{title:"menu7",icon:"my-icon icon3",href:"#7"},{title:"菜单8",icon:"",href:"#8"}]});t.styles({top:"50%",left:"50%"}),t.show()},function(q,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):q.CMenu=e()}(this,(function(){"use strict";function Calculation(q){this._config=q;var e=this.config=q,a=e.menus.length,t=360===e.totalAngle?a:a-1;this.radius=q.diameter/2,this.coverRadius=function coverRadius(q,e){var a=q*q*2;return Math.sqrt(a)*e+3}(this.radius,q.percent),this.clickZoneRadius=this.radius-this.coverRadius,this.listSize=function listSize(q){var e=q.diameter/2+"px";return{width:e,height:e}}(q),this.clickZoneSize=function clickZoneSize(q){var e=q.diameter,a=-q.diameter/2;return{width:e+="px",height:e,marginRight:a+="px",marginBottom:a}}(q),this.menuSize=function menuSize(q){var e=q.diameter,a=-q.diameter/2;return{width:e+="px",height:e,marginLeft:a+="px",marginTop:a}}(q),this.coverSize=function coverSize(q){var e=2*q,a=-e/2;return{width:e+="px",height:e,marginLeft:a+="px",marginTop:a}}(this.coverRadius),this.startDeg=function startDeg(q){var e=-(q.totalAngle-180)/2,a={top:e,left:e-90,right:e+90,bottom:e+180};return void 0!==q.start?q.start:a[q.position]}(q),this.centralDeg=(e.totalAngle-e.spaceDeg*t)/a,this.rotateUnit=this.centralDeg+e.spaceDeg,this.skewDeg=90-this.centralDeg,this.unskewDeg=-(90-this.centralDeg/2),this.textTop=function textTop(q){return.41*q-10+"px"}(this.clickZoneRadius)}function defaultView(q){return q.ownerDocument&&q.ownerDocument.defaultView||q.document&&q||q.defaultView}function styleRemove(q){this.style.removeProperty(q)}function styleConstant(q,e,a){this.style.setProperty(q,e,a)}function styleFunction(q,e,a){var t=e.apply(this,arguments);null==t?this.style.removeProperty(q):this.style.setProperty(q,t,a)}function style(q,e,a,t){var n;return arguments.length>1?(null==a?styleRemove:"function"==typeof a?styleFunction:styleConstant).call(q,e,a,null==t?"":t):defaultView(n=q).getComputedStyle(n,null).getPropertyValue(e)}function classArray(q){return q.trim().split(/^|\s+/)}function classList(q){return q.classList||new ClassList(q)}function ClassList(q){this._node=q,this._names=classArray(q.getAttribute("class")||"")}function classedAdd(q,e){for(var a=classList(q),t=-1,n=e.length;++t<n;)a.add(e[t])}function classedRemove(q,e){for(var a=classList(q),t=-1,n=e.length;++t<n;)a.remove(e[t])}function classedTrue(q){classedAdd(this,q)}function classedFalse(q){classedRemove(this,q)}function classedFunction(q,e){(e.apply(this,arguments)?classedAdd:classedRemove)(this,q)}function classed(q,e,a){var t=classArray(e+"");if(arguments.length<2){for(var n=classList(this),i=-1,A=t.length;++i<A;)if(!n.contains(t[i]))return!1;return!0}("function"==typeof a?classedFunction:a?classedTrue:classedFalse).call(q,t,a)}Calculation.prototype={constructor:Calculation,rotateDeg:function rotateDeg(q){return this.startDeg+this.rotateUnit*q},horizontalDeg:function rotateDeg$1(q){return-(this.rotateDeg(q)+this.unskewDeg)}},ClassList.prototype={add:function(q){this._names.indexOf(q)<0&&(this._names.push(q),this._node.setAttribute("class",this._names.join(" ")))},remove:function(q){var e=this._names.indexOf(q);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(q){return this._names.indexOf(q)>=0}};var q={_current:0,getNew:function(){return this._current++,this._current}};function styleSheet(e,a,t,n){var i=e,A="sheetStyles",o=document.head||document.getElementsByTagName("head")[0],c=document.getElementById(A)||document.createElement("style");c.id=A;var l="s-S"+q.getNew();return i.className+=" "+l,c.innerHTML+=" ."+l+(n?":"+n:"")+"{"+a+":"+t+"}",o.appendChild(c),this}function on(q,e,a,t){q.addEventListener(e,(function(q){a.call(this,q,t)}))}function ifDisabled(q){return q instanceof Function?q():Boolean(q)}var e=null;function hasIcon(q){return void 0!==q&&("string"==typeof q?""!==q:q.length&&""!==q[0])}function extend$1(){var q={},e=!1,a=0,t=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],a++);for(var merge=function(a){for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e&&"[object Object]"===Object.prototype.toString.call(a[t])?q[t]=extend(!0,q[t],a[t]):q[t]=a[t])};a<t;a++){var n=arguments[a];merge(n)}return q}function Creator(q,e){this._cMenu=q,this._container=q._container,this._config=e,this._calc=new Calculation(e),this._anchors=[]}Creator.prototype={constructor:Creator,createMenu:function createMenu(){var q=this._container;classed(q,"circular-menu",!0),style(q,"width",this._calc.menuSize.width),style(q,"height",this._calc.menuSize.height),style(q,"margin-top",this._calc.menuSize.marginTop),style(q,"margin-left",this._calc.menuSize.marginLeft);var e=this;on(q,"click",(function(a){a.toElement===q&&e._cMenu.hide()})),setTimeout((function(){style(q,"display","block")}),100),styleSheet(q,"width",this._calc.coverSize.width,"after"),styleSheet(q,"height",this._calc.coverSize.height,"after"),styleSheet(q,"margin-left",this._calc.coverSize.marginLeft,"after"),styleSheet(q,"margin-top",this._calc.coverSize.marginTop,"after"),styleSheet(q,"border","3px solid "+this._config.pageBackground,"after");var a=q.appendChild(document.createElement("ul"));this._createLists(a)},_createLists:function createLists(q){this._config.menus.forEach((function(e,a){this._createList(q,e,a)}),this)},_createList:function createList(q,e,a){var t=document.createElement("li");t.setAttribute("tabindex","-1"),style(t,"width",this._calc.listSize.width),style(t,"height",this._calc.listSize.height),style(t,"transform","rotate("+this._calc.rotateDeg(a)+"deg) skew("+this._calc.skewDeg+"deg)"),q.appendChild(t),this._createAnchor(t,e,a)},_createAnchor:function createAnchor(q,a,t){var n=this,i=null,A=document.createElement("a");A.setAttribute("tabindex","-1"),function setHref(q,e){e&&(e instanceof Object?(q.href=e.url,q.target=e.blank?"_blank":""):q.href=e)}(A,a.href),A.setDisabled=function(){classed(A,"disabled",ifDisabled(a.disabled))},this._anchors.push(A),style(A,"width",this._calc.clickZoneSize.width),style(A,"height",this._calc.clickZoneSize.height),style(A,"right",this._calc.clickZoneSize.marginRight),style(A,"bottom",this._calc.clickZoneSize.marginBottom),style(A,"transform","skew("+-this._calc.skewDeg+"deg) rotate("+this._calc.unskewDeg+"deg) scale(1)"),classed(A,"disabled",ifDisabled(a.disabled));var o=100*this._config.percent+"%";if(styleSheet(A,"background","radial-gradient(transparent "+o+", "+this._config.background+" "+o+")"),styleSheet(A,"background","radial-gradient(transparent "+o+", "+this._config.backgroundHover+" "+o+")","hover"),on(A,"click",(function clickCallBack(q,e){e.click&&e.click.call(this,q,e),n._config.hideAfterClick&&(n._cMenu.hide(),n._cMenu._pMenu&&n._cMenu._pMenu.hide(),c&&c.hide())}),a),q.appendChild(A),this._createHorizontal(A,a,t),function hasSubMenus(q){return q instanceof Array&&0!==q.length}(a.menus)){var c=this._createSubMenu(n,a.menus,t);on(A,"mouseenter",(function(){e=setTimeout((function(){c.styles({top:n._container.offsetTop+n._calc.radius+"px",left:n._container.offsetLeft+n._calc.radius+"px"}).show()}),150);try{const q=document.getElementById("audio-menu-hover");q.pause(),q.currentTime=0,q.play()}catch{}})),on(A,"mouseleave",(function(q){c._container.contains(q.toElement)||(i=setTimeout((function(){c.hide()}),200))})),on(c._container,"mouseenter",(function(){clearTimeout(e),clearTimeout(i);try{const q=document.getElementById("audio-menu-hover");q.pause(),q.currentTime=0,q.play()}catch{}})),on(c._container,"mouseleave",(function(q){A.contains(q.toElement)&&q.toElement.children[0]!==A||c.hide()}))}},_createText:function createText(q,e,a){var t=document.createElement("span");t.setAttribute("tabindex","-1"),t.textContent=e.title,classed(t,"text",!0),style(t,"margin-top",hasIcon(e.icon)?"3px":this._calc.textTop),style(t,"top",hasIcon(e.icon)?"-3px":0),t.onmouseenter=function(q){const e=document.getElementById("audio-menu-hover");e.currentTime=0,e.play()},q.appendChild(t)},_createHorizontal:function createHorizontal(q,e,a){var t=document.createElement("div");t.setAttribute("tabindex","-1"),classed(t,"horizontal",!0),this._config.horizontal&&style(t,"transform","rotate("+this._calc.horizontalDeg(a)+"deg)"),q.appendChild(t),this._createIcon(t,e,a),this._createText(t,e,a)},_createIcon:function createIcon(q,e,a){if(hasIcon(e.icon)){var t=document.createElement("span");t.setAttribute("tabindex","-1");var n=function getIcon(q){return"string"==typeof q?q:q[0]}(e.icon),i=function getIconColor(q){return"string"==typeof q?null:q[1]}(e.icon);classed(t,n+" cm-icon",!0),style(t,"color",i);var A=.65*this._calc.clickZoneRadius-13+"px",o=.2*this._calc.clickZoneRadius-13+"px";style(t,"width",A),style(t,"height",A),style(t,"font-size",A),style(t,"margin-top",o),t.addEventListener("mouseenter",(function(){const q=document.getElementById("audio-menu-hover");q.currentTime=0,q.play()})),q.appendChild(t)}},_createSubMenu:function createSubMenu(q,e,a){var t=document.createElement("div");t.setAttribute("tabindex","-1"),classed(t,"circular-sub-menu",!0),this._container.parentNode.insertBefore(t,this._container);var n=.618*this._calc.centralDeg*e.length,i=this._calc.rotateDeg(a)-n/2+this._calc.centralDeg/2,A=extend$1(this._config,{totalAngle:n,percent:.45,diameter:1.6666666666666667*this._config.diameter,start:i,animation:"into",menus:e});return new CMenu(t,q._cMenu).config(A)}};const a={totalAngle:360,spaceDeg:2,background:"#323232",backgroundHover:"#515151",pageBackground:"transparent",percent:.25,diameter:300,position:"top",horizontal:!0,animation:"into",hideAfterClick:!0};function setCoordinate(q){q instanceof Array&&2===q.length&&(style(this._container,"left",q[0]+"px"),style(this._container,"top",q[1]+"px"))}function setDisabled(){this._creator._anchors.forEach((function(q){q.setDisabled()}))}function CMenu(q,e){this._container=q,e&&(this._pMenu=e)}return CMenu.prototype={constructor:CMenu,config:function config(q){return q=extend$1(a,q),this._creator=new Creator(this,q),this._creator.createMenu(),this},show:function show(q){return setDisabled.call(this),setCoordinate.call(this,q),classed(this._container,"opened-nav",!0),this},hide:function hide(){return classed(this._container,"opened-nav",!1),this},styles:function styles(q){if(!q instanceof Object)return this;for(var e in q)q.hasOwnProperty(e)&&style(this._container,e,q[e]);return this}},function index(q){return new CMenu("string"==typeof q?document.querySelector(q):q)}}));var GameCharactersController=pc.createScript("gameCharactersController");GameCharactersController.attributes.add("interv",{title:"interv",type:"boolean",default:!0,description:"interv"}),GameCharactersController.prototype.initialize=function(){this.characters=[],this.selectedCharacters=[],this.mousePointer=new pc.Entity,this.mousePointer.addComponent("element",{type:"image",spriteAsset:this.app.assets.find("square_selector","sprite"),pivot:new pc.Vec2(.5,.5),width:1,height:1}),this.app.scene.root.addChild(this.mousePointer),this.mousePointer.setLocalRotation(0,0,0),this.mousePointer.setLocalScale(1,1,1),this.previousX=0,this.previousY=0,this.canvas=this.app.graphicsDevice.canvas,this.jumping_elapsedtime=0,this.jumping_availability=!0,this.updateCharactersMovementStep=0,this.updateCharactersMovementAIStep=[0,0],this.interv&&(this.interval_accumul=1,this.interval_time=1e3/60,this.interval_deltatime=this.interval_time,this.setInterval_busy=!1,Timer.addTimer(.016,this.setInterval,this,!1))},GameCharactersController.prototype.destroy=function(){alert("GameCharactersController destru  ")},GameCharactersController.prototype.setInterval=async function(){if(this.setInterval_busy)this.interval_accumul++;else{this.setInterval_busy=!0;const e=performance.now();this.updateCharactersMovement();const t=performance.now()-e;t>.2&&Tracer("updateCharactersMovement",t),this.interval_accumul=1,this.setInterval_busy=!1}},GameCharactersController.prototype.updateCharactersMovement=async function(){if(this.updateCharactersMovement_busy)console.warn("updateCharactersMovement_busy = true"),Trace("updateCharactersMovement_busy = true");else{this.updateCharactersMovement_busy=!0;const t=this.dividirArray(this.getCharacters())[this.updateCharactersMovementStep]||[],a=t.length;for(var e=0;e<a;e++)if(t[e].enabled){const a=t[e].script.character;if(a){t[e].isPlayer?t[e].input=GameManager.input:(t[e].input.dt=GameManager.input.dt,this.updateCharactersMovementAIStep[this.updateCharactersMovementStep]===e&&a.doAI()),a.doMove();const r=GameManager._app.scene.root;if(r.uranusInstancerCells)for(e=0;e<r.uranusInstancerCells.length;e++)r.uranusInstancerCells[e].entityMoved=!0}}this.updateCharactersMovementAIStep[this.updateCharactersMovementStep]++,this.updateCharactersMovementStep++,this.updateCharactersMovementStep>1&&(this.updateCharactersMovementStep=0),this.updateCharactersMovementAIStep[this.updateCharactersMovementStep]>a&&(this.updateCharactersMovementAIStep[this.updateCharactersMovementStep]=0),this.updateCharactersMovement_busy=!1}},GameCharactersController.prototype.dividirArray=function(e){const t=Math.ceil(e.length/2);return[e.slice(0,t),e.slice(t)]},GameCharactersController.prototype.postUpdate=async function(e){},GameCharactersController.prototype.update=async function(e){this.interv||await this.updateCharactersMovement()},GameCharactersController.prototype.createAudioListener=function(){this.audiolistener||(this.audiolistener=this.app.scene.root.addComponent("audiolistener"))},GameCharactersController.prototype.getCharacters=function(){return this.sceneCharacters||(this.sceneCharacters=this.app.scene.root.children.filter((function(e){return e.isCharacter}))),this.sceneCharacters},GameCharactersController.prototype.getSelectedCharacters=function(){return this.getCharacters().filter((function(e){return e.selected}))},GameCharactersController.prototype.getSelectableCharacters=function(){return this.getCharacters().filter((function(e){return e.isSelectable}))},GameCharactersController.prototype.getMainPlayer=function(e){return this.getCharacters().find((function(e){return e.isPlayer}))},GameCharactersController.prototype.getSceneLights=function(e){if(this.lensflareCamera.enabled){this.lensflareCamera.elapsedTime;for(var t=0,a=this.lensflareCamera.lights.length;t<a;t++){var r=this.lensflareCamera.lights[t];r.lensFlarePlane||(r.lensFlarePlane=new pc.Entity,this.lensflareCamera.material||(this.lensflareCamera.material=new pc.StandardMaterial,this.lensflareCamera.material.name="lensflareMaterial",this.lensflareCamera.material.diffuseMap=this.lensflareCamera.texture.resource,this.lensflareCamera.material.opacityMap=this.lensflareCamera.texture.resource,this.lensflareCamera.material.opacityMapChannel="r",this.lensflareCamera.material.opacity=.8,this.lensflareCamera.material.blendType=pc.BLEND_ADDITIVEALPHA,this.lensflareCamera.material.update()),r.lensFlarePlane.addComponent("element",{type:"image",anchor:[.5,.5,.5,.5],pivot:[.5,.5],width:4,height:4,rect:[0,0,1,1],material:this.lensflareCamera.material,layers:[pc.LAYERID_WORLD]}),this.app.scene.root.addChild(r.lensFlarePlane),r.lensFlarePlane.setPosition(r.getPosition().clone()));var s=this.camera.getRotation();r.lensFlarePlane.setRotation(s)}this.lensflareCamera.elapsedTime+=e,this.lensflareCamera.elapsedTime>=1&&(this.lensflareCamera.elapsedTime=0)}},GameCharactersController.prototype.getYaw=function(e){return Math.atan2(2*(e.w*e.y+e.x*e.z),1-2*(e.y*e.y+e.z*e.z))*(180/Math.PI)};var Character=pc.createScript("character");Character.attributes.add("speed",{type:"number",default:1.5,title:"speed",description:"Velocidad del personaje.",min:1.5,max:2.5,precision:1}),Character.attributes.add("gravity",{type:"number",default:-9.8,title:"gravity",description:"gravity del personaje.",min:-9.8,max:-9.8,precision:1}),Character.attributes.add("isSelectable",{type:"boolean",default:!1}),Character.attributes.add("isPlayer",{type:"boolean",default:!1}),Character.attributes.add("inertia",{type:"boolean",default:!0}),Character.attributes.add("canmoveonair",{type:"boolean",default:!1}),Character.attributes.add("playerOptions",{title:"Player options",type:"json",schema:[{name:"playerControllerOnKeyUP",type:"string",enum:[{MoveForward:"MoveForward"},{Jump:"Jump"}],default:"MoveForward"},{name:"playerControllerOnKeyRight",type:"string",enum:[{Rotate:"Rotate"},{Strafe:"Strafe"}],default:"Rotate"},{name:"rotationEventDelay",title:"rotationEventDelay",type:"number",default:0}]}),Character.attributes.add("ccd",{title:"ccd",type:"json",schema:[{name:"enabled",type:"boolean",default:!0,title:"enabled",description:"enables ccd"},{name:"motionThreshold",type:"number",default:1,title:"Motion Threshold",description:"Number of meters moved in one frame before CCD is enabled"},{name:"sweptSphereRadius",type:"number",default:.2,title:"Swept Sphere Radius",description:"This should be below the half extent of the collision volume. E.g For an object of dimensions 1 meter, try 0.2"},{name:"contactProcessingThreshold",type:"number",default:0,title:"Contact Processing Threshold",description:'The constraint solver can discard solving contacts, if the distance is above this threshold. 0 by default. \n Note that using contacts with positive distance can improve stability. It increases, however, the chance of colliding with degerate contacts, such as "interior" triangle edges'}]}),Character.attributes.add("sensorOptions",{title:"Sensor options",type:"json",schema:[{name:"enabled",type:"boolean",default:!0,title:"enabled",description:"enables sensorOptions"},{name:"sensorDebug",type:"boolean",default:!1},{name:"sensorJumpDebug",type:"boolean",default:!1},{name:"groundtolerance",type:"number",description:"ground tolerance for steps",default:.15,min:.1,max:.5}]}),Character.attributes.add("tracerOptions",{title:"Trace Options",type:"json",schema:[{name:"enabled",type:"boolean",default:!0,title:"enabled",description:"enables Tracer Options"},{name:"traceinput",type:"boolean",default:!1},{name:"tracedetector",type:"boolean",default:!1},{name:"traceplayercapsule",type:"boolean",default:!1},{name:"traceattack",type:"boolean",default:!1}]}),Character.attributes.add("playerAnimationsOptions",{title:"Player Animations Options",type:"json",schema:[{name:"motionrootmode",title:"Motion root mode",type:"string",enum:[{in_place_all_axis:"in_place_all_axis"},{in_place_z_axis:"in_place_z_axis"},{teleport:"teleport"},{none:"none"}],default:"in_place_z_axis"}]}),Character.attributes.add("bones",{title:"bones",type:"json",schema:[{name:"autodetectFromMixamoArmature",type:"boolean",default:!0},{name:"hips",type:"entity",default:null},{name:"leftHand",type:"entity",default:null},{name:"rightHand",type:"entity",default:null},{name:"leftFoot",type:"entity",default:null},{name:"rightFoot",type:"entity",default:null}]}),Character.attributes.add("carryWeapons",{title:"Carry Weapons",type:"json",schema:[{name:"leftHandWeaponEntity",type:"entity",default:null},{name:"rightHandWeaponEntity",type:"entity",default:null}]}),Character.attributes.add("attackSystem",{title:"attackSystem",type:"json",schema:[{name:"canAttack",type:"boolean",default:!0},{name:"walkAndAttack",type:"boolean",default:!1}]});const CharacterLocomotionModeEnum=Object.freeze({UNARMED:0,TORCH:1,ARMED_2W:2});Character.animation_modes=["unarmed","torch","armed_2w"],Character.animation_idles=["idle","idle_searching","idle_examine","idle_resting","idle_hit"],Character.animation_attack=["attack1"],Character.animation_states=["death1","death2","walking","walking_backward","walking_turn_180","running","running_backward","onair","landing","impact_block","impact1","impact2"],Character.animation_custom_states=[];for(var a_s=0;a_s<Character.animation_modes.length;a_s++){for(var modeName=Character.animation_modes[a_s]||"",statesSchema=Character.animation_custom_states.filter((function(t){return t.modeName===modeName})),i=0;i<Character.animation_idles.length;i++)statesSchema.push({name:modeName+"_"+Character.animation_idles[i],type:"asset",assetType:"animation"});for(i=0;i<Character.animation_attack.length;i++)statesSchema.push({name:modeName+"_"+Character.animation_attack[i],type:"asset",assetType:"animation"});for(i=0;i<Character.animation_states.length;i++)statesSchema.push({name:modeName+"_"+Character.animation_states[i],type:"asset",assetType:"animation"});for(i=0;i<statesSchema.length;i++)statesSchema[i].name=modeName+"_"+(statesSchema[i].name||"").replace(modeName+"_",""),statesSchema[i].type="asset",statesSchema[i].assetType="animation";statesSchema.length>0&&Character.attributes.add("animations_"+modeName,{title:"Animations "+modeName,type:"json",schema:statesSchema})}const CharacterAttackSystemStatusEnum=Object.freeze({NONE:0,ATTACKING:1,DAMAGING:2,ENDING:3});Character.prototype.initialize=function(){if(this.entity.isCharacter=!0,this.entity.isCharacter&&this.entity.tags.add("is-character"),this.entity.isPlayer=this.isPlayer,this.entity.isPlayer&&this.entity.tags.add("is-player"),this.entity.isSelectable=this.isSelectable,this.entity.isSelectable&&this.entity.tags.add("is-selectable"),this.entity.selected=this.entity.isPlayer,this.entity.tags.add("is-detectable"),this.entity.input=Object.assign({},GameManager.input),this.entity.input.targetEntity=null,this.pointCharacterEntity=new pc.Entity,this.pointCharacterEntity.name=(this.entity.isPlayer?"player-":"")+"point-character-entity",this.pointCharacterEntity.tags.add(this.pointCharacterEntity.name),this.app.scene.root.addChild(this.pointCharacterEntity),this.doMoveCharacter_busy=!1,this.doAICharacter_busy=!1,this.CHAR_CUR_POSITION=this.entity.getPosition(),this.CHAR_CUR_ROTATION=this.entity.getRotation(),this.CHAR_LAST_POSITION=this.CHAR_CUR_POSITION.clone(),this.currenRotation=0,this.detectedEntities=[],this.sensorOptions.all_detectableEntities=[],this.sensorOptions.all_detectableEntities_length=0,this.renderCharacterComponent=this.entity.findComponent("render"),this.entity.renderCharacterComponent=this.renderCharacterComponent,this.renderCharacterComponent?(this.renderCharacterComponent.entity.tags.add("uranus-instancing-exclude"),this.meshInstancesCharacter=(this.renderCharacterComponent.meshInstances||[])[0]||{visibleThisFrame:!1}):this.meshInstancesCharacter={visibleThisFrame:!0},this.jumping_availability=!0,this.animPlayerStateGraphData=null,this.animatorTargetReached=!0,this.animatorCurrentAnimId=0,this.entity.attackSystem={canAttack:this.attackSystem.canAttack,walkAndAttack:this.attackSystem.walkAndAttack,status:CharacterAttackSystemStatusEnum.NONE,attackInput:!1,attackInputOld:!1,canDoAttack:!0,__elapsedTime:0},this.entity.collisionBones={leftFootCollision:new pc.Entity(this.entity.name+"_leftFootCollision"),rightFootCollision:new pc.Entity(this.entity.name+"_rightFootCollision"),leftFoot:this.entity.findByName("mixamorig:LeftFoot"),rightFoot:this.entity.findByName("mixamorig:RightFoot")},!this.bones.hips&&this.bones.autodetectFromMixamoArmature&&(this.bones.hips=this.entity.findByName("mixamorig:Hips")),!this.bones.leftHand&&this.bones.autodetectFromMixamoArmature&&(this.bones.leftHand=this.entity.findByName("mixamorig:LeftHand")),!this.bones.rightHand&&this.bones.autodetectFromMixamoArmature&&(this.bones.rightHand=this.entity.findByName("mixamorig:RightHand")),!this.bones.leftFoot&&this.bones.autodetectFromMixamoArmature&&(this.bones.leftFoot=this.entity.findByName("mixamorig:LeftFoot")),!this.bones.rightFoot&&this.bones.autodetectFromMixamoArmature&&(this.bones.rightFoot=this.entity.findByName("mixamorig:RightFoot")),this.bones.hips&&(this.playerAnimationsOptions.startPosition=this.bones.hips.getLocalPosition().clone()),this.motionrootmode=this.playerAnimationsOptions.motionrootmode,this.renderCharacterComponent&&(this.renderCharacterComponent.rootBone=this.bones.hips),this.characterHeight=1.8,this.characterRadius=.35,this.entity.collision||this.entity.addComponent("collision",{type:"compound"}),this.entity.capsule_collision=new pc.Entity(this.entity.name+"_capsule_collision"),this.entity.capsule_collision.tags.add("uranus-instancing-exclude"),this.entity.capsule_collision.addComponent("collision",{type:"capsule",radius:this.characterRadius,height:this.characterHeight}),this.entity.addChild(this.entity.capsule_collision),this.entity.collision.on("collisionstart",this.characterCollisionStart,this),this.entity.collision.on("collisionend",this.characterCollisionEnd,this),this.entity.other=null,this.entity.isonair=!1,this.entity.isonground=!0,this.tracerOptions.traceplayercapsule){const t=new pc.StandardMaterial;t.diffuse=new pc.Color(1,0,0),t.update();const e=pc.Mesh.fromGeometry(this.app.graphicsDevice,new pc.CapsuleGeometry({radius:this.characterRadius,height:this.characterHeight})),a=new pc.MeshInstance(e,t);a.renderStyle=pc.RENDERSTYLE_WIREFRAME;const n=new pc.Model;n.graph=new pc.GraphNode,n.meshInstances=[a],this.entity.capsule_collision.addComponent("render",{type:"asset",renderStyle:pc.RENDERSTYLE_WIREFRAME,material:t}),this.entity.capsule_collision.render.meshInstances=n.meshInstances}if(this.sensorOptions.processstep=0,this.sensorOptions.groundProcessstep=0,this.mantleHeight=.9,!this.entity.rigidbody){this.entity.addComponent("rigidbody",{type:"dynamic",mass:90,friction:1,restitution:0,linearDamping:0,angularDamping:0,linearFactor:new pc.Vec3(1,1,1),angularFactor:new pc.Vec3(0,0,0)})}var t;this.ccd.enabled&&((t=this.entity.rigidbody.body).setCcdMotionThreshold(this.ccd.motionThreshold),t.setCcdSweptSphereRadius(this.ccd.sweptSphereRadius),t.setContactProcessingThreshold(this.ccd.contactProcessingThreshold)),this.prepareAnimComponent(),this.entity.on("character:detector",(function(t){if(this.tracerOptions.tracedetector){var e=[];e.push(""+t.length);for(var a=0;a<t.length;a++)e.push(t[a].name);Trace("detectedEntities",e)}for(a=0;a<t.length;a++);}),this),this.vec=new pc.Vec3,this.vec2=new pc.Vec3,this.vec3=new pc.Vec3,this.quat=new pc.Quat,this.entity.mode=CharacterLocomotionModeEnum.UNARMED,this.old_input=Object.assign({},this.entity.input),this.on("destroy",(function(){this.entity.collision.off("collisionstart",this.characterCollisionStart),this.entity.collision.off("collisionend",this.characterCollisionEnd)}),this),this.entity.on("destroy",(function(){}),this),this.prevtracerOptions=JSON.parse(JSON.stringify(this.tracerOptions)),this.on("attr:tracerOptions",(function(t){t.enabled,this.prevtracerOptions.enabled,this.entity.capsule_collision.render.enabled=!!t.enabled&&t.traceplayercapsule,this.prevtracerOptions=JSON.parse(JSON.stringify(this.tracerOptions))}),this)},Character.prototype.getYaw=function(t){return Math.atan2(2*(t.w*t.y+t.x*t.z),1-2*(t.y*t.y+t.z*t.z))*(180/Math.PI)},Character.prototype.stopMovement=function(){this.entity.rigidbody.linearVelocity=new pc.Vec3(0,this.entity.rigidbody.linearVelocity.y,0)},Character.prototype.doAI=async function(){if(!this.doAICharacter_busy){this.doAICharacter_busy=!0;const t=this.entity.script.characterNpc;t&&t.doAI(),this.doAICharacter_busy=!1}},Character.prototype.doMove=async function(){if(!this.doMoveCharacter_busy){this.doMoveCharacter_busy=!0;const o=this.entity.input;var t=o.dt;this.CHAR_CUR_POSITION=this.entity.getPosition(),this.CHAR_CUR_ROTATION=this.entity.getRotation(),this.pointCharacterEntity.setPosition(this.CHAR_CUR_POSITION);const s=this.meshInstancesCharacter.visibleThisFrame;if(this.entity.anim.enabled=s,s&&this.doSensors2(),!s)return void(this.doMoveCharacter_busy=!1);if(this.tracerOptions.traceinput&&this.entity.isPlayer){const t=Object.assign({},o);delete t.camera,t.camera=null,Trace("input",t)}this.entity.isPlayer;var e=null;if(this.entity.isPlayer)e=o.camera.entity;else if(e=o.targetEntity){const t=e.getPosition().clone().sub(this.CHAR_CUR_POSITION).normalize();o.x=t.x,o.x<.1&&o.x>-.1&&(o.x=0),o.z=-t.z,o.z<.1&&o.z>-.1&&(o.z=0)}else o.z=0,o.x=0;"Strafe"===this.playerOptions.playerControllerOnKeyRight&&(0!==o.x&&(o.z=0),0!==o.z&&(o.x=0));var a=o.sprint?2*this.speed:this.speed;if(this.isMoving=0!==o.x||0!==o.z,!this.isMoving&&(a=0),this.charSpeed<a-.1?this.charSpeed=pc.math.lerp(this.charSpeed,a,t*this.speed*4):this.charSpeed=a,this.speedAnimBlend=o.sprint?a/this.speed*5:a/this.speed-.3,this.speedAnimBlend<.01&&(this.speedAnimBlend=0),this.entity.attackSystem.canAttack&&!this.entity.attackSystem.walkAndAttack&&this.entity.attackSystem.status!==CharacterAttackSystemStatusEnum.NONE&&(this.isMoving=!1),this.isMoving=this.isMoving&&0===this.entity.anim.getInteger("turn180"),this.isMoving&&!this.canmoveonair&&this.entity.isonair&&(this.isMoving=!1),this.isMoving){var n=this.CHAR_CUR_POSITION.clone();const a=e.forward.clone().scale(o.z).normalize(),r=e.right.clone().scale(o.x).normalize(),c=a.add(r).normalize();if(this.canmoveonair||(c.y=0),!this.useteleport&&s){const t=c.clone().scale(this.charSpeed);this.entity.rigidbody.linearVelocity=t}n=n.add(c.scale(this.charSpeed*t)),this.calculateCharacterCurrentRotation(o,this.old_input,e,4*this.speed*t),this.useteleport?this.entity.rigidbody.teleport(n,(new pc.Quat).setFromEulerAngles(0,this.currenRotation,0)):this.entity.rigidbody.teleport(this.entity.getPosition(),(new pc.Quat).setFromEulerAngles(0,this.currenRotation,0))}if(s){if(!this.useteleport&&!this.isMoving&&!this.inertia){const t=this.entity.rigidbody.linearVelocity;t.x=0,t.z=0,this.canmoveonair&&!this.isonair&&(t.y=0),this.entity.rigidbody.linearVelocity=t}this.doInteraction(o),this.entity.anim.setInteger("mode",+o.mode),this.entity.anim.setFloat("speed",this.speedAnimBlend),this.entity.anim.setInteger("onair",+this.entity.isonair),this.entity.anim.setInteger("impact",o.impact?Math.floor(2*Math.random())+1:0),this.entity.anim.setInteger("death",o.death?Math.floor(2*Math.random())+1:0),this.doAttackSystem(o)}this.old_input=Object.assign({},o),this.doMoveCharacter_busy=!1}},Character.prototype.doCarryWeapons=async function(){function setDefRigidBodyValues(t){t&&(t.entity.tags.add("uranus-instancing-exclude"),t.entity.tags.add("ignore-camera-collision"),t.restitution=0,t.friction=1)}if(this.bones.leftHand){if(this.carryWeapons.leftHandWeaponEntity){if(this.carryWeapons.leftHandWeaponEntity.setPosition(this.bones.leftHand.getPosition()),this.carryWeapons.leftHandWeaponEntity.setRotation(this.bones.leftHand.getRotation()),(this.carryWeapons.leftHandWeaponEntity._guid||"0")!==(this.carryWeapons.leftHandWeaponEntityOld||{})._guid)this.entity.attackSystem.leftHandWeaponRigidBody=this.carryWeapons.leftHandWeaponEntity.findComponent("rigidbody"),setDefRigidBodyValues(this.entity.attackSystem.leftHandWeaponRigidBody),(t=this.carryWeapons.leftHandWeaponEntity.findComponent("collision"))&&(t.entity.tags.add("is-taken"),t.on("triggerenter",this.onCollisionStartLeftWeapon,this),t.on("triggerleave",this.onCollisionEndLeftWeapon,this))}else if(this.carryWeapons.leftHandWeaponEntityOld)this.entity.attackSystem.leftHandWeaponRigidBody=null,(t=this.carryWeapons.leftHandWeaponEntityOld.findComponent("collision"))&&(t.entity.tags.remove("is-taken"),t.off("triggerenter",this.onCollisionStartLeftWeapon),t.off("triggerleave",this.onCollisionEndLeftWeapon));this.carryWeapons.leftHandWeaponEntityOld=this.carryWeapons.leftHandWeaponEntity}if(this.bones.rightHand){if(this.carryWeapons.rightHandWeaponEntity){if(this.carryWeapons.rightHandWeaponEntity.setPosition(this.bones.rightHand.getPosition()),this.carryWeapons.rightHandWeaponEntity.setRotation(this.bones.rightHand.getRotation()),(this.carryWeapons.rightHandWeaponEntity._guid||"0")!==(this.carryWeapons.rightHandWeaponEntityOld||{})._guid){var t,e=this.carryWeapons.rightHandWeaponEntity.findComponent("render");if(e){var a=new pc.Quat;a.setFromEulerAngles(0,-90,0),e.entity.setRotation(a)}this.entity.attackSystem.rightHandWeaponRigidBody=this.carryWeapons.rightHandWeaponEntity.findComponent("rigidbody"),setDefRigidBodyValues(this.entity.attackSystem.rightHandWeaponRigidBody),(t=this.carryWeapons.rightHandWeaponEntity.findComponent("collision"))&&(t.entity.tags.add("is-taken"),t.on("triggerenter",this.onCollisionStartRightWeapon,this),t.on("triggerleave",this.onCollisionEndRightWeapon,this))}}else if(this.carryWeapons.rightHandWeaponEntityOld)this.entity.attackSystem.rightHandWeaponRigidBody=null,(t=this.carryWeapons.rightHandWeaponEntityOld.findComponent("collision"))&&(t.entity.tags.remove("is-taken"),t.off("triggerenter",this.onCollisionStartRightWeapon),t.off("triggerleave",this.onCollisionEndRightWeapon));this.carryWeapons.rightHandWeaponEntityOld=this.carryWeapons.rightHandWeaponEntity}},Character.prototype.onCollisionStartRightWeapon=function(t){this.onCollisionStartWeapon(t,"right")},Character.prototype.onCollisionEndRightWeapon=function(t){},Character.prototype.onCollisionStartLeftWeapon=function(t){this.onCollisionStartWeapon(t,"left")},Character.prototype.onCollisionEndLeftWeapon=function(t){},Character.prototype.onCollisionStartWeapon=function(t,e){if(this.entity.attackSystem.status===CharacterAttackSystemStatusEnum.DAMAGING){if(this.entity.isPlayer&&t.isPlayer)return;t.isCharacter&&console.log("DAMAGIN CHARACTER !!!")}},Character.prototype.doSensorCollisions=function(){},Character.prototype.doAttackSystem=function(t){if(this.entity.attackSystem.canAttack&&(this.entity.attackSystem.attackInput=t.attack||t.mousePrimaryButton,this.entity.attackSystem.attackInput===this.entity.attackSystem.attackInputOld?this.entity.attackSystem.status!==CharacterAttackSystemStatusEnum.NONE&&(this.entity.attackSystem.__elapsedTime+=t.dt):this.entity.attackSystem.attackInput?this.entity.attackSystem.canDoAttack&&(this.entity.attackSystem.__elapsedTime=0,this.entity.attackSystem.canDoAttack=!1,this.entity.attackSystem.status=CharacterAttackSystemStatusEnum.ATTACKING,Timer.addTimer(.1,(function(){this.entity.attackSystem.canDoAttack=!0}),this,!0)):(this.entity.attackSystem.canDoAttack=!0,this.entity.attackSystem.status=CharacterAttackSystemStatusEnum.NONE,this.entity.attackSystem.__elapsedTime=0),this.entity.attackSystem.__elapsedTime>=2&&(this.entity.attackSystem.__elapsedTime=0,this.entity.attackSystem.status=CharacterAttackSystemStatusEnum.NONE),this.entity.attackSystem.attackAction=0,this.entity.attackSystem.status!==CharacterAttackSystemStatusEnum.NONE&&(this.entity.attackSystem.attackAction=1),this.entity.attackSystem.status===CharacterAttackSystemStatusEnum.NONE&&(this.entity.attackSystem.attackAction=0),this.entity.anim.setInteger("attack",this.entity.attackSystem.attackAction),this.entity.attackSystem.attackInputOld=this.entity.attackSystem.attackInput,this.entity.attackSystem.attackActionOld=this.entity.attackSystem.attackAction,this.tracerOptions.traceattack&&this.entity.isPlayer)){const t=Object.assign({},this.entity.attackSystem);t.rightHandWeaponRigidBody=null,t.leftHandWeaponRigidBody=null,delete t.rightHandWeaponRigidBody,delete t.leftHandWeaponRigidBody,Trace("attackSystem",t)}},Character.prototype.calculateCharacterCurrentRotation=function(t,e,a,n){var o=this;var s=function calculateAngle(t,e){var n=0;if("Rotate"===o.playerOptions.playerControllerOnKeyRight&&(0!==t||0!==e)){const a=Math.atan2(e,t)*pc.math.RAD_TO_DEG;n=45*Math.round(a/45)-90}const s=new pc.Vec3(-a.forward.x,0,-a.forward.z).normalize();return Math.atan2(s.x,s.z)*pc.math.RAD_TO_DEG+n}(t.x,t.z);Math.abs((s-this.currenRotation+180)%360-180)>=181&&(this.currenRotation=s),this.currenRotation=pc.math.lerpAngle(this.currenRotation,s,n||.2)};const CharacterLocomotionEnum=Object.freeze({IDLE:0,FORWARD:1,BACKWARD:2,RIGHT:3,LEFT:4,FORWARDRIGHT:5,FORWARDLEFT:6,BACKWARDRIGHT:7,BACKWARDLEFT:8});Character.prototype.doCalculateLocomotionDirection=function(t){var e=CharacterLocomotionEnum.IDLE,a=new pc.Vec3;a.sub2(this.CHAR_CUR_POSITION.clone(),this.CHAR_LAST_POSITION.clone());if(a.length()<.001)e=CharacterLocomotionEnum.IDLE;else{a.normalize();var n=this.entity.forward.clone().normalize(),o=(a.length(),a.dot(n),a.length(),(Math.atan2(a.z,a.x)-Math.atan2(n.z,n.x))*(180/Math.PI));o>180?o-=360:o<-180&&(o+=360),e=Math.abs(o)<=22.5||Math.abs(o)>=337.5?CharacterLocomotionEnum.FORWARD:Math.abs(o-180)<=22.5||Math.abs(o+180)<=22.5?CharacterLocomotionEnum.BACKWARD:Math.abs(o-90)<=22.5||Math.abs(o+270)<=22.5?CharacterLocomotionEnum.RIGHT:Math.abs(o+90)<=22.5||Math.abs(o-270)<=22.5?CharacterLocomotionEnum.LEFT:Math.abs(o-45)<=22.5||Math.abs(o+315)<=22.5?CharacterLocomotionEnum.FORWARDRIGHT:Math.abs(o+45)<=22.5||Math.abs(o-315)<=22.5?CharacterLocomotionEnum.FORWARDLEFT:Math.abs(o+135)<=22.5||Math.abs(o-225)<=22.5?CharacterLocomotionEnum.BACKWARDRIGHT:Math.abs(o-135)<=22.5||Math.abs(o+225)<=22.5?CharacterLocomotionEnum.BACKWARDLEFT:CharacterLocomotionEnum.IDLE}return e},Character.prototype.createAnimator=function(t,e,a,n,o){this.animatorAnimForce=a??null,this.animatorElapsedTime=0,this.animatorTargetForwardVector=t,this.animatorDuration=e,this.animatorTargetReached=!1,this.animatorSpeed=n??2*this.speed,this.animatorRestoreToRigidBodyType=this.entity.rigidbody.type,this.entity.rigidbody.type=o??this.animatorRestoreToRigidBodyType},Character.prototype.destroyAnimator=function(){this.animatorTargetReached=!0,this.animatorElapsedTime=0,this.animatorSpeed=0,this.entity.rigidbody.type=this.animatorRestoreToRigidBodyType,this.animatorAnimForce=null,this.animatorAnimMotionRootMode=null},Character.prototype.doCalculateAnimation=function(t,e){},Character.prototype.characterCollisionStart=function(t){this.entity.other=t.other},Character.prototype.characterCollisionEnd=function(t){this.entity.other===t&&(this.entity.other=null)},Character.prototype.doSensors2=function(){var t=0,e=null;if(this.entity.isonair){t=-(this.characterHeight/2+.2);const n=this.entity.getPosition(),o=n.clone().add(new pc.Vec3(0,t,0));var a=this.app.systems.rigidbody.raycastFirst(n,o,{lowResolution:!0});this.sensorOptions.sensorDebug&&this.app.drawLine(n,o,a?pc.Color.RED:pc.Color.GREEN,5),e=!!a}else{t=-this.characterRadius;const a=this.bones.leftFoot?this.bones.leftFoot.getPosition():this.entity.getPosition(),s=a.clone().add(new pc.Vec3(0,t,0));var n=this.app.systems.rigidbody.raycastFirst(a,s,{lowResolution:!0});this.sensorOptions.sensorDebug&&this.app.drawLine(a,s,n?pc.Color.RED:pc.Color.GREEN,5);const r=this.bones.rightFoot?this.bones.rightFoot.getPosition():a,c=r.clone().add(new pc.Vec3(0,t,0));var o=this.app.systems.rigidbody.raycastFirst(r,c,{lowResolution:!0});this.sensorOptions.sensorDebug&&this.app.drawLine(r,c,o?pc.Color.RED:pc.Color.GREEN,5),e=!(!n&&!o)}if(this.entity.isonground=e,this.entity.isonair=!e,!e){const t=.3;this.entity.rigidbody.linearVelocity.y<=-t?(this.entity.isonground=!1,this.entity.isonair=!0):(this.entity.isonground=!0,this.entity.isonair=!1)}},Character.prototype.doSensors=function(){},Character.prototype.sensorTrace=function(){this.sensorOptions.sensorDebug&&(Trace("sensorRight ",(this.entity.sensorRightEntity??{}).name??""),Trace("sensorLeft  ",(this.entity.sensorLeftEntity??{}).name??""),Trace("sensorTop   ",(this.entity.sensorTopEntity??{}).name??""),Trace("sensorBottom",(this.entity.sensorBottomEntity??{}).name??""),Trace("sensorFront ",(this.entity.sensorFrontEntity??{}).name??""),Trace("sensorBack  ",(this.entity.sensorBackEntity??{}).name??""))},Character.prototype.sensorToeBaseCollisionStartEvent=function(t){alert("sensorToeBaseCollisionStartEvent = "+t.name)},Character.prototype.doInteraction=function(t){if(t.interact){var e=0;const t=this.detectedEntities.length;for(;e<t;e++)this.detectedEntities[e]}},Character.prototype.update=function(t){},Character.prototype.postUpdate=function(t){this.rootMotionFix(),this.doSensorCollisions(),this.doCarryWeapons();this.entity.rigidbody.linearVelocity;this.CHAR_LAST_POSITION=this.CHAR_CUR_POSITION},Character.prototype.rootMotionFix=function(){if("in_place_z_axis"===this.motionrootmode&&this.bones.hips){var t=this.bones.hips.getLocalPosition();if(t=new pc.Vec3(t.x,t.y,this.playerAnimationsOptions.startPosition.z??0),this.bones.hips.setLocalPosition(t),isTurning180=0!==this.entity.anim.getInteger("turn180"),isTurning180){var e=this.bones.hips.getLocalRotation();e=new pc.Quat(e.x,0,e.z,e.w),this.bones.hips.setLocalRotation(e)}}"in_place_all_axis"===this.motionrootmode&&this.bones.hips?.setLocalPosition(this.playerAnimationsOptions.startPosition),this.animatorAnimMotionRootMode?this.motionrootmode=this.animatorAnimMotionRootMode:this.motionrootmode!==this.playerAnimationsOptions.motionrootmode&&(this.bones.hips?.setLocalPosition(this.playerAnimationsOptions.startPosition),this.motionrootmode=this.playerAnimationsOptions.motionrootmode)},Character.prototype.prepareAnimComponent=function(){pc.ANIM_GREATER_THAN,pc.ANIM_LESS_THAN,pc.ANIM_GREATER_THAN,pc.ANIM_LESS_THAN,pc.ANIM_GREATER_THAN_EQUAL_TO,pc.ANIM_EQUAL_TO,pc.ANIM_EQUAL_TO,pc.ANIM_LESS_THAN,pc.ANIM_EQUAL_TO,pc.ANIM_GREATER_THAN,pc.ANIM_EQUAL_TO,pc.ANIM_GREATER_THAN,pc.ANIM_PARAMETER_FLOAT,pc.ANIM_PARAMETER_INTEGER,pc.ANIM_PARAMETER_BOOLEAN,pc.ANIM_PARAMETER_BOOLEAN,pc.ANIM_PARAMETER_BOOLEAN,pc.ANIM_PARAMETER_BOOLEAN,pc.ANIM_PARAMETER_BOOLEAN;this.animPlayerStateGraphData={layers:[{name:"baseLayer",states:[{name:"START"},{name:"ANY"}],transitions:[]}],parameters:{mode:{name:"mode",type:pc.ANIM_PARAMETER_INTEGER,value:0},idle:{name:"idle",type:pc.ANIM_PARAMETER_INTEGER,value:0},speed:{name:"speed",type:pc.ANIM_PARAMETER_FLOAT,value:0},turn180:{name:"turn180",type:pc.ANIM_PARAMETER_INTEGER,value:0},impact:{name:"impact",type:pc.ANIM_PARAMETER_INTEGER,value:0},death:{name:"death",type:pc.ANIM_PARAMETER_INTEGER,value:0},onair:{name:"onair",type:pc.ANIM_PARAMETER_INTEGER,value:0},landing:{name:"landing",type:pc.ANIM_PARAMETER_INTEGER,value:0},attack:{name:"attack",type:pc.ANIM_PARAMETER_INTEGER,value:0}}};const t=["death","landing"],e=Character.animation_modes.length;for(var a=0;a<e;a++){const e=this["animations_"+Character.animation_modes[a]],o=Object.keys(e),s=o.length;for(var n=0;n<s;n++){const a=o[n];if(e[a]){e[a].preload=!0;const n=!t.some((t=>a.includes(t)));this.animPlayerStateGraphData.layers[0].states.push({name:a,loop:n,assetId:e[a].id})}}}for(a=0;a<e;a++){const t=Character.animation_modes[a];var o=Character.animation_idles;for(n=0;n<o.length;n++)this["animations_"+t][t+"_"+o[n]]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"START",to:t+"_"+o[n],time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"idle",predicate:pc.ANIM_EQUAL_TO,value:n}]});for(n=0;n<o.length;n++){const e=this.animPlayerStateGraphData.layers[0].states.find((function(e){return e.name===t+"_"+o[n]}));0!==n&&e&&this.animPlayerStateGraphData.layers[0].transitions.push({from:t+"_"+o[n],to:t+"_"+o[n-1],time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:0},{parameterName:"idle",predicate:pc.ANIM_EQUAL_TO,value:n-1}]})}if(this["animations_"+t][t+"_walking"]){for(n=0;n<o.length;n++){this.animPlayerStateGraphData.layers[0].states.find((function(e){return e.name===t+"_"+o[n]}))&&this.animPlayerStateGraphData.layers[0].transitions.push({from:t+"_"+o[n],to:t+"_walking",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"speed",predicate:pc.ANIM_GREATER_THAN,value:0}]},{from:t+"_walking",to:t+"_"+o[n],time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"idle",predicate:pc.ANIM_EQUAL_TO,value:n},{parameterName:"speed",predicate:pc.ANIM_LESS_THAN,value:.01}]})}this["animations_"+t][t+"_walking_turn_180"]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_walking_turn_180",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"speed",predicate:pc.ANIM_GREATER_THAN,value:0},{parameterName:"speed",predicate:pc.ANIM_LESS_THAN_EQUAL_TO,value:.99},{parameterName:"turn180",predicate:pc.ANIM_EQUAL_TO,value:1}]},{from:t+"_walking_turn_180",to:t+"_walking",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"speed",predicate:pc.ANIM_GREATER_THAN,value:0},{parameterName:"speed",predicate:pc.ANIM_LESS_THAN_EQUAL_TO,value:.99},{parameterName:"turn180",predicate:pc.ANIM_EQUAL_TO,value:0}]})}if(this["animations_"+t][t+"_running"]){this["animations_"+t][t+"_walking"]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:t+"_walking",to:t+"_running",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"speed",predicate:pc.ANIM_GREATER_THAN,value:.99}]},{from:t+"_running",to:t+"_walking",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"speed",predicate:pc.ANIM_LESS_THAN,value:1}]});for(n=0;n<o.length;n++){this.animPlayerStateGraphData.layers[0].states.find((function(e){return e.name===t+"_"+o[n]}))&&this.animPlayerStateGraphData.layers[0].transitions.push({from:t+"_"+o[n],to:t+"_running",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"speed",predicate:pc.ANIM_GREATER_THAN_EQUAL_TO,value:1}]},{from:t+"_running",to:t+"_"+o[n],time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"idle",predicate:pc.ANIM_EQUAL_TO,value:n},{parameterName:"speed",predicate:pc.ANIM_LESS_THAN,value:.01}]})}}this["animations_"+t][t+"_impact_block"]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_impact_block",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"impact",predicate:pc.ANIM_EQUAL_TO,value:1}]},{from:t+"_impact_block",to:t+"_idle",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"impact",predicate:pc.ANIM_EQUAL_TO,value:0}]});for(n=1;n<3;n++)this["animations_"+t][t+"_impact"+n]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_impact"+n,time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"impact",predicate:pc.ANIM_EQUAL_TO,value:n+1}]},{from:t+"_impact"+n,to:t+"_idle",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"impact",predicate:pc.ANIM_EQUAL_TO,value:0}]});this["animations_"+t][t+"_onair"]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_onair",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"onair",predicate:pc.ANIM_EQUAL_TO,value:1}]},{from:t+"_onair",to:t+"_idle",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"onair",predicate:pc.ANIM_EQUAL_TO,value:0}]}),this["animations_"+t][t+"_landing"]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_landing",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"landing",predicate:pc.ANIM_EQUAL_TO,value:1}]},{from:t+"_landing",to:t+"_idle",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"landing",predicate:pc.ANIM_EQUAL_TO,value:0}]}),this["animations_"+t][t+"_impact_block"]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_impact_block",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"impact",predicate:pc.ANIM_EQUAL_TO,value:1}]},{from:t+"_impact_block",to:t+"_idle",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"impact",predicate:pc.ANIM_EQUAL_TO,value:0}]});for(n=0;n<Character.animation_attack.length;n++)this["animations_"+t][t+"_"+Character.animation_attack[n]]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:"ANY",to:t+"_"+Character.animation_attack[n],time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"attack",predicate:pc.ANIM_EQUAL_TO,value:n+1}]},{from:t+"_"+Character.animation_attack[n],to:t+"_idle",time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a},{parameterName:"attack",predicate:pc.ANIM_EQUAL_TO,value:0}]})}for(a=0;a<e;a++){const t=Character.animation_modes[a],e=Character.animation_modes[a+1],o=this["animations_"+t],s=Object.keys(o),r=s.length;for(n=0;n<r;n++){const o=(s[n]||"").replace(t+"_","");this["animations_"+t][t+"_"+o]&&this["animations_"+e][e+"_"+o]&&this.animPlayerStateGraphData.layers[0].transitions.push({from:t+"_"+o,to:e+"_"+o,time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a+1}]},{from:e+"_"+o,to:t+"_"+o,time:.2,priority:0,conditions:[{parameterName:"mode",predicate:pc.ANIM_EQUAL_TO,value:a}]})}}this.entity.addComponent("anim",{activate:!0,rootBone:this.playerAnimationsOptions.hips&&this.playerAnimationsOptions.hips}),this.entity.anim.loadStateGraph(this.animPlayerStateGraphData);const s=this.entity.anim.baseLayer,r=this.animPlayerStateGraphData.layers[0].states,c=r.length;for(n=0;n<c;n++){const t=r[n];if("START"!==t.name&&"END"!==t.name&&"ANY"!==t.name){var h=this.app.assets.get(r[n].assetId);h&&"animation"===h.type&&(h.resource?(s.assignAnimation(t.name,h.resource),t.animDuration=h.resource.duration,-1!==t.name.indexOf("attack")&&(h.resource.events=new pc.AnimEvents([{time:h.resource.duration,name:"attack-end-animation"},{time:1e3*h.resource.duration/4/1e3,name:"attack-start-damage-animation"},{time:3*h.resource.duration*1e3/4/1e3,name:"attack-end-damage-animation"}]))):(h.ready(function(e){s.assignAnimation(t.name,e.resource),t.animDuration=e.resource.duration,-1!==t.name.indexOf("attack")&&(e.resource.events=new pc.AnimEvents([{time:e.resource.duration,name:"attack-end-animation"},{time:1e3*e.resource.duration/4/1e3,name:"attack-start-damage-animation"},{time:3*h.resource.duration*1e3/4/1e3,name:"attack-end-damage-animation"}]))}.bind(this)),this.app.assets.load(h)))}}this.entity.anim.on("attack-end-animation",(function(t){this.entity.attackSystem.status=CharacterAttackSystemStatusEnum.NONE}),this),this.entity.anim.on("attack-start-damage-animation",(function(t){this.entity.attackSystem.status!==CharacterAttackSystemStatusEnum.NONE&&(this.entity.attackSystem.status=CharacterAttackSystemStatusEnum.DAMAGING)}),this),this.entity.anim.on("attack-end-damage-animation",(function(t){this.entity.attackSystem.status!==CharacterAttackSystemStatusEnum.NONE&&(this.entity.attackSystem.status=CharacterAttackSystemStatusEnum.ENDING)}),this)};var CharacterNpc=pc.createScript("characterNpc");CharacterNpc.attributes.add("targetEntity",{type:"entity",title:"Target Entity"}),CharacterNpc.attributes.add("activateDistance",{type:"number",default:10,title:"Activate Distance"}),CharacterNpc.attributes.add("patrolPoints",{type:"entity",array:!0,default:[],title:"Patrol Points"}),CharacterNpc.prototype.initialize=function(){this.entity.AI={currentPatrolPoint:0,targetEntity:null,timerId:0}},CharacterNpc.prototype.doAI=function(){var t=this.entity.input,i=this.activateDistance+1;t.targetEntity&&(i=this.entity.getPosition().distance(t.targetEntity.getPosition())),t.targetEntity||this.targetEntity&&(i=this.entity.getPosition().distance(this.targetEntity.getPosition())),i>=1&&i<=this.activateDistance?t.targetEntity?i<=this.activateDistance/4&&(this.targetEntity&&(i=this.entity.getPosition().distance(this.targetEntity.getPosition())),i>=this.activateDistance/4?(t.targetEntity&&(t.targetEntity.destroy(),t.targetEntity=null),this.targetEntity&&(t.targetEntity=new pc.Entity,t.targetEntity.setPosition(this.targetEntity.getPosition()))):(t.targetEntity&&(t.targetEntity.destroy(),t.targetEntity=null),t.attack=!0,Tracer("statu","LLEGO   6666"))):(Tracer("statu","LLEGO   3333"),t.attack=!1,t.targetEntity&&(t.targetEntity.destroy(),t.targetEntity=null),this.targetEntity&&(t.targetEntity=new pc.Entity,t.targetEntity.setPosition(this.targetEntity.getPosition())),t.sprint=!0):t.targetEntity&&(t.targetEntity.destroy(),t.targetEntity=null,Tracer("statu","44444 LLEGO   4"))};var UranusInstancer=pc.createScript("uranusInstancer");UranusInstancer.attributes.add("inEditor",{type:"boolean",default:!0}),UranusInstancer.attributes.add("frustumCulling",{type:"boolean",default:!0,title:"Frustum Culling",description:"Controls the culling of instances against the camera frustum (frustum culling needs to enabled on each camera component). If false all instances will be rendered regardless of their visibility. Changing this setting requires application reload."}),UranusInstancer.attributes.add("cloneMaterials",{type:"boolean",default:!1,title:"Clone Materials",description:"If selected all instances will use a clone of the original model material. This is useful when the original material is being used in non instanced models and otherwise it will produce render artifacts. Changing this setting requires application reload."}),UranusInstancer.attributes.add("autoDynamicCells",{type:"boolean",default:!1,title:"Auto Dynamic Cells",description:"If this is selected the instancer will attempt to automatically understand if an instance has moved in a cell and update it accordingly. It can have a performance hit with too many cells/instances"}),UranusInstancer.attributes.add("disableCells",{type:"boolean",default:!1,title:"Disable Cells",description:"Disable cells generation and do per instance culling globally. In editor this setting is being bypassed for entities to allow for individual editing."}),UranusInstancer.attributes.add("disableShadows",{type:"boolean",default:!1,title:"Disable Shadows",description:"If selected no shadows buffers will be created (optimization). Requires app reload."}),UranusInstancer.attributes.add("bypassTransparent",{type:"boolean",default:!0,title:"Bypass Transparent",description:"If selected transparent mesh instances will not be instanced."}),UranusInstancer.attributes.add("excludeTag",{type:"string",default:"uranus-instancing-exclude",title:"Exclude Tag",description:"Use this tag on entities to exclude them from instancing."}),UranusInstancer.attributes.add("excludeCellsTag",{type:"string",default:"uranus-instancing-exclude-cells",title:"Exclude Cells Tag",description:"Use this tag to exclude entities from being included in the global cells, if used."}),UranusInstancer.attributes.add("shadowsOnlyTag",{type:"string",default:"uranus-instancing-shadows-only",title:"Shadows Only Tag",description:"Use this tag on entities to exclude them from model rendering. Those models will only render shadows."}),UranusInstancer.attributes.add("forceTransparentTag",{type:"string",default:"uranus-instancing-force-transparent",title:"Force Transparent Tag",description:"Use this tag on entities with transparent materials to force them to be included when the Bypass Transparent flag is used."}),UranusInstancer.attributes.add("entityDisableTag",{type:"string",default:"uranus-instancing-entity-disable",title:"Entity Disable Tag",description:"Use this tag on entities to exclude them from rendering their model. It will be rendered only for shadows."}),UranusInstancer.attributes.add("materialShadowsDisable",{type:"string",default:"uranus-instancing-material-shadows-disable",title:"Material Shadows Disable",description:"Use this tag on material assets to exclude them from rendering shadows."}),UranusInstancer.attributes.add("materialCloneDisable",{type:"string",default:"uranus-instancing-material-clone-disable",title:"Material Clone Disable",description:"Use this tag on material assets to exclude them from cloning their material."}),UranusInstancer.attributes.add("materialCloneEnable",{type:"string",default:"uranus-instancing-material-clone-enable",title:"Material Clone Enabled",description:"Use this tag on material assets to force them cloning their material."}),UranusInstancer.attributes.add("materialNonVisible",{type:"string",default:"uranus-instancing-material-non-visible",title:"Material Non Visible",description:"Use this tag on material assets to force all instances to be hidden from rendering but still take part in instancing. Useful when using proxy objects to receive visibility updates."}),UranusInstancer.attributes.add("excludeLayers",{type:"string",array:!0,default:["Depth","Skybox","Immediate","UI","Sky","Occlusion"],title:"Exclude Layers",description:"Mesh instances rendered in these layers won't be instanced."}),UranusInstancer.attributes.add("excludeShadowsLayers",{type:"string",array:!0,default:["WaterReflection"],title:"Exclude Shadows Layers",description:"Payloads in these layers will skip generating shadow casters."}),UranusInstancer.attributes.add("lodMultiplier",{type:"number",min:0,max:10,default:1,title:"LOD Multiplier",description:"The LOD multiplier all LOD Levels start/end distances will be multiplied with. Useful when creating LOD presets."}),UranusInstancer.attributes.add("lodLevels",{type:"json",title:"Lod Levels",array:!0,schema:[{name:"index",type:"number",default:0,precision:0,min:0,max:9,description:"The LOD index for this level e.g. 0 for LOD0, 1 for LOD1."},{name:"start",type:"number",default:0},{name:"end",type:"number",default:0}]}),UranusInstancer.attributes.add("cells",{type:"json",title:"Cells",array:!0,schema:[{name:"cellSize",type:"vec3",default:[10,10,10],title:"Cell Size",description:"The size of the cell in the frustum culling grid. Only static instances support cell based culling. Minimum cell side size is 1."},{name:"updateFrequency",type:"number",default:0,title:"Update Frequency",description:"Set how often in seconds culling updates will execute for this cell. To disable this check and execute it per frame set it to 0."},{name:"updateShadowsFrequency",type:"number",default:0,title:"Update Shadows Frequency",description:"Set how often in seconds culling shadows updates will execute for this cell. To disable this check and execute it per frame set it to 0."},{name:"isDynamic",type:"boolean",default:!1,title:"Is Dynamic",description:"If selected all entities in each cell will update their world transform matrix. Useful for animating instances while in a cell. Note if an instanced changes its position to be outside its initial cell, it will not change cell automatically."},{name:"cullingRadius",type:"number",default:1,title:"Culling Radius"}]}),UranusInstancer.attributes.add("materialExtraData",{type:"asset",assetType:"material",array:!0,title:"Material Extra Data",description:"Materials to override their transformVS chunk to support extra instanced data."}),UranusInstancer.editorLayers=["Editor Layer Viewport Grid","Editor Layer Bright Gizmo","Editor Layer Bright Gizmo","Editor Layer Viewport Grid","Editor Layer Bright Collision","Editor Layer Bright Collision","Editor Layer Dim Gizmo","Editor Layer Dim Gizmo","Editor Layer Viewport Outline","Editor Layer Viewport Outline","Editor Layer Axis Gizmo Immediate","Editor Layer Axis Gizmo Immediate","Editor Layer Axis Rotate Gizmo Immediate","Editor Layer Axis Rotate Gizmo Immediate","Editor Layer Axis Gizmo","Editor Layer Axis Gizmo","Editor Layer Camera Preview","Editor Layer Camera Preview"],UranusInstancer.prototype.initialize=function(){UranusInstancer.api=this,this.payloads=void 0,this.runningInEditor=window.UranusEditor&&window.UranusEditor.inEditor(),this.vec=new pc.Vec3,this.vec2=new pc.Vec3,this.quat=new pc.Quat,this.matrix=new pc.Mat4,this.hasLod=this.lodLevels.length>0,this.globalCells=void 0,this.viewPos=[0,0,0],this.instancerWorker=void 0,this.bypassCulling=!1,this.prepare(),window.setTimeout((()=>this.onState(!0)),0),this.on("state",this.onState,this),this.on("attr:disableShadows",this.onDisableShadows,this),this.on("attr:lodMultiplier",this.onLodMultiplier,this),this.app.on("UranusInstancer:setBypassCulling",(function(e){this.bypassCulling=e;for(let e in this.payloads){const t=this.payloads[e];if(t.shadowCaster){const e=t.refPayload?t.refPayload:t;e.updateFrequencyTime=e.updateFrequency}}}),this),this.app.on("UranusInstancer:setBypassShadows",(function(e){for(let t in this.payloads){const n=this.payloads[t];if(n.shadowCaster){const t=n.refPayload?n.refPayload:n;t.updateFrequencyTime=t.updateFrequency,n.meshInstance.visible=!e}}}),this)},UranusInstancer.prototype.prepare=function(){this.overrideEngine(),this.payloads={},this.cells.length>0&&(this.globalCells=new UranusInstancerCell({app:this.app,entity:this.entity,enabled:!0}),this.onCellsUpdated(this.cells)),this.prepareMaterialExtraData(this.materialExtraData),!this.frustumCulling&&this.cloneMaterials&&this.app.on("update",this.onUpdate,this),this.app.on("prerender",this.onPreRender,this),this.app.on("postrender",this.onPostRender,this)},UranusInstancer.prototype.onCellsUpdated=function(e){(e=e[0])&&this.globalCells&&(this.globalCells.cellSize=e.cellSize,this.globalCells.cullingRadius=e.cullingRadius,this.globalCells.updateFrequency=e.updateFrequency,this.globalCells.updateShadowsFrequency=e.updateShadowsFrequency,this.globalCells.isDynamic=e.isDynamic)},UranusInstancer.prototype.onState=function(e){if(e){const e=this.app.scene.layers.layerList;for(let t=0;t<e.length;t++){const n=e[t];if(!1===this.isLayerValid(n))continue;let s;s=this.bypassTransparent?n.meshInstances.filter((e=>e.material.blendType===pc.BLEND_NONE||e.node.tags.has(this.forceTransparentTag))):n.meshInstances,n.removeMeshInstances(s),n.addMeshInstances(s)}}else{for(let e in this.payloads){const t=this.payloads[e],n=t.refMeshInstances,s=t.layer;this.clearPayload(t),s.addMeshInstances(n)}this.payloads={}}},UranusInstancer.prototype.onDisableShadows=function(e){this.enabled&&(this.enabled=!1,this.enabled=!0)},UranusInstancer.prototype.setShadows=function(e){this.disableShadows=!e},UranusInstancer.prototype.onLodMultiplier=function(e){this.app.fire("UranusInstancer:onLodMultiplier",e)},UranusInstancer.prototype.isLayerValid=function(e,t){return t?-1===this.excludeShadowsLayers.indexOf(e.name):-1===this.excludeLayers.indexOf(e.name)&&-1===UranusInstancer.editorLayers.indexOf(e.name)},UranusInstancer.worldMatX=new pc.Vec3,UranusInstancer.worldMatY=new pc.Vec3,UranusInstancer.worldMatZ=new pc.Vec3,UranusInstancer.prototype.shouldFlipFaces=function(e){const t=UranusInstancer.worldMatX,n=UranusInstancer.worldMatY,s=UranusInstancer.worldMatZ,i=e.getWorldTransform();return i.getX(t),i.getY(n),i.getZ(s),t.cross(t,n),!(t.dot(s)>=0)},UranusInstancer.prototype.getPayloadId=function(e,t,n,s){const i=s||e.material,a=this.shouldFlipFaces(e.node);return BigInt(65535&t.id)<<34n|BigInt(n?1:0)<<33n|BigInt(a?1:0)<<32n|BigInt(65535&e.mesh.id)<<16n|BigInt(65535&i.id)},UranusInstancer.prototype.getMeshInstanceEntity=function(e){let t=e.node;if(t instanceof pc.Entity==0){for(;t instanceof pc.Entity==0&&t.parent;)t=t.parent;if(t instanceof pc.Entity==0)return}return t},UranusInstancer.prototype.addMeshInstance=function(e,t,n,s){if(!e.material||e.mesh.skin)return!1;if("uranus-instancer-payload"===e.node.name)return!1;const i=this.getMeshInstanceEntity(e);if(this.bypassTransparent&&!UranusUtilities.itemHasTag(i,this.forceTransparentTag)&&e.material.blendType!==pc.BLEND_NONE)return!1;if(!i)return!1;const a=e.node!==i?e.node:i;if(!0===UranusUtilities.itemHasTag(i,this.excludeTag))return!1;const r=i.render?i.render:i.model;if(!r||r&&r.batchGroupId>-1)return!1;let o=this.cloneMaterials,l=!1;if(i.render){const t=r.meshInstances.findIndex((t=>t===e));if(t>-1){const e=r.materialAssets[t],s=this.app.assets.get(e);s&&(!0===UranusUtilities.itemHasTag(s,this.materialShadowsDisable)&&(n=!0),!0===UranusUtilities.itemHasTag(s,this.materialCloneDisable)&&(o=!1),!0===UranusUtilities.itemHasTag(s,this.materialCloneEnable)&&(o=!0),!0===UranusUtilities.itemHasTag(s,this.materialNonVisible)&&(l=!0))}}const c=i.uranusInstancingData;return c?(i.on("UranusInstancerData:add:instances",(i=>{this.addBufferToPayload(i,a,e,t,n,s,o,l)})),i.on("UranusInstancerData:remove:instances",(i=>{this.removeBufferFromPayload(i,e,t,n,s)})),this.addBufferToPayload(c,a,e,t,n,s,o,l)):(s||this.addToPayload(i,a,e,t,!1,!1,o,l),!this.disableShadows&&!n&&e.castShadow&&this.isLayerValid(t,!0)&&this.addToPayload(i,a,e,t,!0,!1,o,l),this.overrideMeshInstance(e,(()=>{this.removeFromPayload(e,t,!1,null),this.removeFromPayload(e,t,!0,null),s||this.addToPayload(i,a,e,t,!1,!1,o,l),!this.disableShadows&&!n&&e.castShadow&&this.isLayerValid(t,!0)&&this.addToPayload(i,a,e,t,!0,!1,o,l)}))),!0},UranusInstancer.WORKER_CALCULATE_CELLS="calculate-cells",UranusInstancer.prototype.workerCalculateCells=function(e){this.instancerWorker||(this.instancerWorker=UranusUtilities.createWorker(this.entity,"uranus-instancer.worker.js"),UranusUtilities.postWorkerMessage(this.instancerWorker,"load-libraries",{libraries:[UranusUtilities.getAbsoluteUrl(this.app.assets.find("playcanvas-stable.min.js","script").getFileUrl()),UranusUtilities.getAbsoluteUrl(this.app.assets.find("uranus-worker-polyfill.js","script").getFileUrl()),UranusUtilities.getAbsoluteUrl(this.app.assets.find("uranus-instancer-cell.worker.js","script").getFileUrl())]})),UranusUtilities.postWorkerMessage(this.instancerWorker,UranusInstancer.WORKER_CALCULATE_CELLS,e,!0)},UranusInstancer.workerCalculateCellsListeners=[],UranusInstancer.prototype.addBufferToPayload=function(e,t,n,s,i,a,r,o){const l=e[0];let c=t.script?.uranusInstancerCell;!c&&this.globalCells&&!1===UranusUtilities.itemHasTag(t,this.excludeCellsTag)&&(c=this.globalCells);const u=void 0!==c&&c.enabled;if(l.singleInstance&&u){if(this.entity.on(`worker:${UranusInstancer.WORKER_CALCULATE_CELLS}:${l.bufferId}`,(function(e){t.fire("UranusInstancerData:onBufferConsumed"),l.workerPayload=e.payload,a||this.addToPayload(l,t,n,s,!1,!1,r,o),!this.disableShadows&&!i&&n.castShadow&&this.isLayerValid(s,!0)&&this.addToPayload(l,t,n,s,!0,!1,r,o),UranusInstancer.workerCalculateCellsListeners[l.bufferId]||(UranusInstancer.workerCalculateCellsListeners[l.bufferId]=window.setTimeout((()=>{this.entity.off(`worker:${UranusInstancer.WORKER_CALCULATE_CELLS}:${l.bufferId}`)}),0))}),this),!l.bufferDetached){l.bufferDetached=!0;const e=l.useBaseMatrix||l.baseEntity===t;let s;e||(s=UranusUtilities.serializeEntityTRS(t)),this.workerCalculateCells({id:l.bufferId,cellSize:UranusUtilities.serializeVec3(c.cellSize),cullingRadius:c.cullingRadius,buffer:l.buffer,node:s,refBoundingBox:n.aabb.halfExtents.data,useBaseMatrix:e})}}else{for(let l=0;l<e.length;l++){const c=e[l],u=l>=e.length-1;a||this.addToPayload(c,t,n,s,!1,!u,r,o),!this.disableShadows&&!i&&n.castShadow&&this.isLayerValid(s,!0)&&this.addToPayload(c,t,n,s,!0,!u,r,o)}t.fire("UranusInstancerData:onBufferConsumed")}},UranusInstancer.prototype.removeBufferFromPayload=function(e,t,n,s,i){i||this.removeFromPayload(t,n,!1,e),!s&&t.castShadow&&this.removeFromPayload(t,n,!0,e)},UranusInstancer.prototype.addToPayload=function(e,t,n,s,i,a,r,o){const l=e.workerPayload,c=!l&&e instanceof pc.Entity;if(!i&&!0===UranusUtilities.itemHasTag(c?e:t,this.shadowsOnlyTag))return;let u,d,p;c?(u=e.script?.uranusInstancerCell,!u&&this.globalCells&&!1===UranusUtilities.itemHasTag(e,this.excludeCellsTag)&&(u=this.globalCells),d=void 0!==u&&u.enabled,(this.disableCells||this.runningInEditor&&c)&&(d=!1),p=!1):(u=t.script?.uranusInstancerCell,!u&&this.globalCells&&(u=this.globalCells),d=void 0!==u&&u.enabled,(this.disableCells||this.runningInEditor&&c)&&(d=!1),p=e.singleInstance);const h=this.getPayloadId(n,s,i);let f=this.payloads[h];if(f){if(!f.refPayload&&c){if(f.refMeshInstances.indexOf(n)>-1)return f}else if(!f.refPayload&&!l&&f.refBufferInstances.indexOf(e)>-1)return f}else f=this.createPayload(h,n,s,i,p,d,r,o),this.setPayloadUpdateFrequency(f,u);if(f.refPayload)return!0!==a&&this.updateVertexBuffer(f,!0),f;const y={};if(this.hasLod){const e=t.script?.uranusInstancerLod;e&&(y.lodScript=e)}if(c){if(y.entity=e,e.uranusIsInstanced=!0,f.refMeshInstances.push(n),n.uranusPayloadMaterial=n.material,n.isStatic||e.uranusInstancerExtraData){const s=t.getWorldTransform(),i=s.data,a=[],r=e.uranusInstancerExtraData;r&&(i[3]=r[0],i[7]=r[1],i[11]=r[2],i[15]=r[3]);for(let e=0;e<16;e++)a[e]=i[e];n.isStatic&&(y.data=a,y.cullPosition=s.getTranslation())}}else if(!l){const s=e,i=s.baseEntity;let a,r,o;if(s.useBaseMatrix||i===t){const e=this.vec.set(s.position[0],s.position[1],s.position[2]),t=this.quat.setFromEulerAngles(s.rotation[0],s.rotation[1],s.rotation[2]),n=this.vec2.set(s.scale[0],s.scale[1],s.scale[2]);a=this.matrix,r=a.setTRS(e,t,n).data}else i.setPosition(s.position[0],s.position[1],s.position[2]),i.setEulerAngles(s.rotation[0],s.rotation[1],s.rotation[2]),i.setLocalScale(s.scale[0],s.scale[1],s.scale[2]),a=t.getWorldTransform(),r=a.data;if(p)o=r;else{o=[];for(let e=0;e<16;e++)o[e]=r[e]}y.data=o,y.cullPosition=a.getTranslation(),p||(s.payloads||(s.payloads={}),s.payloads[h]=y),f.singleInstance||f.refBufferInstances.push(s),-1===f.refMeshInstances.indexOf(n)&&f.refMeshInstances.push(n)}if(p&&!f.singleInstance&&(f.singleInstance=!0),c||0!==f.refMeshInstances.length||f.refMeshInstances.push(n),d)if(l){const n=e.workerPayload.cells,s=t.script?.uranusInstancerLod;n.forEach(((e,t)=>{if(e.aabb=new pc.BoundingBox(UranusUtilities.deserializeVec3(e.aabb.center),UranusUtilities.deserializeVec3(e.aabb.halfExtents)),!0===f.cells.set(t,e)){const n=f.cells.get(t);n.aabb.add(e.aabb),n.buffer=Float32Array.from(n.buffer,e.buffer)}else s&&(e.lodScript=s),f.cells.set(t,e)})),f.shouldUpdateShadows=2}else u.addInstanceToPayload(y,f,t,u.cellSize,u.cullingRadius),y.data=void 0,y.cullPosition=void 0;else y.meshInstance=n,y.node=t,f.onlyCells=!1,f.shouldUpdateShadows=2;if(f.singleInstance)f.instancesCount||(delete f.instances,f.instancesCount=0),l?f.instancesCount+=e.workerPayload.instancesCount:f.instancesCount++;else if(f.instances.push(y),f.basePayload){const e=f.instances.length-1;f.basePayload.instances&&f.basePayload.instances[e]&&(y.refInstance=f.basePayload.instances[e])}return c&&!0===y.entity.enabled&&!0===UranusUtilities.itemHasTag(y.entity,this.entityDisableTag)&&window.setTimeout((()=>y.entity.enabled=!1),0),!0!==a&&(this.updateVertexBuffer(f,!0),f.shadowCaster&&(f.shouldUpdateShadows=2),this.frustumCulling||this.isMeshInstanceVisible(null,f)),f},UranusInstancer.prototype.setPayloadUpdateFrequency=function(e,t){if(t&&(e.isCellDynamic=t.isDynamic,!e.updateFrequency)){const n=e.shadowCaster?t.updateShadowsFrequency:t.updateFrequency;n>0&&(e.updateFrequency=n<=1?10*n:n,e.updateFrequencyTime=e.updateFrequency,e.updateFrequencyLastNow=pc.app.frame)}},UranusInstancer.prototype.removeMeshInstance=function(e,t,n,s){if(e.mesh.skin)return!1;if("uranus-instancer-payload"===e.node.name)return!1;let i=!1;return s||(i=this.removeFromPayload(e,t,!1)),n||(i=this.removeFromPayload(e,t,!0)),this.overrideMeshInstance(e),i},UranusInstancer.prototype.removeFromPayload=function(e,t,n,s){const i=e.uranusPayloadMaterial?e.uranusPayloadMaterial:e.material;if(!i)return!1;const a=this.getPayloadId(e,t,n,i),r=this.payloads[a];if(!r)return!1;if(e.node.uranusHasInstancingData){const t=e.node.uranusInstancingData;if((r.refPayload?r.refPayload:r).singleInstance||!s&&!t)r.refBufferInstances.length=0,r.instancesCount=0;else{s||(s=t);for(let e=0;e<s.length;e++){const t=s[e],n=r.refBufferInstances.indexOf(t);if(-1===n)continue;r.refBufferInstances.splice(n,1);const i=t.payloads[a];void 0!==i.cell&&UranusInstancerCell.prototype.removeInstanceFromPayload(i,r);const o=r.instances.indexOf(i);-1!==o&&r.instances.splice(o,1)}}}else if(!r.refPayload&&r.refMeshInstances.length>0&&r.instances){const t=r.refMeshInstances.indexOf(e);if(-1===t)return!1;const n=r.instances[t];if(UranusUtilities.itemHasTag(n.entity,this.entityDisableTag)&&!1===n.entity._destroying)return!1;void 0!==n.cell&&UranusInstancerCell.prototype.removeInstanceFromPayload(n,r),r.instances.splice(t,1),r.refMeshInstances.splice(t,1)}0===r.instancesCount||r.instances&&0===r.instances.length?this.clearPayload(r):(this.updateVertexBuffer(r,!0),r.shadowCaster&&(r.shouldUpdateShadows=2),this.frustumCulling||this.isMeshInstanceVisible(null,r))},UranusInstancer.prototype.clearPayload=function(e){e.cells=void 0,e.instances=void 0,e.buffer.vertexBuffer.destroy(),e.shadowCaster?e.layer.removeShadowCasters([e.meshInstance]):e.layer.removeMeshInstances([e.meshInstance],!0),delete this.payloads[e.id]},UranusInstancer.prototype.updateVertexBuffer=function(e,t,n){let s;s=void 0!==n?n:e.instances?e.instances.length:(e.refPayload?e.refPayload:e).instancesCount;const i=e.buffer,a=e.meshInstance;if(s>0||!i.vertexBuffer){let n;if(n=t||!i.originalStorage?i.originalStorage=new Float32Array(16*s):i.originalStorage.subarray(0,16*s),s>i.instancesCount||!i.vertexBuffer){i.vertexBuffer&&i.vertexBuffer.destroy();const e=pc.VertexFormat.defaultInstancingFormat?pc.VertexFormat.defaultInstancingFormat:pc.VertexFormat.getDefaultInstancingFormat(this.app.graphicsDevice),t=new pc.VertexBuffer(this.app.graphicsDevice,e,s,{usage:pc.BUFFER_DYNAMIC,data:n});a.setInstancing(t,!0),i.vertexBuffer=t}else{const t=i.vertexBuffer,a=t.format;t.numBytes=a.verticesByteSize?a.verticesByteSize:a.size*s,t.setData(n),e.meshInstance.instancingCount=s}}i.instancesCount=s,a.instancingCount=s},UranusInstancer.prototype.createPayload=function(e,t,n,s,i,a,r,o){const l=this.getPayloadMaterial(t.material,r,o),c=new pc.MeshInstance(t.mesh,l,new pc.GraphNode("uranus-instancer-payload"));c.pick=!1,c.flipFaces=this.shouldFlipFaces(t.node),c.flipFacesFactor=t.node.worldTransform.scaleSign,c.castShadow=s,c.aabb.center.copy(t.aabb.center),c.aabb.halfExtents.copy(t.aabb.halfExtents),s?n.addShadowCasters([c]):n.addMeshInstances([c],!0);const u={basePayload:void 0,buffer:{instancesCount:0,originalStorage:void 0,vertexBuffer:void 0},cells:new Map,firstTimeVisible:!0,id:e,instances:[],layer:n,lodIndex:this.hasLod?UranusInstancerLod.prototype.getLodIndexFromName(t.node.name):-1,meshInstance:c,onlyCells:!0,refBoundingBox:new pc.BoundingBox,refBufferInstances:[],refMaterial:t.material,refMeshInstances:[],refPayload:void 0,singleInstance:!1,shadowCaster:s,shouldCloneMaterial:r,updateFrequency:void 0,updateFrequencyTime:void 0,updateFrequencyLastNow:void 0};if(u.refBoundingBox.halfExtents.copy(t.aabb.halfExtents),s||a&&u.lodIndex>0){let e=t.node.name;a&&(e=e.replace(`_LOD${u.lodIndex}`,"_LOD0"));const s=this.payloads;let i;for(let a in s){const r=s[a],o=r.refMeshInstances[0];if(o&&!1===r.shadowCaster&&r.layer===n&&o.node.name===e&&!0===o.node.getLocalScale().equals(t.node.getLocalScale())){i=r;break}}i&&(a?(u.refPayload=i,u.cells=u.refPayload.cells,u.instances=u.refPayload.instances,u.refBufferInstances=u.refPayload.refBufferInstances,u.refMeshInstances=u.refPayload.refMeshInstances):u.basePayload=i)}return this.setPayloadCulling(this.frustumCulling,u),this.payloads[e]=u,u},UranusInstancer.prototype.setPayloadCulling=function(e,t){e?(t.meshInstance.cull=!0,t.meshInstance.isVisibleFunc=e=>this.isMeshInstanceVisible(e,t)):(t.meshInstance.cull=!1,delete t.meshInstance.isVisibleFunc)},UranusInstancer.prototype.isMeshInstanceVisible=function(e,t){if(e&&!t.shadowCaster){const n=e.node.getPosition(),s=this.viewPos;s[0]=n.x,s[1]=n.y,s[2]=n.z,t.meshInstance.setParameter("uranus_view_position",s),t.meshInstance.setParameter("uranus_view_position_alpha",s)}if(this.updatePayload(t,e),t.shadowCaster&&t.shouldUpdateShadows>=0){let e=!0;const n=t.meshInstance.aabb,s=t.instances;if(!1===t.onlyCells&&s)for(let t=0;t<s.length;t++){const i=s[t];if(i.cell)continue;const a=i.meshInstance;0!==a.visibleThisFrame&&(e?(e=!1,n.copy(a.aabb)):n.add(a.aabb))}const i=t.cells;i&&i.forEach((t=>{e?(e=!1,n.copy(t.aabb)):n.add(t.aabb)})),t.shouldUpdateShadows--}return!0},UranusInstancer.prototype.getPayloadMaterial=function(e,t,n){const s=t?e.clone():e;return e._uranusRequiresVertexColors&&(s._uranusRequiresVertexColors=!0),s.onUpdateShader=function(t){return t.litOptions.useInstancing=!0,e._uranusRequiresVertexColors&&(t.vertexColors=!0),t},!0===n&&(s.redWrite=!1,s.greenWrite=!1,s.blueWrite=!1,s.alphaWrite=!1,s.depthWrite=!1,s.update()),s.update(),s._uranusRequiresInstancing=!0,t&&this.app.fire("UranusInstancer:materialCloned",s),s},UranusInstancer.prototype.onUpdate=function(){const e=this.payloads;if(e&&this.cloneMaterials)for(let t in e)this.updatePayload(e[t])},UranusInstancer.prototype.onPreRender=function(){UranusInstancerLod.cellsVisCache&&UranusInstancerLod.cellsVisCache.forEach((e=>e.dirty=!0)),UranusInstancerCell.cellsVisCache&&UranusInstancerCell.cellsVisCache.forEach((e=>e.dirty=!0))},UranusInstancer.prototype.onPostRender=function(){const e=this.payloads;if(e)for(let t in e){const n=e[t],s=n.cells;s&&(-1===n.updateFrequencyTime&&(n.updateFrequencyTime=0,n.updateFrequencyLastNow=pc.app.frame),n.isCellDynamic&&s.forEach((e=>{if(!e.entityMoved||e.entityMovedLock)return!0;if(e.entityMoved=!1,this.autoDynamicCells){const t=e.instances;for(let e=0;e<t.length;e++)t[e].entity._dirtyNormal=!1}})))}},UranusInstancer.prototype.updatePayload=function(e,t){const n=e.refPayload?e.refPayload:e,s=e.cells,i=n.onlyCells;let a=0;const r=e.instances;if(!i&&r)for(let n=0;n<r.length;n++){const s=r[n];s.cell||(a=this.updateInstance(s,e,a,t))}if(s&&s.size>0){const r=e.refPayload&&!e.shadowCaster?e.refPayload:e;let o=!0,l=!0;for(const e of s.values())if(e.entityMoved){l=!1;break}if(!this.bypassCulling&&l&&r.updateFrequency){if(n.updateFrequencyTime>=0){const e=pc.app.frame,t=e-r.updateFrequencyLastNow;r.updateFrequencyTime+=t,r.updateFrequencyLastNow=e,r.updateFrequencyTime<r.updateFrequency&&(o=!1)}o&&(r.updateFrequencyTime=-1)}if(this.autoDynamicCells){let e=!1;if(r.isCellDynamic)e:for(const t of s.values()){const n=t.instances;if(n)for(let s=0;s<n.length;s++){void 0===t.entityMoved&&(e=!0);const i=n[s].entity;if(i&&!0===i.uranusCellDynamicBypass||!0===i._dirtyNormal){e=!0,t.entityMoved=!0;continue e}}}e&&(o=!0)}if(o)s.forEach((n=>{a=this.updateCell(n,e,a,t,n.entityMoved)}));else if(i)return}const o=a/16;this.updateVertexBuffer(e,!1,o)},UranusInstancer.prototype.checkPayloadMaterial=function(e){const t=e.refMeshInstances[0];if(!t)return;const n=t.material!==e.refMaterial;n&&(e.refMaterial=t.material);const s=e.refMaterial;if(s&&(s.dirty||n)){const t=this.getPayloadMaterial(s,e.shouldCloneMaterial);e.meshInstance.material=t,this.app.once("postrender",(function(){e.refMaterial.dirty=!1}),this)}},UranusInstancer.prototype.updateCell=function(e,t,n,s,i){if(!1===e.uranusCellVisibilityBypass)return n;if(s&&!this.bypassCulling){if(!1===UranusInstancerCell.prototype.isVisible(e,s,t.layer))return n;if(!1===this.cullInstanceLOD(e,t,s))return n}const a=t.buffer.originalStorage,r=e.buffer;if(e.hasEntities&&i){const t=e.instances;let s=0;for(let e=0;e<t.length;e++){const i=t[e].entity;if(!1===i.uranusZoneActive)continue;const o=i.getWorldTransform().data,l=i.uranusInstancerExtraData;l&&(o[3]=l[0],o[7]=l[1],o[11]=l[2],o[15]=l[3]);for(let e=0;e<16;e++)a[n++]=o[e],r[s++]=o[e]}}else for(let e=0;e<r.length;e++)a[n++]=r[e];return n},UranusInstancer.prototype.updateInstance=function(e,t,n,s){let i;const a=e.entity;if(s&&(i=this.cullInstance(e,t,s),a&&!t.shadowCaster&&(a.uranusIsVisible=i>0),!i))return n;const r=t.buffer.originalStorage,o=e.data?e.data:e.node.getWorldTransform().data;if(a){const e=a.uranusInstancerExtraData;e&&(o[3]=e[0],o[7]=e[1],o[11]=e[2],o[15]=e[3])}for(let e=0;e<16;e++)r[n++]=o[e];return 2===i&&(r[n-3]=e.lodScript.skipShadowsOffset),n},UranusInstancer.shadowCameraName="ShadowCamera",UranusInstancer.prototype.cullInstanceLOD=function(e,t,n){let s=!0;const i=t.lodIndex,a=UranusInstancer.shadowCameraName===n.node.name&&n.farClip<2e5;if(this.hasLod&&(i>-1||a)){const r=t.shadowCaster,o=e.lodScript;if(o){const e=o.proxyMesh;if(e&&!0===e.uranusLodVisible)return!1}if(a||!r||o&&o.hasCustomShadowLod){let l;l=e.cullPosition?e.cullPosition:e.center?e.center:e.entity.getPosition();const c=r&&!a&&t.refPayload?t.refPayload.camera:n;s=o?o.isLodVisible(i,l,c,void 0,t,this.lodMultiplier)>0:UranusInstancerLod.prototype.isLodVisible(i,l,c,this.lodLevels,void 0,this.lodMultiplier)>0,r||(e.refLodIndices||(e.refLodIndices=[]),e.refLodIndices[i]=s),e.isVisible=s}else if(o&&o.skipShadowsLod){const t=e.refLodIndices;if(t){s=!1;for(let e=0;e<t.length;e++)if(!0===t[e]){s=2;break}}else s=2}else e.refLodIndices?s=e.refLodIndices[i]:e.refInstance&&(s=e.refInstance.isVisible)}return t.refPayload||(t.camera=n),e.entity&&(e.entity.uranusLodVisible=!1!==s),s},UranusInstancer.prototype.cullInstance=function(e,t,n){const s=this.bypassCulling,i=this.cullInstanceLOD(e,t,n);if(!1===i&&!s)return i;if(e.entity&&!1===e.entity.uranusZoneActive)return!1;if(s)return 2!==i||i;{const t=e.meshInstance;e.data&&t.aabb.center.copy(e.cullPosition);let s=t._isVisible(n);return t.visibleThisFrame=s,s=s>0,s&&2===i?i:s}},UranusInstancer.prototype.overrideEngine=function(){const e=pc.Layer.prototype.addMeshInstances;pc.Layer.prototype.addMeshInstances=function(t,n){if(UranusInstancer.api&&UranusInstancer.api.enabled&&UranusInstancer.api.isLayerValid(this)){let s=[];t.forEach((e=>{UranusInstancer.api.addMeshInstance(e,layer=this,n,!1)||s.push(e)})),arguments[0]=s,e.apply(this,arguments)}else e.apply(this,arguments)};const t=pc.Layer.prototype.removeMeshInstances;UranusInstancer.removeMeshInstancesFunc=t,pc.Layer.prototype.removeMeshInstances=function(e,n){if(UranusInstancer.api&&UranusInstancer.api.enabled&&UranusInstancer.api.isLayerValid(this)){let s=[];e.forEach((e=>{UranusInstancer.api.removeMeshInstance(e,layer=this,n,!1)||s.push(e)})),arguments[0]=s,t.apply(this,arguments)}else t.apply(this,arguments)};const n=pc.Layer.prototype.addShadowCasters;pc.Layer.prototype.addShadowCasters=function(e){if(UranusInstancer.api&&UranusInstancer.api.enabled&&UranusInstancer.api.isLayerValid(this)){let t=[];e.forEach((e=>{UranusInstancer.api.addMeshInstance(e,layer=this,!1,!0)||t.push(e)})),arguments[0]=t,n.apply(this,arguments)}else n.apply(this,arguments)};const s=pc.Layer.prototype.removeShadowCasters;pc.Layer.prototype.removeShadowCasters=function(e){if(UranusInstancer.api&&UranusInstancer.api.enabled&&UranusInstancer.api.isLayerValid(this)){let t=[];e.forEach((e=>{UranusInstancer.api.removeMeshInstance(e,layer=this,!1,!0)||t.push(e)})),arguments[0]=t,s.apply(this,arguments)}else s.apply(this,arguments)}},UranusInstancer.prototype.overrideMeshInstance=function(e,t){Object.defineProperty(e,"material",{set:function(e){this.clearShaders();const n=this._material;if(n&&n.removeMeshInstanceRef(this),this._material=e,this._material){if(this._material.addMeshInstanceRef(this),this.updateKey(),(n&&n.blendType!==pc.BLEND_NONE)!==(this._material.blendType!==pc.BLEND_NONE)){let e=this._material._scene;!e&&n&&n._scene&&(e=n._scene),e?e.layers._dirtyBlend=!0:this._material._dirtyBlend=!0}t&&this._mesh&&t()}},get:function(){return this._material},configurable:!0})},UranusInstancer.prototype.prepareMaterialExtraData=function(e){for(const t of e){const e=t.resource;e.chunks.transformVS="\nout vec4 instance_extraData;\n\n#ifdef PIXELSNAP\nuniform vec4 uScreenSize;\n#endif\n\n#ifdef SCREENSPACE\nuniform float projectionFlipY;\n#endif\n\n#ifdef MORPHING\nuniform vec4 morph_weights_a;\nuniform vec4 morph_weights_b;\n#endif\n\n#ifdef MORPHING_TEXTURE_BASED\n    uniform vec4 morph_tex_params;\n\n    #ifdef WEBGPU\n        ivec2 getTextureMorphCoords() {\n\n            // turn morph_vertex_id into int grid coordinates\n            ivec2 textureSize = ivec2(morph_tex_params.xy);\n            int morphGridV = int(morph_vertex_id / textureSize.x);\n            int morphGridU = int(morph_vertex_id - (morphGridV * textureSize.x));\n            morphGridV = textureSize.y - morphGridV - 1;\n            return ivec2(morphGridU, morphGridV);\n        }\n    #else\n        vec2 getTextureMorphCoords() {\n            vec2 textureSize = morph_tex_params.xy;\n            vec2 invTextureSize = morph_tex_params.zw;\n\n            // turn morph_vertex_id into int grid coordinates\n            float morphGridV = floor(morph_vertex_id * invTextureSize.x);\n            float morphGridU = morph_vertex_id - (morphGridV * textureSize.x);\n\n            // convert grid coordinates to uv coordinates with half pixel offset\n            return vec2(morphGridU, morphGridV) * invTextureSize + (0.5 * invTextureSize);\n        }\n    #endif\n\n#endif\n\n#ifdef MORPHING_TEXTURE_BASED_POSITION\nuniform highp sampler2D morphPositionTex;\n#endif\n\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n    return getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n    return matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);\n    #elif defined(INSTANCING)\n    instance_extraData = vec4(instance_line1.w, instance_line2.w, instance_line3.w, instance_line4.w);\n    return mat4(vec4(instance_line1.xyz, 0), vec4(instance_line2.xyz, 0), vec4(instance_line3.xyz, 0), vec4(instance_line4.xyz, 1));\n    #else\n    return matrix_model;\n    #endif\n}\n\nvec4 getPosition() {\n    dModelMatrix = getModelMatrix();\n    vec3 localPos = vertex_position;\n\n    #ifdef NINESLICED\n    // outer and inner vertices are at the same position, scale both\n    localPos.xz *= outerScale;\n\n    // offset inner vertices inside\n    // (original vertices must be in [-1;1] range)\n    vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n    vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n    localPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\n    vTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0; // uv = local pos - inner corner\n\n    localPos.xz *= -0.5; // move from -1;1 to -0.5;0.5\n    localPos = localPos.xzy;\n    #endif\n\n    #ifdef MORPHING\n    #ifdef MORPHING_POS03\n    localPos.xyz += morph_weights_a[0] * morph_pos0;\n    localPos.xyz += morph_weights_a[1] * morph_pos1;\n    localPos.xyz += morph_weights_a[2] * morph_pos2;\n    localPos.xyz += morph_weights_a[3] * morph_pos3;\n    #endif // MORPHING_POS03\n    #ifdef MORPHING_POS47\n    localPos.xyz += morph_weights_b[0] * morph_pos4;\n    localPos.xyz += morph_weights_b[1] * morph_pos5;\n    localPos.xyz += morph_weights_b[2] * morph_pos6;\n    localPos.xyz += morph_weights_b[3] * morph_pos7;\n    #endif // MORPHING_POS47\n    #endif // MORPHING\n\n    #ifdef MORPHING_TEXTURE_BASED_POSITION\n\n        #ifdef WEBGPU\n            ivec2 morphUV = getTextureMorphCoords();\n            vec3 morphPos = texelFetch(morphPositionTex, ivec2(morphUV), 0).xyz;\n        #else\n            vec2 morphUV = getTextureMorphCoords();\n            vec3 morphPos = texture2D(morphPositionTex, morphUV).xyz;\n        #endif\n\n        localPos += morphPos;\n\n    #endif\n\n    vec4 posW = dModelMatrix * vec4(localPos, 1.0);\n    #ifdef SCREENSPACE\n    posW.zw = vec2(0.0, 1.0);\n    #endif\n    dPositionW = posW.xyz;\n\n    vec4 screenPos;\n    #ifdef UV1LAYOUT\n    screenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n        #ifdef WEBGPU\n        screenPos.y *= -1.0;\n        #endif\n    #else\n    #ifdef SCREENSPACE\n    screenPos = posW;\n    screenPos.y *= projectionFlipY;\n    #else\n    screenPos = matrix_viewProjection * posW;\n    #endif\n\n    #ifdef PIXELSNAP\n    // snap vertex to a pixel boundary\n    screenPos.xy = (screenPos.xy * 0.5) + 0.5;\n    screenPos.xy *= uScreenSize.xy;\n    screenPos.xy = floor(screenPos.xy);\n    screenPos.xy *= uScreenSize.zw;\n    screenPos.xy = (screenPos.xy * 2.0) - 1.0;\n    #endif\n    #endif\n\n    return screenPos;\n}\n\nvec3 getWorldPosition() {\n    return dPositionW;\n}\n        ",e.chunks.APIVersion=pc.CHUNKAPI_1_65,e.update()}};var UranusInstancerCell=pc.createScript("uranusInstancerCell");UranusInstancerCell.attributes.add("inEditor",{type:"boolean",default:!0}),UranusInstancerCell.attributes.add("cellSize",{type:"vec3",default:[10,10,10],title:"Cell Size",description:"The size of the cell in the frustum culling grid. Only static instances support cell based culling. Minimum cell side size is 1."}),UranusInstancerCell.attributes.add("updateFrequency",{type:"number",default:0,title:"Update Frequency",description:"Set how often in seconds culling updates will execute for this cell. To disable this check and execute it per frame set it to 0."}),UranusInstancerCell.attributes.add("updateShadowsFrequency",{type:"number",default:0,title:"Update Shadows Frequency",description:"Set how often in seconds culling shadows updates will execute for this cell. To disable this check and execute it per frame set it to 0."}),UranusInstancerCell.attributes.add("isDynamic",{type:"boolean",default:!1,title:"Is Dynamic",description:"If selected all entities in each cell will update their world transform matrix. Useful for animating instances while in a cell. Note if an instanced changes its position to be outside its initial cell, it will not change cell automatically."}),UranusInstancerCell.attributes.add("cullingRadius",{type:"number",default:1,title:"Culling Radius"}),UranusInstancerCell.prototype.addInstanceToPayload=function(e,t,n,s,i){const a=e.entity,r=e.cullPosition?e.cullPosition:a.getPosition(),o=this.getCellFromPosition(r,t,s,i);t&&!t.singleInstance&&o.instances.push(e);const l=o.buffer,c=e.data?e.data:n.getWorldTransform().data;let u=l.length;e.cell=o;const d=e.lodScript;d&&(o.lodScript=d),void 0===o.hasEntities&&a&&(o.hasEntities=!0),a&&(a.uranusInstancerCells||(a.uranusInstancerCells=[]),-1===a.uranusInstancerCells.indexOf(o)&&a.uranusInstancerCells.push(o));for(let e=0;e<16;e++)l[u++]=c[e]},UranusInstancerCell.prototype.removeInstanceFromPayload=function(e,t){const n=e.cell;if(!n)return;const s=n.instances.indexOf(e);s>-1&&(n.instances.splice(s,1),Array.isArray(n.buffer)&&n.buffer.splice(16*s,16)),0===n.instances.length&&t.cells.delete(n.id)},UranusInstancerCell.vec=new pc.Vec3,UranusInstancerCell.prototype.getPositionOnGrid=function(e,t){const n=Math.max(t.x,1),s=Math.max(t.y,1),i=Math.max(t.z,1),a=Math.floor(e.x/n)*n,r=Math.floor(e.y/s)*s,o=Math.floor(e.z/i)*i;return UranusInstancerCell.vec.set(a,r,o)},UranusInstancerCell.prototype.getCellGuid=function(e,t,n,s){return e.toFixed(0)+"_"+t.toFixed(0)+"_"+n.toFixed(0)+"-"+s.x+"_"+s.y+"_"+s.z},UranusInstancerCell.prototype.calculateCellBounding=function(e,t){const n=new pc.BoundingBox,s=n.halfExtents.copy(pc.Vec3.ZERO);s.x+=t.x/2,s.y+=t.y/2,s.z+=t.z/2;const i=n.center.copy(e);return i.x+=s.x,i.y+=s.y,i.z+=s.z,n},UranusInstancerCell.prototype.getCellFromPosition=function(e,t,n,s){const i=Math.max(n.x,1),a=Math.max(n.y,1),r=Math.max(n.z,1),o=Math.floor(e.x/i)*i,l=Math.floor(e.y/a)*a,c=Math.floor(e.z/r)*r,u=this.getCellGuid(o,l,c,n);t.cells||(t.cells=new Map);let d=t.cells.get(u);if(!d){const e=t.refBoundingBox.halfExtents,i=new pc.Vec3;i.x+=n.x/2+e.x/2,i.y+=n.y/2+e.y/2,i.z+=n.z/2+e.z/2;const a=2*Math.max(i.x,i.y,i.z),r=i.clone();r.x+=o,r.y+=l,r.z+=c,d=UranusInstancerCell.prototype.createCell(u,r,i,a,s,t)}return d},UranusInstancerCell.prototype.createCell=function(e,t,n,s,i,a){const r={aabb:new pc.BoundingBox(t,n),center:t,cullingRadius:i,radius:s,buffer:[],id:e,instances:!1===a.singleInstance?[]:void 0,refLodIndices:[]};return a.cells.set(e,r),a.shadowCaster&&(a.shouldUpdateShadows=2),r},UranusInstancerCell.tempSphere=new pc.BoundingSphere,UranusInstancerCell.cellsVisCache=new Map,UranusInstancerCell.prototype.isVisible=function(e,t,n){let s=UranusInstancerCell.cellsVisCache.get(e.id);if(s||(s={camera:void 0,layer:void 0,dirty:!0,visible:!1},UranusInstancerCell.cellsVisCache.set(e.id,s)),s.dirty||s.camera!==t||s.layer!==n){s.camera=t,s.layer=n,s.dirty=!1;const i=UranusInstancerCell.tempSphere;i.center=e.center,i.radius=e.radius*e.cullingRadius;const a=t.frustum.containsSphere(i);s.visible=a>0}return s.visible},UranusInstancerCell.prototype.updateInstancerCell=function(e){e.forEach((e=>{const t=e.entity.uranusInstancerCells;if(!t)return!0;t.forEach((e=>e.entityMoved=!0))}))};var UranusInstancerLod=pc.createScript("uranusInstancerLod");UranusInstancerLod.attributes.add("inEditor",{type:"boolean",default:!0}),UranusInstancerLod.LAYER_TYPE_ALL="all",UranusInstancerLod.LAYER_TYPE_MODEL="model",UranusInstancerLod.LAYER_TYPE_SHADOW="shadow",UranusInstancerLod.attributes.add("lodLevels",{type:"json",title:"Lod Levels",array:!0,schema:[{name:"index",type:"number",default:0,precision:0,min:0,max:9,description:"The LOD index for this level e.g. 0 for LOD0, 1 for LOD1."},{name:"layer",type:"string",description:"Add an optional layer name to specify a LOD level for this layer only. If left blank it will be used for any layer."},{name:"layerType",type:"string",default:UranusInstancerLod.LAYER_TYPE_ALL,enum:[{All:UranusInstancerLod.LAYER_TYPE_ALL},{Model:UranusInstancerLod.LAYER_TYPE_MODEL},{Shadow:UranusInstancerLod.LAYER_TYPE_SHADOW}],description:"Set what type of payloads this LOD level will apply to. If left blank it will be used for any type."},{name:"start",type:"number",default:0,description:"Starting from this distance from the camera this level of detail will be visible."},{name:"end",type:"number",default:0,description:"After this distance from the camera this level of detail will be hidden. Use 0 to keep it enabled infinitely."}]}),UranusInstancerLod.attributes.add("proxyMesh",{type:"entity",title:"Proxy Mesh",description:"If an entity is referenced, as soon as its model level of detail is visible, this entity model will be hidden. Useful for hierarchical LODs. The referenced entity needs to have an instanced model rendered."}),UranusInstancerLod.attributes.add("skipShadowsLod",{type:"boolean",default:!1,title:"Skip Shadows LOD",description:"If selected all shadowcaster instances will skip any LOD check. Useful for rendering shadows for a lower level of detail, to lower polycount. You can control which LOD casts shadows by using the model/render component Cast Shadows property."}),UranusInstancerLod.attributes.add("skipShadowsOffset",{type:"number",default:0,title:"Skip Shadows Offset",description:"If Skip Shadows LOD is selected you can define an offset on the Y axis to adjust the rendering position of the LOD shadowcaster. Useful for removing self shadowing artifacts when rendering shadows on a level of detail with a different polycount."}),UranusInstancerLod.prototype.initialize=function(){this.lodLevelsFiltered={},this.hasCustomShadowLod=!1},UranusInstancerLod.prototype.prepareLodLevels=function(e){const t={};this.lodLevels.forEach((e=>{const n=e.layer?e.layer:"";if(e.layerType===UranusInstancerLod.LAYER_TYPE_ALL){let s=`${n}_${UranusInstancerLod.LAYER_TYPE_MODEL}`;t[s]||(t[s]=[]),t[s][e.index]=e,s=`${n}_${UranusInstancerLod.LAYER_TYPE_SHADOW}`,t[s]||(t[s]=[]),t[s][e.index]=e}else{const s=`${n}_${e.layerType}`;e.layerType===UranusInstancerLod.LAYER_TYPE_SHADOW&&(this.hasCustomShadowLod=!0),t[s]||(t[s]=[]),t[s][e.index]=e}})),this.lodLevelsFiltered[e.id]=void 0;let n=`${e.layer.name}_${e.shadowCaster?"shadow":"model"}`;t[n]?this.lodLevelsFiltered[e.id]=t[n].map((e=>e)):(n="_"+(e.shadowCaster?"shadow":"model"),t[n]&&(this.lodLevelsFiltered[e.id]=t[n].map((e=>e))))},UranusInstancerLod.prototype.getLodIndexFromName=function(e){const t=e.split("_"),n=t[t.length-1];return 0!==n.indexOf("LOD")?-1:parseInt(n.replace("LOD",""))},UranusInstancerLod.prototype.isLodVisible=function(e,t,n,s,i,a){if(!n)return 0;const r=n.fov>90;let o;if(s)o=s[e];else{let t=this.lodLevelsFiltered[i.id];t||(this.prepareLodLevels(i),t=this.lodLevelsFiltered[i.id]),o=t[e]}if(!o)return r&&n.node.getPosition().distance(t)<=n.farClip?2:0;const l=n.node.getPosition().distance(t),c=o.start*a;return end=o.end>0?o.end*a:1/0,end>n.farClip&&(end=n.farClip),l>=c&&l<end?2:0};var UranusUtilities=pc.createScript("uranusUtilities");UranusUtilities.workerMinRestTime=2e3,UranusUtilities.workersResting=0,UranusUtilities.waitForWorker=function(e){},UranusUtilities.loadAsset=function(e,t){return new Promise((n=>{const s=pc.Application.getApplication(),i=e instanceof pc.Asset?e:s.assets.find(e,t);i?(i.ready(n),s.assets.load(i)):n()}))},UranusUtilities.loadAssets=function(e){return new Promise((t=>{const n=pc.Application.getApplication();let s=0;e=e.filter((e=>e instanceof pc.Asset)),Array.isArray(e)||(e=[e]);const i=e.length,onAssetReady=function(){s+=1,s>=i&&t()};for(let t=0;t<e.length;t++){const s=e[t];s&&(s.loaded?onAssetReady():(s.ready(onAssetReady),n.assets.load(s)))}e&&e.length||onAssetReady()}))},UranusUtilities.copyCameraProperties=function(e,t){if(!e||!t)return;const n=e.camera,s=t.camera;n.fov=s.fov,n.aspectRatio=s.aspectRatio,n.clearColor=s.clearColor,n.clearColorBuffer=s.clearColorBuffer,n.clearDepthBuffer=s.clearDepthBuffer,n.clearStencilBuffer=s.clearStencilBuffer,n.farClip=s.farClip,n.nearClip=s.nearClip,n.frustumCulling=s.frustumCulling,n.rect.copy(s.rect)},UranusUtilities.readPixelsFromTexture=function(e){const t=pc.Application.getApplication().graphicsDevice.gl,n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e._glTexture,0);const s=new Uint8Array(e.width*e.height*4);return t.readPixels(0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,s),t.bindFramebuffer(t.FRAMEBUFFER,null),s},UranusUtilities.getWorkerLibraryUrl=function(e){const t=`importScripts( "${e}" );`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},UranusUtilities.createWorker=function(e,t){let n;const s=pc.Application.getApplication().assets.find(t,"script");if(s){const t=UranusUtilities.getWorkerLibraryUrl(UranusUtilities.getAbsoluteUrl(s.getFileUrl()));n=new Worker(t),n.addEventListener("message",(t=>UranusUtilities.onWorkerMessage(e,t)))}return n},UranusUtilities.onWorkerMessage=function(e,t){const n=t.data.type;if(!n)return;const s=t.data.data;e.fire(`worker:${n}`,s)},UranusUtilities.postWorkerMessage=function(e,t,n,s){const i=[];s&&UranusUtilities.getMessageBuffers(n,i),e.postMessage({type:t,data:n},i)},UranusUtilities.getMessageBuffers=function(e,t){Object.keys(e).forEach((n=>{e[n]&&(e[n].buffer?t.push(e[n].buffer):"object"==typeof e[n]&&UranusUtilities.getMessageBuffers(e[n],t))}))},UranusUtilities.getAbsoluteUrl=function(e){if(0===e.indexOf("http"))return e;const t=new URL(window.location.href);let n=t.origin;return 0===e.indexOf("/")?n+=e:n+=t.pathname+e,n},UranusUtilities.serializeEntityTRS=function(e){const t=e.getLocalPosition(),n=e.getLocalEulerAngles(),s=e.getLocalScale();return{position:{x:t.x,y:t.y,z:t.z},rotation:{x:n.x,y:n.y,z:n.z},scale:{x:s.x,y:s.y,z:s.z}}},UranusUtilities.serializeVec3=function(e){return{x:e.x,y:e.y,z:e.z}},UranusUtilities.deserializeVec3=function(e){return new pc.Vec3(e.x,e.y,e.z)},UranusUtilities.prepareShaderForInjection=function(e,t){const n=`${t}_uranusBase`;if(e.chunks[n])return;let s;"transformVS"===t?s="\n// INJECT uniforms\n\nuniform mat4 matrix_view;\nuniform vec3 view_position;\n\n#ifdef PIXELSNAP\nuniform vec4 uScreenSize;\n#endif\n\n#ifdef MORPHING\nuniform vec4 morph_weights_a;\nuniform vec4 morph_weights_b;\n#endif\n\n#ifdef MORPHING_TEXTURE_BASED\nuniform vec4 morph_tex_params;\n\nvec2 getTextureMorphCoords() {\n    float vertexId = morph_vertex_id;\n    vec2 textureSize = morph_tex_params.xy;\n    vec2 invTextureSize = morph_tex_params.zw;\n\n    // turn vertexId into int grid coordinates\n    float morphGridV = floor(vertexId * invTextureSize.x);\n    float morphGridU = vertexId - (morphGridV * textureSize.x);\n\n    // convert grid coordinates to uv coordinates with half pixel offset\n    return (vec2(morphGridU, morphGridV) * invTextureSize) + (0.5 * invTextureSize);\n}\n#endif\n\n#ifdef MORPHING_TEXTURE_BASED_POSITION\nuniform highp sampler2D morphPositionTex;\n#endif\n\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n    return getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n    return matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);\n    #elif defined(INSTANCING)\n    return mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n    #else\n    return matrix_model;\n    #endif\n}\n\nvec4 getPosition() {\n    dModelMatrix = getModelMatrix();\n    vec3 localPos = vertex_position;\n\n    #ifdef NINESLICED\n    // outer and inner vertices are at the same position, scale both\n    localPos.xz *= outerScale;\n\n    // offset inner vertices inside\n    // (original vertices must be in [-1;1] range)\n    vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n    vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n    localPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\n    vTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0; // uv = local pos - inner corner\n\n    localPos.xz *= -0.5; // move from -1;1 to -0.5;0.5\n    localPos = localPos.xzy;\n    #endif\n\n    #ifdef MORPHING\n    #ifdef MORPHING_POS03\n    localPos.xyz += morph_weights_a[0] * morph_pos0;\n    localPos.xyz += morph_weights_a[1] * morph_pos1;\n    localPos.xyz += morph_weights_a[2] * morph_pos2;\n    localPos.xyz += morph_weights_a[3] * morph_pos3;\n    #endif // MORPHING_POS03\n    #ifdef MORPHING_POS47\n    localPos.xyz += morph_weights_b[0] * morph_pos4;\n    localPos.xyz += morph_weights_b[1] * morph_pos5;\n    localPos.xyz += morph_weights_b[2] * morph_pos6;\n    localPos.xyz += morph_weights_b[3] * morph_pos7;\n    #endif // MORPHING_POS47\n    #endif // MORPHING\n\n    #ifdef MORPHING_TEXTURE_BASED_POSITION\n    // apply morph offset from texture\n    vec2 morphUV = getTextureMorphCoords();\n    vec3 morphPos = texture2D(morphPositionTex, morphUV).xyz;\n    localPos += morphPos;\n    #endif\n\n    vec4 posW = dModelMatrix * vec4(localPos, 1.0);\n\n// INJECT chunk\n\n    #ifdef SCREENSPACE\n    posW.zw = vec2(0.0, 1.0);\n    #endif\n    dPositionW = posW.xyz;\n\n    vec4 screenPos;\n\n    #ifdef UV1LAYOUT\n    screenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n    #else\n    #ifdef SCREENSPACE\n    screenPos = posW;\n    #else\n    screenPos = matrix_viewProjection * posW;\n    #endif\n\n    #ifdef PIXELSNAP\n    // snap vertex to a pixel boundary\n    screenPos.xy = (screenPos.xy * 0.5) + 0.5;\n    screenPos.xy *= uScreenSize.xy;\n    screenPos.xy = floor(screenPos.xy);\n    screenPos.xy *= uScreenSize.zw;\n    screenPos.xy = (screenPos.xy * 2.0) - 1.0;\n    #endif\n    #endif\n\n    return screenPos;\n}\n\nvec3 getWorldPosition() {\n    return dPositionW;\n}           \n":(s=`\n// INJECT uniforms\n\n${pc.shaderChunks[t]}\n`,s=s.replace("() {","() {                \n// INJECT preChunk\n"),s=s.replace(new RegExp("}\n"),"\n// INJECT chunk\n}    \n")),e.chunks[n]=s},UranusUtilities.addUranusBaseUniforms=function(e){let t;if(e.chunks.basePS){if(t=e.chunks.basePS,t.indexOf("uranus_view_position")>-1)return}else t=pc.shaderChunks.basePS;e.chunks.basePS=`\nuniform vec3 uranus_view_position;\n\n${t}\n`,e.chunks.APIVersion=pc.CHUNKAPI_1_62},UranusUtilities.textCapitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},UranusUtilities.findEntityMeshInstances=function(e,t){let n=[];Array.isArray(e)?e.forEach((e=>{e instanceof pc.Entity!=0&&(n=n.concat(e.findComponents("model").concat(e.findComponents("render"))))})):n=e.findComponents("model").concat(e.findComponents("render")),t&&(n=n.filter((e=>!1===e.entity.tags.has(...t))));let s=[];return n.forEach((e=>{s=s.concat(e.meshInstances)})),s},UranusUtilities.getMeshGeometry=function(e){const t=e.node.getWorldTransform(),n=e.mesh.vertexBuffer,s=new pc.VertexIterator(n),i=[],a=new pc.Vec3;for(let e=0;e<n.getNumVertices();e++){const e=s.element[pc.SEMANTIC_POSITION],n=e.array[e.index],r=e.array[e.index+1],o=e.array[e.index+2];a.set(n,r,o),t.transformPoint(a,a),i.push(a.x,a.y,a.z),s.next()}s.end();const r=e.mesh.indexBuffer[pc.RENDERSTYLE_SOLID],o=new Uint16Array(r.lock()),l=[],c=e.mesh.primitive[0].base,u=e.mesh.primitive[0].count;for(let e=0;e<u;e++)l.push(o[e+c]);return{vertices:i,indices:l,numIndices:u,numVertices:i.length/3}},UranusUtilities.getCombinedGeometry=function(e){const t=[],n=[];let s=0,i=0;for(let a=0;a<e.length;a++){const r=e[a],o=UranusUtilities.getMeshGeometry(r);let l=0;for(let e=0;e<o.vertices.length;e+=3)n.push(o.vertices[e],o.vertices[e+1],o.vertices[e+2]),l++;for(let e=0;e<o.indices.length;e+=3)t.push(o.indices[e+2]+i,o.indices[e+1]+i,o.indices[e]+i);s+=o.vertices.length/3,i+=l}return{positions:n,indices:t,offset:s}},UranusUtilities.vecToRecast=function(e){return new Recast.Vec3(e.x,e.y,e.z)},UranusUtilities.recastToVec=function(e,t){return t?t.set(e.x,e.y,e.z):new pc.Vec3(e.x,e.y,e.z)},UranusUtilities.loadGlbContainerFromAsset=function(e,t,n,s){const i=pc.Application.getApplication();var a=function(e){var i=new Blob([e.resource]),a=URL.createObjectURL(i);return this.loadGlbContainerFromUrl(a,t,n,(function(e,t){s(e,t),URL.revokeObjectURL(a)}))}.bind(this);e.ready(a),i.assets.load(e)},UranusUtilities.loadGlbContainerFromUrl=function(e,t,n,s){const i=pc.Application.getApplication();var a=n+".glb",r={url:e,filename:a},o=new pc.Asset(a,"container",r,null,t);return o.once("load",(function(e){if(s){var t=e.resource.animations;if(1==t.length)t[0].name=n;else if(t.length>1)for(var i=0;i<t.length;++i)t[i].name=n+" "+i.toString();s(null,e)}})),i.assets.add(o),i.assets.load(o),o},UranusUtilities.getUrlParam=function(e){const t=new URLSearchParams(window.location.search);if(!0===t.has(e))return t.get(e)},UranusUtilities.addUrlParam=function(e,t){const n=new URL(window.location);n.searchParams.set(e,t),window.history.pushState(null,"",n.toString())},UranusUtilities.removeUrlParam=function(e){const t=new URL(window.location);t.searchParams.delete(e),window.history.pushState(null,"",t.toString())},UranusUtilities.itemHasTag=function(e,t){if(window.UranusEditor&&!0===window.UranusEditor.inEditor()){let n;return e instanceof pc.Entity?n=editor.entities.get(e._guid):e instanceof pc.Asset&&(n=editor.assets.get(e.id)),!!n&&n&&n.get("tags").indexOf(t)>-1}return e.tags.has(t)},UranusUtilities.shuffleArray=function(e,t){t||(t=Math.random);for(var n=e.length-1;n>0;n--){var s=Math.floor(t()*(n+1)),i=e[n];e[n]=e[s],e[s]=i}return e},UranusUtilities.roundValueToFixed=[],UranusUtilities.roundValueToFixed[0]=1,UranusUtilities.roundValueToFixed[1]=10,UranusUtilities.roundValueToFixed[2]=100,UranusUtilities.roundValueToFixed[3]=1e3,UranusUtilities.roundValueToFixed[4]=1e4,UranusUtilities.roundValue=function(e,t){return Math.round(e*t)/t},UranusUtilities._distanceVec3=new pc.Vec3,UranusUtilities.raycastFirstRigidbody=function(e,t,n,s){const i=UranusUtilities._distanceVec3;let a=Number.MAX_VALUE,r=null;const o=pc.app.systems.rigidbody.raycastAll(e,t);for(let t=0;t<o.length;++t){const l=o[t],c=l.entity.rigidbody;if(c&&(void 0===n||c.group!==n)&&(void 0===s||l.entity!==s)){i.sub2(l.point,e);const t=i.lengthSq();t<a&&(a=t,r=l)}}return r},UranusUtilities.raycastFirstColliderTag=function(e,t,n){const s=UranusUtilities._distanceVec3;let i=Number.MAX_VALUE,a=null;const r=pc.app.systems.rigidbody.raycastAll(e,t);for(let t=0;t<r.length;++t){const o=r[t];if(o?.entity.tags.has(n)){s.sub2(o.point,e);const t=s.lengthSq();t<i&&(i=t,a=o)}}return a},UranusUtilities.smoothDampVec3=function(e,t,n,s,i,a){var r=0,o=0,l=0,c=2/(s=Math.max(1e-4,s)),u=c*a,d=1/(1+u+.48*u*u+.235*u*u*u),p=e.x-t.x,h=e.y-t.y,f=e.z-t.z,y=t,m=i*s,g=p+p+h+h+f+f;if(g>Math.pow(i,2)){var I=Math.sqrt(g);p=p/I*m,h=h/I*m,f=f/I*m}t.x=e.x-p,t.y=e.y-h,t.z=e.z-f;var U=(n.x+c*p)*a,b=(n.y+c*h)*a,x=(n.z+c*f)*a;n.x=(n.x-c*U)*d,n.y=(n.y-c*b)*d,n.z=(n.z-c*x)*d,r=t.x+(p+U)*d,o=t.y+(h+b)*d,l=t.z+(f+x)*d;var v=y.x-e.x,w=y.y-e.y,P=y.z-e.z;v*(r-y.x)+w*(o-y.y)+P*(l-y.z)>0&&(r=y.x,o=y.y,l=y.z,n.x=(r-y.x)/a,n.y=(o-y.y)/a,n.z=(l-y.z)/a),e.x=r,e.y=o,e.z=l},UranusUtilities.isEven=function(e){return e%2},UranusUtilities.random=function(e,t,n){const s=t-e;return(n||Math.random)()*s+e},UranusUtilities.randomInt=function(e,t,n){const s=n||Math.random;return e=Math.ceil(e),t=Math.floor(t),Math.floor(s()*(t-e+1))+e},UranusUtilities.setRenderState=function(e,t){!0===e.uranusIsInstanced?e.uranusZoneActive=t:e.render.enabled=t},UranusUtilities.setTimeout=function(e,t){let n=0;const s=pc.app.on("update",(function(i){n+=i,1e3*n>t&&(s.off(),e())}));return s};var UranusInstancerState=pc.createScript("uranusInstancerState");UranusInstancerState.attributes.add("stateToSet",{type:"boolean",default:!0,title:"State to Set",description:"The state to set on the enabled property when visibility is true."}),UranusInstancerState.attributes.add("targetEntity",{type:"entity",title:"Target Entity",description:"The target entity to apply the state on. Leave empty to apply on this entity."}),UranusInstancerState.attributes.add("stateTimeout",{type:"number",default:25,title:"State Timeout",description:"Set how often state visibility calculations will take place. Set to 0.0 to execute them per frame (more expensive)."}),UranusInstancerState.attributes.add("components",{type:"string",array:!0,title:"Components",description:"Add a list of components to toggle their state."}),UranusInstancerState.prototype.initialize=function(){this.stateTimer=this.stateTimeout,this.target=this.targetEntity?this.targetEntity:this.entity},UranusInstancerState.prototype.update=function(e){if(this.stateTimer++,this.stateTimer<this.stateTimeout)return;this.stateTimer=0;const t=!!this.entity.uranusIsVisible,n=this.target;if(this.components.length>0)for(const e of this.components)n[e].enabled=t?this.stateToSet:!this.stateToSet;else n.enabled=t?this.stateToSet:!this.stateToSet};var UranusInstancerOcclusion=pc.createScript("uranusInstancerOcclusion");UranusInstancerOcclusion.attributes.add("inEditor",{type:"boolean",default:!1}),UranusInstancerOcclusion.attributes.add("occlusionType",{type:"string",default:"occluder",enum:[{Occluder:"occluder"},{Occludee:"occludee"}],title:"Occlusion Type",description:"1. Occluder: this entity will act as an occluder and obstruct occludees. 2. Occludee: this entity will act as an occludee and getting obstructed by occluders. A hardware occlusion query will execute for this entity based on its occlusion shape. The entity will be automatically change its visible status based on the query result."}),UranusInstancerOcclusion.attributes.add("occlusionShape",{type:"string",default:"calculateBounding",enum:[{"Calculate Bounding":"calculateBounding"},{"Collision Bounding":"collisionBounding"},{"Raw Geometry":"rawGeometry"},{None:"none"}],title:"Occlusion Shape",description:"1. Calculate Bounding: the script will automatically calculate the total bounding box of the model. 2. Collision Bounding: If a box collision component is provided that bounding box will be used. 3. Raw Geometry: No bounding box will be created, the raw geometry will be rendered in the Occlusion Layer. This provides accurate queries at the cost of performance. 4. None: The script will not add any model to the Occlusion Layer. Requires application restart."}),UranusInstancerOcclusion.attributes.add("boundingScale",{type:"number",default:1,title:"Bounding Scale",description:"Set the bounding box scale when Calculate Bounding is used."}),UranusInstancerOcclusion.attributes.add("isStatic",{type:"boolean",default:!0,title:"Is Static",description:"If selected the occluder will not update its position/rotation/scale per frame, this is a performance optimization."}),UranusInstancerOcclusion.attributes.add("behaviorResult",{type:"string",default:"visibilityState",enum:[{"Visibility State":"visibilityState"},{"Entity State":"entityState"},{None:"none"}],title:"Behavior Result",description:"Controls what will happen When the occlusion query returns a new visibility state (works for Occludees only). 1. Visibility State: The model will change its visibility state. 2. Entity State: The entity will change its Enabled property. 3. Nothing will happen and only onEvent will fire if provided. Useful for gameplay only queries."}),UranusInstancerOcclusion.attributes.add("refEntities",{type:"entity",array:!0,title:"Reference Entities",description:"Optionally provide one or more entities that this occludee is responsible for managing their state instead of this entity."}),UranusInstancerOcclusion.attributes.add("bypassInstancer",{type:"boolean",default:!1,title:"Bypass Instancer",description:"If selected the occludee will toggle its model/render component instead of using the instancer to handle visibility."}),UranusInstancerOcclusion.attributes.add("onEvent",{type:"string",title:"On Event",description:"If an event name is provided it will automatically fire on the pc.Application context when the visibility state changes."}),UranusInstancerOcclusion.attributes.add("eventEntity",{type:"entity",title:"Event Entity",description:"If an entity is provided instead of firing an app wide event it will fire on the entity instead."}),UranusInstancerOcclusion.prototype.initialize=function(){!1!==this.app.graphicsDevice.isWebGL2&&(this.bounding=new pc.BoundingBox,this.occlusionEntity=void 0,this.useWorldTransform=!1,this.useCollisionBounding=!1,this.glQuery=void 0,this.enableOcclusionCulling(),this.prepareOcclusionEntity(),this.addOcclusionQuery(),this.on("state",(function(e){this.occlusionEntity&&"entityState"!==this.behaviorResult&&(this.occlusionEntity.enabled=e)})),this.on("destroy",(function(){this.glQuery&&this.app.graphicsDevice.gl.deleteQuery(this.glQuery),this.occlusionEntity&&this.occlusionEntity.destroy()})))},UranusInstancerOcclusion.prototype.update=function(){!1===this.isStatic&&this.occlusionEntity&&this.updateTransform()},UranusInstancerOcclusion.prototype.updateTransform=function(){const e=this.entity,t=this.occlusionEntity;if(this.useWorldTransform){const n=e.getWorldTransform();t.setPosition(n.getTranslation()),t.setEulerAngles(n.getEulerAngles()),t.setLocalScale(n.getScale())}else{const n=this.bounding;if(this.useCollisionBounding){const t=e.collision;n.center.copy(t.getShapePosition()),n.halfExtents.copy(t.halfExtents)}else e.render.meshInstances.forEach(((e,t)=>{0===t?n.copy(e.aabb):n.add(e.aabb)}));t.setPosition(n.center),t.setLocalScale(2*n.halfExtents.x,2*n.halfExtents.y,2*n.halfExtents.z)}},UranusInstancerOcclusion.prototype.prepareOcclusionEntity=function(){const e=this.app.scene.layers.getLayerByName("Occlusion");e&&("none"!==this.occlusionShape?("rawGeometry"===this.occlusionShape?(this.occlusionEntity=new pc.Entity,this.entity.render.system.cloneComponent(this.entity,this.occlusionEntity),this.occlusionEntity.render.layers=[e.id],this.app.root.addChild(this.occlusionEntity),this.useWorldTransform=!0):(this.occlusionEntity=new pc.Entity,this.occlusionEntity.addComponent("render",{type:"box",layers:[e.id]}),this.occlusionEntity.setLocalScale(this.boundingScale,this.boundingScale,this.boundingScale),this.app.root.addChild(this.occlusionEntity),"collisionBounding"===this.occlusionShape&&this.entity.collision&&"box"===this.entity.collision.type&&(this.useCollisionBounding=!0)),this.updateTransform(),this.occlusionEntity.render.meshInstances.forEach((e=>e.isOccludee="occludee"===this.occlusionType))):this.occlusionEntity=this.entity)},UranusInstancerOcclusion.prototype.addOcclusionQuery=function(){if(!this.occlusionEntity||"occludee"===!this.occlusionType)return;const e=this.app.graphicsDevice.gl;this.occlusionEntity.render.meshInstances.forEach((t=>{const n={inProgress:!1,meshInstance:t,onOcclusionResult:e=>this.setVisibleState(e),query:e.createQuery()};this.glQuery=n.query,t.uranusInstancerOcclusion=n}))},UranusInstancerOcclusion.prototype.setVisibleState=function(e){const t=this.refEntities,n=t.length>0;this.bypassInstancer?"visibilityState"===this.behaviorResult?n?t.forEach((t=>t.render.enabled=e)):this.entity.render.enabled=e:"entityState"===this.behaviorResult&&(n?t.forEach((t=>t.enabled=e)):this.entity.enabled=e):"visibilityState"===this.behaviorResult?n?t.forEach((t=>t.uranusZoneActive=e)):this.entity.uranusZoneActive=e:"entityState"===this.behaviorResult&&(n?t.forEach((t=>t.enabled=e)):this.entity.enabled=e),this.onEvent&&(this.eventEntity?this.eventEntity:this.app).fire(this.onEvent,e)},UranusInstancerOcclusion.cullingEnabled=!1,UranusInstancerOcclusion.layer=void 0,UranusInstancerOcclusion.nextLayer=void 0,UranusInstancerOcclusion.bypassCulling=void 0,UranusInstancerOcclusion.toggleDebugger=function(){const e=UranusInstancerOcclusion.nextLayer;e&&(e.clearColorBuffer=!e.clearColorBuffer,e.clearDepthBuffer=!e.clearDepthBuffer)},UranusInstancerOcclusion.setOcclusionState=function(e){UranusInstancerOcclusion.layer.opaqueMeshInstances.forEach((t=>{const n=t.uranusInstancerOcclusion;t.visible=e,!1===e&&n&&(n.onOcclusionResult(!0),n.inProgress=!1)}))},UranusInstancerOcclusion.prototype.enableOcclusionCulling=function(){if(UranusInstancerOcclusion.cullingEnabled)return;UranusInstancerOcclusion.cullingEnabled=!0;const e=this.app.scene.layers.getLayerByName("Occlusion");UranusInstancerOcclusion.layer=e,e.opaqueSortMode=pc.SORTMODE_CUSTOM,e.passThrough=!0,e.shaderPass=pc.SHADER_DEPTH;const t=this.app.scene.layers.layerList.findIndex((e=>"Occlusion"===e.name))+1,n=this.app.scene.layers.layerList[t];UranusInstancerOcclusion.nextLayer=n,n.clearColorBuffer=!0,n.clearDepthBuffer=!0,e.customCalculateSortValues=function(e,t,n,s){this._calculateSortDistances(e,t,n,s)},e.customSortCallback=function(e,t){return e.isOccludee||t.isOccludee?e.isOccludee&&t.isOccludee?t.zdist-e.zdist:e.isOccludee?1:-1:e.zdist-t.zdist},pc.app.renderer.drawInstance=function(e,t,n,s,i){const a=t.instancingData;if(a)a.count>0&&(this._instancedDrawCalls++,e.setVertexBuffer(a.vertexBuffer),e.draw(n.primitive[s],a.count));else{const a=t.node.worldTransform;this.modelMatrixId.setValue(a.data),i&&this.normalMatrixId.setValue(t.node.normalMatrix.data);const r=pc.app.graphicsDevice.gl,o=t.uranusInstancerOcclusion;if(o&&o.inProgress&&r.getQueryParameter(o.query,r.QUERY_RESULT_AVAILABLE)){const e=!!r.getQueryParameter(o.query,r.QUERY_RESULT);o.onOcclusionResult(e),o.inProgress=!1}o&&!o.inProgress&&r.beginQuery(r.ANY_SAMPLES_PASSED_CONSERVATIVE,o.query),e.draw(n.primitive[s]),o&&!o.inProgress&&(r.endQuery(r.ANY_SAMPLES_PASSED_CONSERVATIVE),o.inProgress=!0)}}.bind(pc.app.renderer)};var CubemapRenderer=pc.createScript("cubemapRenderer");CubemapRenderer.attributes.add("inEditor",{type:"boolean",default:!0}),CubemapRenderer.attributes.add("resolution",{title:"Resolution",description:"Resolution of one side of a cubemap. Use power of 2 resolution if you wish to use Mipmaps.",type:"number",default:64}),CubemapRenderer.attributes.add("mipmaps",{title:"Mipmaps",description:"If set to true, mipmaps will be allocated and autogenerated.",type:"boolean",default:!1}),CubemapRenderer.attributes.add("depth",{title:"Depth",description:"If set to true, depth buffer will be created.",type:"boolean",default:!0}),CubemapRenderer.prototype.initialize=function(){var e=this.entity.camera;if(!e)return void console.error("CubemapRenderer component requires Camera component to be created on the Entity.");e.enabled=!1;var t=Math.min(this.resolution,this.app.graphicsDevice.maxCubeMapSize);this.cubeMap=new pc.Texture(this.app.graphicsDevice,{width:t,height:t,format:pc.PIXELFORMAT_R8_G8_B8_A8,cubemap:!0,mipmaps:this.mipmaps,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR});var i=[(new pc.Quat).setFromEulerAngles(0,90,0),(new pc.Quat).setFromEulerAngles(0,-90,0),(new pc.Quat).setFromEulerAngles(-90,0,180),(new pc.Quat).setFromEulerAngles(90,0,180),(new pc.Quat).setFromEulerAngles(0,180,0),(new pc.Quat).setFromEulerAngles(0,0,0)];const a=new pc.Entity("CubeMapCameras");this.CubeMapCameras=a,this.entity.addChild(a);for(var n=0;n<6;n++){var r=new pc.RenderTarget({colorBuffer:this.cubeMap,depth:this.depth,face:n,flipY:!0}),s=new pc.Entity("CubeMapCamera_"+n);s.uranusReflectionsCamera=!0,s.addComponent("camera",{aspectRatio:1,fov:90,layers:e.layers,priority:e.priority,clearColor:e.clearColor,clearColorBuffer:e.clearColorBuffer,clearDepthBuffer:e.clearDepthBuffer,clearStencilBuffer:e.clearStencilBuffer,farClip:e.farClip,nearClip:e.nearClip,frustumCulling:e.frustumCulling,flipFaces:e.flipFaces,renderTarget:r}),s.camera.uranusCubeMapCamera=!0,a.addChild(s),s.setRotation(i[n]),0===n&&(s.camera.onPreRender=()=>{this.entity.fire("onCubemapPreRender")}),5===n&&(s.camera.onPostRender=()=>{this.entity.fire("onCubemapPostRender")})}this.on("state",(function(e){this.CubeMapCameras.enabled=e}))};var UranusEffectsWater=pc.createScript("uranusEffectsWater");UranusEffectsWater.attributes.add("inEditor",{type:"boolean",default:!0}),UranusEffectsWater.attributes.add("materialAsset",{type:"asset",assetType:"material"}),UranusEffectsWater.attributes.add("activeCameras",{type:"entity",array:!0,title:"Active Cameras",description:"A list of cameras that render the water model, used to enable depth access to these cameras."}),UranusEffectsWater.attributes.add("infiniteSurface",{type:"boolean",default:!0,title:"Infinite Surface",description:"If selected the water surface will follow the active camera to give the illusion of an infinite water surface. Useful for sea and ocean effects."}),UranusEffectsWater.attributes.add("waterScale",{type:"number",default:50,min:0,title:"Water Scale",description:"The scale of the water surface (texture tiling)."}),UranusEffectsWater.attributes.add("depthOpacity",{type:"number",default:.05,min:0,max:1,title:"Depth Opacity",description:"Sets the amount of opacity the water will have as it gets deeper."}),UranusEffectsWater.attributes.add("refractionOpacity",{type:"number",default:.05,min:0,max:1,precision:3,title:"Refraction Opacity",description:"Sets the amount of opacity the refraction effect will have as it gets deeper."}),UranusEffectsWater.attributes.add("causticsMapAsset",{type:"asset",assetType:"texture",title:"Caustics Map",description:"The caustics map used to simulate the water caustics effects."}),UranusEffectsWater.attributes.add("causticsOpacity",{type:"number",default:.2,min:0,max:1,title:"Caustics Opacity",description:"Sets the amount of caustics effects the water will have as it gets deeper."}),UranusEffectsWater.attributes.add("causticsIntensity",{type:"number",default:10,min:0,title:"Caustics Intensity",description:"Sets the intensity of the caustics effect."}),UranusEffectsWater.attributes.add("causticsTiling",{type:"number",default:250,min:0,title:"Caustics Tiling",description:"Sets the tiling of the caustics effect."}),UranusEffectsWater.attributes.add("shoreOpacity",{type:"number",default:.5,min:0,title:"Shore Opacity",description:"Sets the amount of shore effects the water will have as it gets deeper."}),UranusEffectsWater.attributes.add("shoreIntensity",{type:"number",default:10,min:0,title:"Shore Intensity",description:"Sets the intensity of the shore effect."}),UranusEffectsWater.attributes.add("shoreTiling",{type:"number",default:250,min:0,title:"Shore Tiling",description:"Sets the tiling of the shore effect."}),UranusEffectsWater.attributes.add("shoreFrequency",{type:"number",default:.1,min:0,title:"Shore Frequency",description:"Sets the animation speed of shore effects on the water."}),UranusEffectsWater.attributes.add("flowMapAsset",{type:"asset",assetType:"texture",title:"Flow Map",description:"The flow map used to simulate the water flow effects."}),UranusEffectsWater.attributes.add("flowFrequency",{type:"number",default:.5,min:0,title:"Flow Frequency",description:"Sets the animation speed of flow effects on the water."}),UranusEffectsWater.attributes.add("reflectionsIntensity",{type:"number",default:1,min:0,title:"Reflections Intensity",description:"Sets the intensity of the reflections map."}),UranusEffectsWater.attributes.add("refractionIntensity",{type:"number",default:1,min:0,title:"Refraction Intensity",description:"Sets the intensity of the refraction map."}),UranusEffectsWater.attributes.add("reflectionsBumpiness",{type:"number",default:1,min:0,precision:3,title:"Reflections Bumpiness",description:"Sets the intensity of the reflections bumpiness."}),UranusEffectsWater.attributes.add("refractionBumpiness",{type:"number",default:1,min:0,precision:3,title:"Refraction Bumpiness",description:"Sets the intensity of the refraction bumpiness."}),UranusEffectsWater.attributes.add("specularColor",{type:"rgb",default:[.98,.97,.7],title:"Specular Color",description:"Sets the color of the specular highlights."}),UranusEffectsWater.attributes.add("specularIntensity",{type:"number",default:1e3,min:0,title:"Specular Intensity",description:"Sets the intensity of the specular highlights."}),UranusEffectsWater.attributes.add("specularBlinking",{type:"number",default:.1,min:0,title:"Specular Blinking",description:"If a value > 0 is provided the specular highlights will blink based on that frequency."}),UranusEffectsWater.attributes.add("underwaterFogDensity",{type:"number",default:0,min:0,title:"Underwater Fog Density",description:"Sets the intensity of the scene fog when the active camera is under the water surface. Set to 0.0 to disable this check."}),UranusEffectsWater.attributes.add("vertexWaves",{type:"boolean",default:!1,title:"Vertex Waves",description:"If selected the vertices of the water surface will animate to simulate waves. Requires a water plane with enough triangles per unit. Requires application reload."}),UranusEffectsWater.attributes.add("wavesFrequency",{type:"number",default:.2,min:0,title:"Waves Frequency",description:"The frequency of the sin/cos of the vertex waves."}),UranusEffectsWater.attributes.add("wavesAmplitude",{type:"number",default:3,min:0,title:"Waves Amplitude",description:"The amplitude of the sin/cos of the vertex waves."}),UranusEffectsWater.attributes.add("wavesDepthMinMax",{type:"vec2",default:[.05,.5],title:"Waves Depth Min Max",description:"The min/max values to clamp the minimum and maximum wave height based on the water depth."}),UranusEffectsWater.attributes.add("renderSurface",{type:"entity",title:"Render Surface",description:"If a uranusEffectsRenderSurface entity is referenced the material will use the depth from the surface to improve the look of several effects."}),UranusEffectsWater.prototype.initialize=function(){if(!0===this.app.graphicsDevice.isWebGL1)return void(this.enabled=!1);this.vec=new pc.Vec3,this.time=0,this.normalMapUniform0=[0,0,0],this.normalMapUniform1=[0,0,0],this.waterInitialPos=this.entity.getPosition().clone(),this.renderSurfaceParams=[0,0,0,0],this.hasSurfaceDepth=!1,this.prepare(),this.on("attr",(function(e,t){"specularBlinking"!==e?this.updateAttributes():this.updateMaterial()})),this.on("state",(function(e){e?this.updateMaterial():this.clearMaterial()}));const e=this.entity.script.uranusEffectsPlanarReflections;e&&e.on("attr",this.updateMaterial.bind(this))},UranusEffectsWater.prototype.prepare=async function(){const e=this.renderSurface?.script?.uranusEffectsRenderSurface;e&&(this.hasSurfaceDepth=!0,e.on("uranusEffectsRenderSurface:_ready",(function(){this.updateAttributes()}),this)),await UranusUtilities.loadAssets([this.materialAsset,this.causticsMapAsset,this.flowMapAsset]),this.materialAsset.ready(this.onMaterialReady.bind(this)),this.materialAsset.on("change",this.onMaterialReady.bind(this))},UranusEffectsWater.prototype.update=function(e){this.time+=e;const t=this.material;if(t){t.setParameter("waterUpdateTime",this.time);const i=t.normalMapTiling,a=this.normalMapUniform0;a[0]=i.x,a[1]=0,a[2]+=e*(.02+.05*Math.sin(this.time)),t.setParameter("texture_normalMapTransform0",a);const n=this.normalMapUniform1;n[0]=0,n[1]=i.y,n[2]+=e*(.02+.05*Math.sin(this.time)),t.setParameter("texture_normalMapTransform1",n)}if(this.activeCameras){let e;if(this.activeCameras.forEach((t=>{t.enabled&&(e=t)})),!e)return;const t=e.getPosition();if(this.underwaterFogDensity>0){this.app.scene.fogDensityDefault||(this.app.scene.fogDensityDefault=this.app.scene.fogDensity);const e=t.y<this.entity.getPosition().y;this.app.scene.fogDensity=e?this.underwaterFogDensity:this.app.scene.fogDensityDefault}if(this.infiniteSurface){const e=this.vec.copy(t);e.y=this.waterInitialPos.y,this.entity.setPosition(e)}}},UranusEffectsWater.prototype.updateAttributes=function(){const e=this.material;if(!e)return;e.setParameter("wavesFrequency",this.wavesFrequency),e.setParameter("wavesAmplitude",this.wavesAmplitude),e.setParameter("wavesDepthMinMax",this.wavesDepthMinMax.data),e.setParameter("waterScale",this.waterScale),e.setParameter("depthOpacity",this.depthOpacity),e.setParameter("refractionOpacity",this.refractionOpacity),e.setParameter("causticsOpacity",this.causticsOpacity),e.setParameter("shoreOpacity",this.shoreOpacity),e.setParameter("causticsIntensity",this.causticsIntensity),e.setParameter("causticsTiling",this.causticsTiling),e.setParameter("shoreIntensity",this.shoreIntensity),e.setParameter("shoreTiling",this.shoreTiling),e.setParameter("shoreFrequency",this.shoreFrequency),e.setParameter("texture_causticsMapAsset",this.causticsMapAsset.resource),e.setParameter("texture_flowMap",this.flowMapAsset.resource),e.setParameter("flowFrequency",this.flowFrequency),e.setParameter("reflectionsIntensity",this.reflectionsIntensity),e.setParameter("refractionIntensity",this.refractionIntensity),e.setParameter("reflectionsBumpiness",this.reflectionsBumpiness),e.setParameter("refractionBumpiness",this.refractionBumpiness),e.setParameter("specularColor",this.specularColor.data3),e.setParameter("specularIntensity",this.specularIntensity);const t=this.renderSurface?.script?.uranusEffectsRenderSurface;if(t)if(t.ready){this.entity.render.enabled=!0;const i=t.surfaceBounding.halfExtents,a=t.entity.getPosition(),n=i.x,r=2*i.x,s=2*i.z,o=this.renderSurfaceParams;o[0]=n-a.x,o[1]=-(n+a.z),o[2]=r,o[3]=s,e.setParameter("texture_depthSurface",t.depthTexture),e.setParameter("renderSurfaceParams",o),e.setParameter("renderFarClip",2*i.y),e.setParameter("renderPosY",t.surfaceCameraPos.y)}else this.entity.render.enabled=!1},UranusEffectsWater.prototype.onMaterialReady=function(){this.updateMaterial()},UranusEffectsWater.prototype.updateMaterial=function(){this.material=this.materialAsset.resource;const e=this.material,t=this.entity.script.uranusEffectsPlanarReflections;e.chunks.startVS=this.getStartVS(),this.vertexWaves&&(e.chunks.transformVS=this.getTransformVS(),e.chunks.normalVS=this.getNormalVS()),e.chunks.opacityPS=this.getOpacity(),e.chunks.normalMapPS=this.getNormalMap(),e.chunks.diffusePS=this.getDiffuse(t),e.chunks.lightSpecularBlinnPS=this.getLightSpecular(),e.chunks.combinePS=this.getCombineColor(),this.material.update(),this.updateAttributes()},UranusEffectsWater.prototype.clearMaterial=function(){this.material&&(delete this.material.chunks.startVS,delete this.material.chunks.transformVS,delete this.material.chunks.normalVS,delete this.material.chunks.opacityPS,delete this.material.chunks.diffusePS,delete this.material.chunks.normalMapPS,delete this.material.chunks.lightSpecularBlinnPS,delete this.material.chunks.combinePS,this.material.update())},UranusEffectsWater.prototype.getDiffuse=function(e){const t=e&&!0===e.enabled,i=e.renderReflection,a=e.renderRefraction;let n="";return t&&(i&&(n+="uniform sampler2D texture_planarReflectionMap;\n"),a&&(n+="uniform sampler2D texture_planarRefractionMap;\n")),`\n#ifdef MAPCOLOR\nuniform vec3 material_diffuse;\n#endif\n\n#ifdef MAPTEXTURE\nuniform sampler2D texture_diffuseMap;\n#endif\n\n${n}\nuniform mat3 matrix_view3;\n\nvec2 getReflectionCoords(float bumpiness, vec3 viewDirS) {\n\n    vec2 reflCoords = gl_FragCoord.xy * uScreenSize.zw;\n    //reflCoords.xy -= viewDirS.xy * (-0.086 * material_bumpiness);\n\n    vec2 dx = dFdx(reflCoords);\n    vec2 dy = dFdy(reflCoords);\n    float flatten = dot(abs(dy*1.0),vec2(1.0));    \n\n    vec2 dudv = dNormalW.xz;\n    dudv.x *= 0.0;\n    dudv.y *= 2.0${this.vertexWaves?" - (1.0 - dVertexDepth)":""}; // to avoid leaking reflections at the top of the object\n    dudv /= flatten*3.0+1.0;\n\n    reflCoords += dudv * bumpiness;\n    return reflCoords;\n}\n\nvoid getAlbedo() {\n\n    float fangle = 1.0+dot(dViewDirW, dNormalW);\n    fangle = pow(fangle,5.0);\n    float fresnelTerm = 1.0 - 1.0/fangle;\n\n    // --- caustics\n    vec2 normalPos = dhA.xy + dhB.xy;\n    vec2 shorePos = normalPos + dWaterUV * vec2(texture_normalMapTransform0.x, texture_normalMapTransform1.y);\n    float shoreSample = texture2D(texture_causticsMapAsset, shorePos, textureBias).r;\n\n    vec2 causticsPos = shoreSample * dWaterDepth + (cos(waterUpdateTime) + sin(waterUpdateTime)) * 0.05 + normalPos + dWaterUV * causticsTiling;\n    float causticsSample = texture2D(texture_causticsMapAsset, causticsPos, textureBias).a;\n    vec3 causticsColor = fresnelTerm * vec3(causticsSample) * causticsIntensity * dWaterCaustics;\n\n    // --- shore\n    float shoreColor = dWaterShore * saturate(\n        sin((dWaterShore - waterUpdateTime * shoreFrequency) * shoreTiling) - shoreSample +\n        cos((dWaterShore - waterUpdateTime * shoreFrequency) * shoreTiling) - shoreSample\n        ) * shoreIntensity;\n\n    #ifdef MAPTEXTURE\n    dAlbedo += gammaCorrectInput(addAlbedoDetail(texture2D(texture_diffuseMap, $UV, textureBias).$CH));\n    #endif\n\n    ${t?`\n    vec3 viewDirS = matrix_view3 * dNormalW;\n\n    ${i?"\n    vec2 reflCoords = getReflectionCoords(reflectionsBumpiness, viewDirS);    \n    vec3 reflection = reflectionsIntensity * texture2D(texture_planarReflectionMap, reflCoords, textureBias).rgb;\n":"\n    vec3 reflection = vec3(0.0);\n"}\n    ${a?"\n    float distance = distance(view_position, vPositionW);\n    float factor = 1.0 - clamp( (distance - 150.0) / 150.0, 0.0, 0.5);\n\n    vec2 refrCoords = getReflectionCoords(refractionBumpiness * factor, viewDirS);    \n    vec3 refraction = mix(reflection, refractionIntensity * texture2D(texture_planarRefractionMap, refrCoords, textureBias).rgb, dWaterRefraction);\n":"\n    vec3 refraction = vec3(0.0);\n"}\n`:"\n    vec3 reflection = vec3(0.0);\n    vec3 refraction = vec3(0.0);\n"}\n\n    #ifdef MAPVERTEX\n    dAlbedo += gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n\n    dAlbedo += gammaCorrectInput(reflection * (1.0 - fresnelTerm) + refraction * fresnelTerm);\n\n    #ifdef MAPCOLOR\n    dAlbedo += material_diffuse.rgb;\n    #endif\n    \n    dAlbedo += saturate(causticsColor + shoreColor);\n}\n`},UranusEffectsWater.prototype.getOpacity=function(){return`\n${pc.shaderChunks.screenDepthPS}\n\nvarying vec2 dWaterUV;\nvarying float dVertexDepth;\n\nuniform float waterUpdateTime;\n\nuniform float depthOpacity;\nuniform float refractionOpacity;\n\nuniform sampler2D texture_causticsMapAsset;\nuniform float causticsOpacity;\nuniform float shoreOpacity;\nuniform float causticsIntensity;\nuniform float causticsTiling;\nuniform float shoreIntensity;\nuniform float shoreTiling;\nuniform float shoreFrequency;\n\nuniform sampler2D texture_flowMap;\nuniform float flowFrequency;\n\nuniform float reflectionsIntensity;\nuniform float refractionIntensity;\nuniform float reflectionsBumpiness;\nuniform float refractionBumpiness;\nuniform vec3 specularColor;\nuniform float specularIntensity;\n\nfloat dWaterDepth;\nfloat dWaterCaustics;\nfloat dWaterShore;\nfloat dWaterRefraction;\n\n${this.hasSurfaceDepth?"\nvarying float dTerrainWaterDepth;\n":""}\n\nvec3 dhA;\nvec3 dhB;\n\nvec3 dNormalHighlightsW;\n\nuniform vec3 texture_normalMapTransform0;\nuniform vec3 texture_normalMapTransform1;\n\nuniform sampler2D texture_normalMap;\nuniform float material_bumpiness;\n\n#ifdef MAPFLOAT\nuniform float material_opacity;\n#endif\n\n#ifdef MAPTEXTURE\nuniform sampler2D texture_opacityMap;\n#endif\n\nvoid getOpacity() {\n    \n    dAlpha = 1.0;\n\n    #ifdef MAPFLOAT\n    dAlpha *= material_opacity;\n    #endif\n\n    #ifdef MAPTEXTURE\n    dAlpha *= texture2D(texture_opacityMap, $UV, textureBias).$CH;\n    #endif\n\n    #ifdef MAPVERTEX\n    dAlpha *= clamp(vVertexColor.$VC, 0.0, 1.0);\n    #endif\n\n    // --- calculate water opacity based on depth depth\n    float waterBottom = getLinearDepth(vPositionW);\n    float depth = getLinearScreenDepth();\n    float depthDiff = abs(depth - waterBottom) * dViewDirW.y;\n\n    dWaterDepth = saturate(pow(depthDiff * depthOpacity, 0.5));\n    dWaterCaustics = 1.0 - saturate(pow(${this.hasSurfaceDepth?"dTerrainWaterDepth":"depthDiff"} * causticsOpacity, 0.5));\n    dWaterShore = 1.0 - saturate(pow(depthDiff * shoreOpacity, 0.5));\n\n    dWaterRefraction = 1.0 - saturate(pow(${this.hasSurfaceDepth?"dTerrainWaterDepth":"depthDiff"} * refractionOpacity, 0.5));\n\n    dAlpha *= dWaterDepth;\n}\n`},UranusEffectsWater.prototype.getNormalMap=function(){return"\nvec3 FlowUVW (\n\tvec2 uv, vec2 flowVector, vec2 jump,\n\tfloat flowOffset, float tiling, float time, bool flowB\n) {\n\tfloat phaseOffset = flowB ? 0.5 : 0.0;\n\tfloat progress = fract(time + phaseOffset);\n\tvec3 uvw;\n\tuvw.xy = uv - flowVector * (progress + flowOffset);\n\tuvw.xy *= tiling;\n\tuvw.xy += phaseOffset;\n\tuvw.xy += (time - progress) * jump;\n\tuvw.z = 1.0 - abs(1.0 - 2.0 * progress);\n\treturn uvw;\n}\n\nvec3 UnpackDerivativeHeight (vec4 textureData) {\n    vec3 dh = textureData.agb;\n    dh.xy = dh.xy * 2.0 - 1.0;\n    return dh;\n}\n\nvec2 normalMapPos;\n\nvoid getNormal() {\n\n    // --- calculate world based UV coordinates so the water surface can move with the camera\n    normalMapPos = vec2(dWaterUV.x * texture_normalMapTransform0.x, dWaterUV.y * texture_normalMapTransform1.y);\n\n    // --- calculate water flow\n    vec3 flowSampler = texture2D(texture_flowMap, normalMapPos, textureBias).rgb;\n\n    vec3 flow = vec3(flowSampler.xy, 0.0);\n    flow.xy = flow.xy * 2.0 - 1.0;\n    flow *= 0.1; // _FlowStrength;\n\n    float noise = flowSampler.b;\n    float time = waterUpdateTime * flowFrequency + noise;\n    vec2 jump = vec2(0.24,0.20); //vec2(_UJump, _VJump);\n\n    vec3 uvwA = FlowUVW(\n        normalMapPos, flow.xy, jump,\n        0.0, 3.0, time, false\n        //_FlowOffset, _Tiling, time, false\n    );\n\n    vec3 uvwB = FlowUVW(\n        normalMapPos, flow.xy, jump,\n        0.0, 3.0, time, true\n        //_FlowOffset, _Tiling, time, false\n    );     \n\n    float normalBumpiness = material_bumpiness;\n\tfloat finalHeightScale = (flow.z * 9.0 + normalBumpiness) * dWaterDepth; // * _HeightScaleModulated + _HeightScale;\n\n\tdhA = UnpackDerivativeHeight(texture2D(texture_normalMap, uvwA.xy, textureBias)) * (uvwA.z * finalHeightScale);\n    dhB = UnpackDerivativeHeight(texture2D(texture_normalMap, uvwB.xy, textureBias)) * (uvwB.z * finalHeightScale);\n\n    // --- sample the normalMap and calculate the final normals\n    vec3 normalMap = normalize(vec3(-(dhA.xy + dhB.xy), 1.0));\n\n    dNormalW = dTBN * normalMap;\n\n    // --- repeat for a different normal sample for specular highlights\n    normalBumpiness = 1.0 * smoothstep(1.0, 0.0, dWaterCaustics);\n\tfinalHeightScale = (flow.z * 9.0 + normalBumpiness) * dWaterDepth;\n\n\tvec3 dhAH = UnpackDerivativeHeight(texture2D(texture_normalMap, uvwA.xy, textureBias)) * (uvwA.z * finalHeightScale);\n    vec3 dhBH = UnpackDerivativeHeight(texture2D(texture_normalMap, uvwB.xy, textureBias)) * (uvwB.z * finalHeightScale);\n\n    normalMap = normalize(vec3(-(dhAH.xy + dhBH.xy), 1.0));\n    dNormalHighlightsW = dTBN * normalMap;\n}\n"},UranusEffectsWater.prototype.getLightSpecular=function(){return"\n// Energy-conserving (hopefully) Blinn-Phong\nfloat calcLightSpecular(float gloss, vec3 worldNormal, vec3 h) {\n    float nh = max( dot( h, worldNormal ), 0.0 );\n\n    float specPow = exp2(gloss * 11.0); // glossiness is linear, power is not; 0 - 2048\n\n    // Hack: On Mac OS X, calling pow with zero for the exponent generates hideous artifacts so bias up a little\n    specPow = max(specPow, 0.0001);\n\n    return pow(nh, specPow) * (specPow + 2.0) / 8.0;\n}\n\nfloat getLightSpecular(vec3 h, vec3 reflDir, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float gloss, mat3 tbn) {\n    float specPow = exp2(gloss * 2.0);\n\n    vec3 H = normalize(-lightDirNorm + viewDir);\n\tfloat e = specPow * 800.0;\n\tfloat kS = saturate(dot(dNormalHighlightsW, -lightDirNorm));\n\treturn kS * specularIntensity * pow(saturate(dot(dNormalHighlightsW, H)), e) * sqrt((e + 1.0) / 2.0);\n}\n"},UranusEffectsWater.prototype.getCombineColor=function(){return`\nvec3 combineColor(vec3 albedo, vec3 sheenSpecularity, float clearcoatSpecularity) {\n    vec3 ret = vec3(0);\n#ifdef LIT_OLD_AMBIENT\n    ret += (dDiffuseLight - light_globalAmbient) * albedo + material_ambient * light_globalAmbient;\n#else\n    ret += albedo * dDiffuseLight;\n#endif\n#ifdef LIT_SPECULAR\n    ${this.specularBlinking>0?`\n    float specularBlinking = texture2D(texture_causticsMapAsset, vec2(vUv0.xy + waterUpdateTime * ${this.specularBlinking.toFixed(3)}), textureBias).a;\n    `:""}\n\n    ret += dSpecularLight * specularColor ${this.specularBlinking>0?"* specularBlinking":""};\n#endif\n#ifdef LIT_REFLECTIONS\n    ret += dReflection.rgb * dReflection.a;\n#endif\n\n#ifdef LIT_SHEEN\n    float sheenScaling = 1.0 - max(max(sheenSpecularity.r, sheenSpecularity.g), sheenSpecularity.b) * 0.157;\n    ret = ret * sheenScaling + (sSpecularLight + sReflection.rgb) * sheenSpecularity;\n#endif\n#ifdef LIT_CLEARCOAT\n    float clearCoatScaling = 1.0 - ccFresnel * clearcoatSpecularity;\n    ret = ret * clearCoatScaling + (ccSpecularLight + ccReflection.rgb) * clearcoatSpecularity;\n#endif\n\n    return ret;\n}\n`},UranusEffectsWater.prototype.getStartVS=function(){return"\nvarying vec2 dWaterUV;\n\nuniform float waterScale;\n\nvoid main(void) {\n\n    gl_Position = getPosition();\n\n    vec2 world_size;\n    vec2 world_tiling;\n\n    world_size.x = length(vec3(dModelMatrix[0].xyz));\n    world_size.y = length(vec3(dModelMatrix[2].xyz));\n\n    world_tiling.x = world_size.y / waterScale;\n    world_tiling.y = world_size.y / waterScale;\n\n    dWaterUV = vec2(dPositionW.x / world_size.x, dPositionW.z / world_size.y) * world_tiling.xy;      \n"},UranusEffectsWater.prototype.getTransformVS=function(){return`\n${pc.shaderChunks.screenDepthPS}\n\nuniform vec3 view_position;\n\nuniform float waterUpdateTime;\nuniform float wavesFrequency;\nuniform float wavesAmplitude;\nuniform vec2 wavesDepthMinMax;\nuniform sampler2D texture_causticsMapAsset;\n\n${this.hasSurfaceDepth?"\nuniform vec4 renderSurfaceParams; // orthoX orthoY sizeX sizeZ\nuniform sampler2D texture_depthSurface;\nuniform float renderFarClip;\nuniform float renderPosY;\n\nvarying float dTerrainWaterDepth;\n":""}\n\nvec3 dPositionWBase;\nvarying float dVertexDepth;\nfloat dDepthFactor;\n\n// convert clip space position into texture coordinates to sample scene grab textures\nvec2 grabScreenPos(vec4 clipPos) {\n    vec2 uv = (clipPos.xy / clipPos.w) * 0.5 + 0.5;\n    #ifdef WEBGPU\n        uv.y = 1.0 - uv.y;\n    #endif\n    return uv;\n}\n\n#ifdef PIXELSNAP\nuniform vec4 uScreenSize;\n#endif\n\n#ifdef SCREENSPACE\nuniform float projectionFlipY;\n#endif\n\n#ifdef MORPHING\nuniform vec4 morph_weights_a;\nuniform vec4 morph_weights_b;\n#endif\n\n#ifdef MORPHING_TEXTURE_BASED\nuniform vec4 morph_tex_params;\n\nvec2 getTextureMorphCoords() {\n    float vertexId = morph_vertex_id;\n    vec2 textureSize = morph_tex_params.xy;\n    vec2 invTextureSize = morph_tex_params.zw;\n\n    // turn vertexId into int grid coordinates\n    float morphGridV = floor(vertexId * invTextureSize.x);\n    float morphGridU = vertexId - (morphGridV * textureSize.x);\n\n    // convert grid coordinates to uv coordinates with half pixel offset\n    vec2 uv = (vec2(morphGridU, morphGridV) * invTextureSize) + (0.5 * invTextureSize);\n    return getImageEffectUV(uv);\n}\n#endif\n\n#ifdef MORPHING_TEXTURE_BASED_POSITION\nuniform highp sampler2D morphPositionTex;\n#endif\n\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n    return getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n    return matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);\n    #elif defined(INSTANCING)\n    return mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n    #else\n    return matrix_model;\n    #endif\n}\n\nfloat getWaveElevation(vec3 posW) {\n   float base = texture2D(texture_causticsMapAsset, vertex_texCoord0).r;\n   return cos(posW.x * wavesFrequency * base + waterUpdateTime) * sin(posW.z * wavesFrequency * base + waterUpdateTime) * wavesAmplitude * dDepthFactor;\n}\n\nvec4 getPosition() {\n    dModelMatrix = getModelMatrix();\n\n    vec3 localPos = vertex_position;\n\n    #ifdef NINESLICED\n    // outer and inner vertices are at the same position, scale both\n    localPos.xz *= outerScale;\n\n    // offset inner vertices inside\n    // (original vertices must be in [-1;1] range)\n    vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n    vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n    localPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\n    vTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0; // uv = local pos - inner corner\n\n    localPos.xz *= -0.5; // move from -1;1 to -0.5;0.5\n    localPos = localPos.xzy;\n    #endif\n\n    #ifdef MORPHING\n    #ifdef MORPHING_POS03\n    localPos.xyz += morph_weights_a[0] * morph_pos0;\n    localPos.xyz += morph_weights_a[1] * morph_pos1;\n    localPos.xyz += morph_weights_a[2] * morph_pos2;\n    localPos.xyz += morph_weights_a[3] * morph_pos3;\n    #endif // MORPHING_POS03\n    #ifdef MORPHING_POS47\n    localPos.xyz += morph_weights_b[0] * morph_pos4;\n    localPos.xyz += morph_weights_b[1] * morph_pos5;\n    localPos.xyz += morph_weights_b[2] * morph_pos6;\n    localPos.xyz += morph_weights_b[3] * morph_pos7;\n    #endif // MORPHING_POS47\n    #endif // MORPHING\n\n    #ifdef MORPHING_TEXTURE_BASED_POSITION\n    // apply morph offset from texture\n    vec2 morphUV = getTextureMorphCoords();\n    vec3 morphPos = texture2D(morphPositionTex, morphUV).xyz;\n    localPos += morphPos;\n    #endif\n\n    vec4 posW = dModelMatrix * vec4(localPos, 1.0);\n    #ifdef SCREENSPACE\n    posW.zw = vec2(0.0, 1.0);\n    #endif\n\n    // --- calculate vertex waves\n    ${this.hasSurfaceDepth?"\n    vec2 dSurfaceCoords;\n    dSurfaceCoords.x = clamp( (posW.x + renderSurfaceParams.x) / renderSurfaceParams.z, 0.0, 1.0);\n    dSurfaceCoords.y = -clamp( (posW.z + renderSurfaceParams.y) / renderSurfaceParams.w, -1.0, 0.0);    \n\n    float terrainDepth = texture2D(texture_depthSurface, dSurfaceCoords).r;\n    float terrainWorldY = renderPosY - terrainDepth * renderFarClip;\n\n    float depthDiff = max((posW.y - terrainWorldY) / renderFarClip * 2.0, 0.0);\n    dTerrainWaterDepth = depthDiff * renderFarClip;\n    ":"\n    vec2 screenCoord = grabScreenPos(matrix_viewProjection * posW);\n    float sceneDepth = getLinearScreenDepth(screenCoord) * camera_params.x;\n    float waterDepth = getLinearDepth(posW.xyz) * camera_params.x;\n    float depthDiff = clamp(sceneDepth - waterDepth, 0.0, 1.0) * 50.0;\n    "}\n\n    dDepthFactor = clamp(depthDiff, wavesDepthMinMax.x, wavesDepthMinMax.y);\n    dVertexDepth = (wavesDepthMinMax.y - dDepthFactor - wavesDepthMinMax.x) / (wavesDepthMinMax.y - wavesDepthMinMax.x);\n\n    dPositionWBase = posW.xyz;  \n\n    posW.y += getWaveElevation(posW.xyz);\n\n    dPositionW = posW.xyz;\n\n    vec4 screenPos;\n    #ifdef UV1LAYOUT\n    screenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n    #else\n    #ifdef SCREENSPACE\n    screenPos = posW;\n    screenPos.y *= projectionFlipY;\n    #else\n    screenPos = matrix_viewProjection * posW;\n    #endif\n\n    #ifdef PIXELSNAP\n    // snap vertex to a pixel boundary\n    screenPos.xy = (screenPos.xy * 0.5) + 0.5;\n    screenPos.xy *= uScreenSize.xy;\n    screenPos.xy = floor(screenPos.xy);\n    screenPos.xy *= uScreenSize.zw;\n    screenPos.xy = (screenPos.xy * 2.0) - 1.0;\n    #endif\n    #endif\n\n    return screenPos;\n}\n\nvec3 getWorldPosition() {\n    return dPositionW;\n}\n`},UranusEffectsWater.prototype.getNormalVS=function(){return"\nvec3 getNormal() {\n\n    dNormalMatrix = matrix_normal;\n\n    vec3 v0 = dPositionWBase;\n    vec3 v1 = dPositionWBase + vec3(0.01, 0.0, 0.0);\n    vec3 v2 = dPositionWBase + vec3(0.0, 0.0, 0.01);\n\n    v0.y += getWaveElevation(v0);\n    v1.y += getWaveElevation(v1);\n    v2.y += getWaveElevation(v2);\n\n    vec3 vn = cross(v2 - v0, v1 - v0);\n    return normalize(vn);\n}  \n"};var UranusEffectsMaterialTextureMix=pc.createScript("uranusEffectsMaterialTextureMix");UranusEffectsMaterialTextureMix.attributes.add("inEditor",{type:"boolean",default:!0}),UranusEffectsMaterialTextureMix.attributes.add("materialAsset",{type:"asset",assetType:"material"}),UranusEffectsMaterialTextureMix.attributes.add("mixChannel",{type:"string",default:"diffusePS",enum:[{Diffuse:"diffusePS"},{Emissive:"emissivePS"}]}),UranusEffectsMaterialTextureMix.attributes.add("mixTextureA",{type:"asset",assetType:"texture",title:"Mix Texture A",description:"The texture to mix from based on the alpha value provided."}),UranusEffectsMaterialTextureMix.attributes.add("mixTextureB",{type:"asset",assetType:"texture",title:"Mix Texture B",description:"The texture to mix to based on the alpha value provided."}),UranusEffectsMaterialTextureMix.attributes.add("mixAlpha",{type:"number",default:.5,min:0,max:1,title:"Mix Alpha",description:"The alpha value used to mix the base and mix textures."}),UranusEffectsMaterialTextureMix.attributes.add("animateEvent",{type:"string",default:"",title:"Animate Event",description:"An app wide animation event that can be called with a true/false argument and animate the transition."}),UranusEffectsMaterialTextureMix.attributes.add("animateTime",{type:"number",default:1,title:"Animate Time",description:"The time it takes to animate a full transition when the animate event is called."}),UranusEffectsMaterialTextureMix.prototype.initialize=function(){this.materialAsset.ready((()=>this.updateMaterial(this.materialAsset.resource))),this.materialAsset.on("change",(()=>this.updateMaterial(this.materialAsset.resource))),UranusUtilities.loadAsset(this.materialAsset),this.animateEvent&&(this.app.on(this.animateEvent,(function(e){void 0!==e?this.onAnimate(e):this.onAnimate(this.mixAlpha>0?0:1)}),this),this.app.on(`${this.animateEvent}:off`,(function(){this.onAnimate(0)}),this),this.app.on(`${this.animateEvent}:on`,(function(){this.onAnimate(1)}),this)),this.on("attr",(function(){this.updateAttributes(this.materialAsset.resource)})),this.on("state",(function(e){e?this.updateMaterial(this.materialAsset.resource):this.clearMaterial(this.materialAsset.resource)}))},UranusEffectsMaterialTextureMix.prototype.updateMaterial=function(e){const t=this.getShader();if(!t)return!1;e.chunks[this.mixChannel]=t,e.chunks.APIVersion=pc.CHUNKAPI_1_58,e.update(),this.updateAttributes(e)},UranusEffectsMaterialTextureMix.prototype.getShader=function(){const e="\nuniform sampler2D texture_mixTextureA;\nuniform sampler2D texture_mixTextureB;\nuniform float mixAlpha;\n    ";switch(this.mixChannel){case"diffusePS":return`\n${e}\n#ifdef MAPCOLOR\nc\n#endif\n\nvoid getAlbedo() {\n    dAlbedo = vec3(1.0);\n\n#ifdef MAPCOLOR\n    dAlbedo *= material_diffuse.rgb;\n#endif\n\n#ifdef MAPTEXTURE\n    vec3 albedoBase1 = $DECODE(texture2DBias(texture_mixTextureA, $UV, textureBias)).$CH;\n    vec3 albedoBase2 = $DECODE(texture2DBias(texture_mixTextureB, $UV, textureBias)).$CH;\n\n    vec3 albedoBase = mix(albedoBase1, albedoBase2, mixAlpha);\n\n    dAlbedo *= addAlbedoDetail(albedoBase);\n#endif\n\n#ifdef MAPVERTEX\n    dAlbedo *= gammaCorrectInput(saturate(vVertexColor.$VC));\n#endif\n}        \n        `;case"emissivePS":return`\n${e}\n#ifdef MAPCOLOR\nuniform vec3 material_emissive;\n#endif\n\n#ifdef MAPFLOAT\nuniform float material_emissiveIntensity;\n#endif\n\nvoid getEmission() {\n    dEmission = vec3(1.0);\n\n    #ifdef MAPFLOAT\n    dEmission *= material_emissiveIntensity;\n    #endif\n\n    #ifdef MAPCOLOR\n    dEmission *= material_emissive;\n    #endif\n\n    #ifdef MAPTEXTURE\n    vec3 emissionBase1 = $DECODE(texture2DBias(texture_mixTextureA, $UV, textureBias)).$CH;\n    vec3 emissionBase2 = $DECODE(texture2DBias(texture_mixTextureB, $UV, textureBias)).$CH;\n\n    vec3 emissionBase = mix(emissionBase1, emissionBase2, mixAlpha);\n\n    dEmission *= emissionBase;\n    #endif\n\n    #ifdef MAPVERTEX\n    dEmission *= gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n}        \n        `}},UranusEffectsMaterialTextureMix.prototype.clearMaterial=function(e){e&&(delete e.chunks[this.mixChannel],e.update())},UranusEffectsMaterialTextureMix.prototype.updateAttributes=async function(e){if(!this.mixTextureA.loaded||!this.mixTextureB.loaded){const t=this.app.assets.find("texture-white.jpg");e.setParameter("texture_mixTextureA",t.resource),e.setParameter("texture_mixTextureB",t.resource),await UranusUtilities.loadAssets([this.mixTextureA,this.mixTextureB])}e.setParameter("texture_mixTextureA",this.mixTextureA.resource),e.setParameter("texture_mixTextureB",this.mixTextureB.resource),e.setParameter("mixAlpha",this.mixAlpha)},UranusEffectsMaterialTextureMix.prototype.onAnimate=function(e){const t=this.materialAsset?.resource;if(!t)return;this.animateTween&&this.animateTween.stop();const i={alpha:this.mixAlpha};this.animateTween=this.app.tween(i).to({alpha:e},this.animateTime,pc.SineInOut).onUpdate((()=>{this.mixAlpha=i.alpha,t.setParameter("mixAlpha",i.alpha)})).onComplete((()=>{this.mixAlpha=e,this.animateTween=void 0})).start()};var UranusGraphicsResolution=pc.createScript("uranusGraphicsResolution");UranusGraphicsResolution.attributes.add("inEditor",{type:"boolean",default:!1}),UranusGraphicsResolution.attributes.add("resolution",{type:"number",min:.01,max:2,default:1,title:"Resolution",description:"This defines how much the resolution will be downscaled or upscaled in relation to the viewport resolution. Leverage the browser bilinear filtering to increase performance by rendering your application in a lower resolution. Or render to a higher resolution for reducing anti alias."}),UranusGraphicsResolution.prototype.initialize=function(){this.lastEntryWidth=void 0,this.lastEntryHeight=void 0,this.lastResolution=void 0,this.prepare(),this.on("attr:resolution",this.updateResolution)},UranusGraphicsResolution.prototype.prepare=function(){this.resizeObserver=new ResizeObserver(this.updateResolution.bind(this)),this.resizeObserver.observe(this.app.graphicsDevice.canvas)},UranusGraphicsResolution.prototype.updateResolution=function(e){let t=!1;if(e[0]&&(t=!0,this.lastEntryWidth=e[0].contentRect.width,this.lastEntryHeight=e[0].contentRect.height),this.lastResolution===this.resolution&&!t)return;const i=this.lastEntryWidth*this.resolution,a=this.lastEntryHeight*this.resolution;isNaN(i)||isNaN(a)||(this.app.setCanvasResolution(pc.RESOLUTION_FIXED,i,a),this.app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW,i,a),this.lastResolution=this.resolution)};var UranusEffectsMaterialWind=pc.createScript("uranusEffectsMaterialWind");UranusEffectsMaterialWind.attributes.add("inEditor",{type:"boolean",default:!0}),UranusEffectsMaterialWind.attributes.add("eventEntity",{type:"entity",title:"Event Holder",description:"If an event entity is provided then all events will fire on that entity. Otherwise they will fire on the app object."}),UranusEffectsMaterialWind.attributes.add("onRender",{type:"string",title:"On Render",description:"If an event name is provided the shader will update automatically when the event will fire. Useful when combining multiple effects on the same shader (e.g. terrain splatmaps with surface noise)."}),UranusEffectsMaterialWind.attributes.add("materialAssets",{type:"asset",assetType:"material",array:!0}),UranusEffectsMaterialWind.attributes.add("windChannels",{type:"json",array:!0,schema:[{name:"x",type:"boolean",default:!0,title:"X"},{name:"y",type:"boolean",default:!1,title:"Y"},{name:"z",type:"boolean",default:!0,title:"Z"},{name:"wavelength",type:"number",default:.5,title:"Wavelength"},{name:"amplitude",type:"number",default:.05,title:"Amplitude"},{name:"timeOffset",type:"number",default:0,title:"Time Offset",description:"You can set an optional time offset per channel to further randomize the wind animation."},{name:"textureCoord",type:"string",default:"vertex_texCoord0",enum:[{UV0:"vertex_texCoord0"},{UV1:"vertex_texCoord1"},{World:"world"}],title:"Texture Coord",description:"Set which set of coordinates will be used to calculate the wind animation."},{name:"textureCoordAxis",type:"string",default:"y",enum:[{X:"x"},{Y:"y"},{Z:"z"}],title:"Texture Coord Axis",description:"The axis on which the wind animation will play on. To use multiple axis you can add more channels."},{name:"windBase",type:"number",default:0,min:0,max:1,title:"Wind Base",description:"Set the starting coordinates value in the range of 0.0 to 1.0 for the wind animation."},{name:"invertCoords",type:"boolean",default:!1,title:"Invert Coordinates",description:"If selected the coordinates used will be inverted."}]}),UranusEffectsMaterialWind.attributes.add("useLocalClock",{type:"boolean",default:!1,title:"Use Local Clock",description:"Spawn a local clock instead of using the global wind timer."}),UranusEffectsMaterialWind.attributes.add("windTimeSpeed",{type:"number",default:0,min:0,title:"Wind Time Speed",description:"Can be used to control the wind animation speed, works only with a local wind clock."}),UranusEffectsMaterialWind.attributes.add("windGustSize",{type:"number",default:.5,title:"Wind Gust Size",description:"The size in world units of each  wind gust."}),UranusEffectsMaterialWind.attributes.add("windDirection",{type:"vec2",default:[1,1],title:"Wind Direction",description:"The wind direction in the X and Z axis."}),UranusEffectsMaterialWind.attributes.add("interactObject",{type:"boolean",default:!1,title:"Interact Object",description:"If selected the vertices of the model will be pushed away by any objects nearby."}),UranusEffectsMaterialWind.attributes.add("interactList",{type:"entity",array:!0,title:"Interact List",description:"A list of entities that can interact with this material (on WebGL1 devices a maximum of 20 entities is supported)."}),UranusEffectsMaterialWind.attributes.add("interactRadius",{type:"number",default:1,minimum:0,title:"Interact Radius",description:"The area around each interaction entity that will be pushed away."}),UranusEffectsMaterialWind.attributes.add("interactAxis",{type:"json",schema:[{name:"x",type:"boolean",default:!0,title:"X"},{name:"y",type:"boolean",default:!0,title:"Y"},{name:"z",type:"boolean",default:!0,title:"Z"}],title:"Interact Axis",description:"Set the axis the vertext interact effect will be applied."}),UranusEffectsMaterialWind.attributes.add("billboard",{type:"boolean",default:!1,title:"Billboard",description:"If selected the model will be rendered as a billboard to always face the camera."}),UranusEffectsMaterialWind.attributes.add("billboardLockY",{type:"boolean",default:!0,title:"Billboard Lock Y",description:"If set to true the billboard rotation will be only on Y axis, otherwise it will face the camera in all direction."}),UranusEffectsMaterialWind.attributes.add("billboardReverseSize",{type:"boolean",default:!1,title:"Billboard Reverse Size",description:"If selected the billboard half extents calculation from the reference render asset will be reversed."}),UranusEffectsMaterialWind.attributes.add("billboardRefSize",{type:"asset",assetType:"render",array:!0,description:"Provide a list of render assets for each material (in the same order), to be used for sizing the billboard."}),UranusEffectsMaterialWind.prototype.initialize=function(){!1!==this.app.graphicsDevice.isWebGL2?(this.arr2=[0,0],this.interactionArr=[],this.prepare(),this.on("attr",(function(e){"windGustSize"===e||"windDirection"===e?this.materialAssets.forEach((e=>this.updateAttributes(e.resource))):this.materialAssets.forEach((e=>this.updateMaterial(e.resource)))})),this.on("state",(function(e){e?this.materialAssets.forEach((e=>this.updateMaterial(e.resource))):this.materialAssets.forEach((e=>this.clearMaterial(e.resource)))}))):this.enabled=!1},UranusEffectsMaterialWind.prototype.prepare=async function(){this.useLocalClock?(this.time=0,this.clockUniform="uranus_material_wind_time_local"):(this.clockUniform="uranus_material_wind_time",UranusEffectsMaterialWind.time||UranusEffectsMaterialWind.prepareGlobal(this.app)),await UranusUtilities.loadAssets(this.materialAssets.concat(this.billboardRefSize)),this.materialAssets.forEach((e=>{e.ready(this.onMaterialReady.bind(this)),e.on("change",this.onMaterialReady.bind(this))}))},UranusEffectsMaterialWind.prototype.onMaterialReady=function(e){this.onRender?(this.eventEntity?this.eventEntity:this.app).on(this.onRender,(function(){this.updateMaterial(e.resource)}),this):this.updateMaterial(e.resource)},UranusEffectsMaterialWind.prototype.updateMaterial=function(e){UranusUtilities.prepareShaderForInjection(e,"transformVS");let t=e.chunks.transformVS_uranusBase,i=`\nuniform float ${this.clockUniform};\nuniform float windGustSize;\nuniform vec2 windDirection;\n`;this.interactObject&&(i+="\nuniform vec3 interactionList[20];\nuniform int interactionListLength;\n"),this.billboard&&(i+="\nuniform vec2 billboardSize;\n");let a=this.getWindChunk();this.interactObject&&(a+=this.getInteractChunk()),t=t.replace("// INJECT uniforms",i),this.billboard&&(t=this.applyBillboard(t,e)),t=t.replace("// INJECT chunk",a),e.chunks.transformVS=t,e.chunks.APIVersion=pc.CHUNKAPI_1_55,e.update(),this.updateAttributes(e)},UranusEffectsMaterialWind.prototype.applyBillboard=function(e,t){const i=this.materialAssets.findIndex((e=>e.resource===t)),a=this.billboardRefSize[i];let n;if(a){const e=a.resource.meshes[0],t=[e.aabb.halfExtents.x,e.aabb.halfExtents.y,e.aabb.halfExtents.z];t.reverse(),n=[t[0],t[1]],this.billboardReverseSize&&n.sort()}else n=[1,1];return t.setParameter("billboardSize",n),e.replace("vec4 posW = dModelMatrix * vec4(localPos, 1.0);",`\n    vec3 right = vec3(matrix_view[0][0], matrix_view[1][0], matrix_view[2][0]);\n\n    ${this.billboardLockY?"\n    vec3 up = vec3(0.0, 1.0, 0.0);\n":"\n    vec3 up\t= vec3(matrix_view[0][1], matrix_view[1][1], matrix_view[2][1]);\n"}\n    vec2 billboardSizeScaled = billboardSize;\n\n    // --- if the billboard is instanced, uniform scaling is supported\n    #ifdef INSTANCING\n        billboardSizeScaled *= instance_line3.y;\n    #endif\n    \n    vec3 actualQuadCenter = vec3(dModelMatrix[3][0], dModelMatrix[3][1], dModelMatrix[3][2]);\n    actualQuadCenter.y += billboardSizeScaled.y;\n\n    vec2 quadPos = vertex_texCoord0 * 2.0 - vec2(1.0);\n\n    localPos = actualQuadCenter - (quadPos.x * right * billboardSizeScaled.x + quadPos.y * up * billboardSizeScaled.y);\n    vec4 posW = vec4(localPos, 1.0);\n`)},UranusEffectsMaterialWind.prototype.getWindChunk=function(){let e="";return this.windChannels.forEach(((t,i)=>{"world"!==t.textureCoord?e+=`\n    vec2 uv${i} = vec2(${t.textureCoord}.x, 1.0 -  ${t.textureCoord}.y);\n\n    float height${i} = uv${i}.y >= ${t.windBase.toFixed(2)} ? pow(${t.invertCoords?"1.0 -":""}uv${i}.${t.textureCoordAxis}, 2.0) : 0.0;\n    \n    float posTime${i} = ${this.clockUniform} + ${t.timeOffset.toFixed(2)};\n\n    ${t.x?`posW.x += sin( posTime${i} * ${t.amplitude.toFixed(2)} + posW.x * windGustSize) * height${i} * ${t.wavelength.toFixed(2)} * windDirection.x;`:""}\n    ${t.y?`posW.y += sin( posTime${i} * ${t.amplitude.toFixed(2)} + posW.y * windGustSize) * height${i} * ${t.wavelength.toFixed(2)} * windDirection.y;`:""}\n    ${t.z?`posW.z += sin( posTime${i} * ${t.amplitude.toFixed(2)} + posW.z * windGustSize) * height${i} * ${t.wavelength.toFixed(2)} * windDirection.y;`:""}\n    `:e+=`    \n      float posWorldTime${i} = ${this.clockUniform} + ${t.timeOffset.toFixed(2)};\n      posW.${t.textureCoordAxis} +=cos( (posW.x + posWorldTime${i}) /${t.wavelength.toFixed(2)} ) * sin( (posW.z + posWorldTime${i}) /${t.wavelength.toFixed(2)} ) * ${t.amplitude.toFixed(2)};\n      `})),e},UranusEffectsMaterialWind.prototype.getInteractChunk=function(){return`\n    for (int i = 0; i < ${this.app.graphicsDevice.isWebGL2?"interactionListLength":"20"}; i++){\n       vec3 interactionPos = interactionList[i];\n       vec3 dis = vec3(distance(interactionPos, posW.xyz));\n       vec3 circle = 1.0 - clamp(dis / ${this.interactRadius.toFixed(2)},0.0,1.0);\n       vec3 sphereDisp = posW.xyz - interactionPos;\n       sphereDisp *= circle;\n       sphereDisp.y = clamp(sphereDisp.y, -1.0, 0.0);\n       sphereDisp.xyz *= 2.0;\n       ${this.interactAxis.x?"posW.x += sphereDisp.x;":""}\n       ${this.interactAxis.y?"posW.y += sphereDisp.y;":""}\n       ${this.interactAxis.z?"posW.z += sphereDisp.z;":""}\n    }\n`},UranusEffectsMaterialWind.prototype.clearMaterial=function(e){e&&(delete e.chunks.transformVS,e.update())},UranusEffectsMaterialWind.prototype.updateAttributes=function(e){e.setParameter("windGustSize",this.windGustSize),e.setParameter("windGustSize",this.windGustSize),this.arr2[0]=this.windDirection.x,this.arr2[1]=this.windDirection.y,e.setParameter("windDirection",this.arr2)},UranusEffectsMaterialWind.prototype.updateInteractAttributes=function(e){const t=this.interactionArr;let i=0;this.interactList.forEach((e=>{if(!e)return!0;const a=e.getPosition();t[i++]=a.x,t[i++]=a.y,t[i++]=a.z})),e.setParameter("interactionList[0]",t),!0===this.app.graphicsDevice.isWebGL2&&e.setParameter("interactionListLength",i/3)},UranusEffectsMaterialWind.prototype.update=function(e){this.useLocalClock&&(this.time+=e*this.windTimeSpeed),this.materialAssets.forEach((e=>{const t=e.resource;t&&(this.useLocalClock&&t.setParameter("uranus_material_wind_time_local",this.time),this.interactObject&&this.updateInteractAttributes(t))}))},UranusEffectsMaterialWind.time=0,UranusEffectsMaterialWind.prepareGlobal=function(e){this.app=e,this.windTimeId=this.app.graphicsDevice.scope.resolve("uranus_material_wind_time"),this.app.on("update",UranusEffectsMaterialWind.appUpdate,this)},UranusEffectsMaterialWind.appUpdate=function(e){UranusEffectsMaterialWind.time+=e,this.windTimeId.setValue(UranusEffectsMaterialWind.time)};var UranusEffectsEnvironmentFog=pc.createScript("uranusEffectsEnvironmentFog");UranusEffectsEnvironmentFog.attributes.add("inEditor",{type:"boolean",default:!0}),UranusEffectsEnvironmentFog.attributes.add("fogCubemapColor",{type:"boolean",default:!0,title:"Cubemap Color"}),UranusEffectsEnvironmentFog.attributes.add("fogDensityMax",{type:"number",default:.75,min:0,max:1,title:"Fog Density Max"}),UranusEffectsEnvironmentFog.attributes.add("fogScattering",{type:"vec2",default:[.05,25],title:"Scattering"}),UranusEffectsEnvironmentFog.attributes.add("fogScatteringHeight",{type:"number",default:0,title:"Scattering Height"}),UranusEffectsEnvironmentFog.attributes.add("fogScatteringDistance",{type:"number",default:1e3,title:"Scattering Distance"}),UranusEffectsEnvironmentFog.attributes.add("fogNoise",{type:"boolean",default:!0,title:"Noise"}),UranusEffectsEnvironmentFog.attributes.add("fogNoiseScale",{type:"number",default:.0015,title:"Noise Scale"}),UranusEffectsEnvironmentFog.attributes.add("fogNoiseDistance",{type:"number",default:250,title:"Noise Distance"}),UranusEffectsEnvironmentFog.attributes.add("fogNoiseSpeed",{type:"number",default:50,title:"Noise Speed"}),UranusEffectsEnvironmentFog.attributes.add("fogNoiseOctaves",{type:"number",default:5,title:"Noise Octaves"}),UranusEffectsEnvironmentFog.prototype.initialize=function(){this.fogTime=0,this.scopeFogTime=this.app.graphicsDevice.scope.resolve("fogTime"),this.scopeFogDensityMax=this.app.graphicsDevice.scope.resolve("fogDensityMax"),this.scopeFogScattering=this.app.graphicsDevice.scope.resolve("fogScattering"),this.scopeFogScatteringHeight=this.app.graphicsDevice.scope.resolve("fogScatteringHeight"),this.scopeFogScatteringDistance=this.app.graphicsDevice.scope.resolve("fogScatteringDistance"),this.scopeFogNoiseScale=this.app.graphicsDevice.scope.resolve("fogNoiseScale"),this.scopeFogNoiseDistance=this.app.graphicsDevice.scope.resolve("fogNoiseDistance"),this.scopeFogNoiseSpeed=this.app.graphicsDevice.scope.resolve("fogNoiseSpeed"),this.prepare(),this.on("attr",this.updateAttributes)},UranusEffectsEnvironmentFog.prototype.updateAttributes=function(){this.scopeFogDensityMax.setValue(this.fogDensityMax),this.scopeFogScattering.setValue([this.fogScattering.x,this.fogScattering.y]),this.scopeFogScatteringHeight.setValue(this.fogScatteringHeight),this.scopeFogScatteringDistance.setValue(this.fogScatteringDistance),this.scopeFogNoiseScale.setValue(this.fogNoiseScale),this.scopeFogNoiseDistance.setValue(this.fogNoiseDistance)},void 0===UranusEffectsEnvironmentFog.overridenGlobalChunks&&(UranusEffectsEnvironmentFog.overridenGlobalChunks=!1),UranusEffectsEnvironmentFog.prototype.prepare=function(){UranusEffectsEnvironmentFog.overridenGlobalChunks||(UranusEffectsEnvironmentFog.overridenGlobalChunks=!0,pc.shaderChunks.basePS=this.basePS(),this.fogCubemapColor&&(pc.shaderChunks.ambientEnvPS=this.ambientEnvPS()),pc.shaderChunks.fogExp2PS=this.fogExp2PS(),pc.shaderChunks.particle_initVS=this.particle_initVS(),pc.shaderChunks.particle_cpuVS=this.particle_cpuVS(),pc.shaderChunks.particle_endVS=this.particle_endVS()),this.updateAttributes()},UranusEffectsEnvironmentFog.prototype.update=function(e){this.fogNoise&&(this.fogTime+=e*this.fogNoiseSpeed,this.scopeFogTime.setValue(this.fogTime))},UranusEffectsEnvironmentFog.prototype.basePS=function(){return`\nvec3 dEnvironmentAmbient;\n\n${pc.shaderChunks.basePS}\n`},UranusEffectsEnvironmentFog.prototype.ambientEnvPS=function(){return"\n#ifndef ENV_ATLAS\n#define ENV_ATLAS\nuniform sampler2D texture_envAtlas;\n#endif\n\nvoid addAmbient(vec3 worldNormal) {\n    vec3 dir = normalize(cubeMapRotate(worldNormal) * vec3(-1.0, 1.0, 1.0));\n    vec2 uv = mapUv(toSphericalUv(dir), vec4(128.0, 256.0 + 128.0, 64.0, 32.0) / atlasSize);\n\n    vec4 raw = texture2D(texture_envAtlas, uv);\n    vec3 linear = $DECODE(raw);\n\n    dDiffuseLight += processEnvironment(linear);\n\n    // --- calculate ambient for environment fog\n    vec2 uv1 = vec2(0.5, 0.25); // sample a horizon pixel\n\n    vec4 raw1 = texture2D(texture_envAtlas, uv1);\n    vec3 linear1 = $DECODE(raw1);\n    \n    dEnvironmentAmbient = processEnvironment(linear1);\n}    \n"},UranusEffectsEnvironmentFog.prototype.fogExp2PS=function(){return`\n#ifdef PARTICLE\nvarying vec3 vPositionW;\nvec3 dEnvironmentAmbient = vec3(1.0, 1.0, 1.0);\nuniform vec3 view_position;\n#endif\n\nuniform float fogTime;\nuniform float fogDensityMax;\nuniform vec2 fogScattering;\nuniform float fogScatteringHeight;\nuniform float fogScatteringDistance;\n\nuniform vec3 fog_color;\nuniform float fog_density;\nfloat dBlendModeFogFactor = 1.0;\n\n${this.fogNoise?`\nuniform float fogNoiseScale;\nuniform float fogNoiseDistance;\n\nfloat noise_simplex_3D( vec3 P )\n{\n    //  https://github.com/BrianSharpe/Wombat/blob/master/SimplexPerlin3D.glsl\n\n    //  simplex math constants\n    const float SKEWFACTOR = 1.0/3.0;\n    const float UNSKEWFACTOR = 1.0/6.0;\n    const float SIMPLEX_CORNER_POS = 0.5;\n    const float SIMPLEX_TETRAHEDRON_HEIGHT = 0.70710678118654752440084436210485;    // sqrt( 0.5 )\n\n    //  establish our grid cell.\n    P *= SIMPLEX_TETRAHEDRON_HEIGHT;    // scale space so we can have an approx feature size of 1.0\n    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );\n\n    //  Find the vectors to the corners of our simplex tetrahedron\n    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 Pi_1 = min( g.xyz, l.zxy );\n    vec3 Pi_2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\n\n    //  pack them into a parallel-friendly arrangement\n    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\n    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\n    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\n\n    // clamp the domain of our grid cell\n    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\n    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\n\n    //\tgenerate the random vectors\n    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\n    Pt *= Pt;\n    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\n    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\n    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\n    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\n    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\n    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\n    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\n\n    //\tevaluate gradients\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\n\n    //\tNormalization factor to scale the final result to a strict 1.0->-1.0 range\n    //\thttp://briansharpe.wordpress.com/2012/01/13/simplex-noise/#comment-36\n    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\n\n    //  evaulate the kernel weights ( use (0.5-x*x)^3 instead of (0.6-x*x)^4 to fix discontinuities )\n    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\n    kernel_weights = max(0.5 - kernel_weights, 0.0);\n    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\n\n    //\tsum with the kernel and return\n    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\n}\n\nfloat fog_FBM(vec3 p) {\n  float value = 0.0;\n  float amplitude = 0.5;\n  float frequency = 0.0;\n  for (int i = 0; i < ${Math.trunc(this.fogNoiseOctaves)}; ++i) {\n    value += amplitude * noise_simplex_3D(p);\n    p *= 2.0;\n    amplitude *= 0.5;\n  }\n  return value;\n}\n`:""}\n\nvec3 addFog(vec3 color) {\n\n    float depth = distance(view_position, vPositionW);\n\n    ${this.fogNoise?"\n    vec3 noisePos = vPositionW * fogNoiseScale + vec3(0.0, 0.0, fogTime * fogNoiseScale * 0.1);\n    float noiseSample = fog_FBM(noisePos + fog_FBM(noisePos)) * 0.5 + 0.5;\n    float fogDepth = depth * mix(noiseSample, 1.0, clamp((depth - fogNoiseDistance) / fogNoiseDistance, 0.0, 1.0));    \n    ":"\n    float fogDepth = depth;\n    "}\n\n    fogDepth *= fogDepth;\n\n    float fogAmount = fog_density * fog_density;\n\n    float scattering = fogScattering.x + fogScattering.y * clamp((depth - fogScatteringDistance) / fogScatteringDistance, 0.0, 1.0);\n\n    // --- calculate height based fog\n    float worldPosY = max( abs(vPositionW.y - fogScatteringHeight), 0.01);\n\n    float fogFactor = scattering * exp(-worldPosY * fogAmount) * (1.0 - exp(-fogDepth * fogAmount * worldPosY)) / worldPosY;\n    fogFactor = min(fogDensityMax, fogFactor);\n\n    fogFactor = clamp(1.0 - fogFactor, 0.0, 1.0);\n\n    return mix(${this.fogCubemapColor?"dEnvironmentAmbient * ":""} dBlendModeFogFactor * fog_color, color, fogFactor);\n}\n`},UranusEffectsEnvironmentFog.prototype.particle_initVS=function(){return`\n${pc.shaderChunks.particle_initVS}\n\nvarying vec3 vPositionW;\n`},UranusEffectsEnvironmentFog.prototype.particle_cpuVS=function(){return`\nvarying vec3 vPositionW;\n\n${pc.shaderChunks.particle_cpuVS}\n`},UranusEffectsEnvironmentFog.prototype.particle_endVS=function(){return`\n  ${pc.shaderChunks.particle_endVS} \n\n  vPositionW = gl_Position.xyz;\n`};var UranusGraphicsSettings=pc.createScript("uranusGraphicsSettings");UranusGraphicsSettings.attributes.add("inEditor",{type:"boolean",default:!1}),UranusGraphicsSettings.attributes.add("showDialog",{type:"boolean",default:!0,title:"Show Dialog"}),UranusGraphicsSettings.attributes.add("startingPreset",{type:"string",default:"desktop",title:"Starting Preset"}),UranusGraphicsSettings.attributes.add("autoSelectPreset",{type:"boolean",default:!0,title:"Auto Select Preset",description:"If selected a graphics preset will automatically be selected based on the device platform."}),UranusGraphicsSettings.attributes.add("lobbyEntity",{type:"entity",title:"Lobby Entity",description:"If an entity is provided the lobby entity will be enabled as soon as the settings dialog is enabled."}),UranusGraphicsSettings.attributes.add("startEntity",{type:"entity",title:"Start Entity",description:"If an entity is provided a start button will be created to enable that entity on user's action. The lobby entity will be disabled at the same time."}),UranusGraphicsSettings.attributes.add("playerControllers",{type:"entity",array:!0,title:"Player Controllers",description:"One or more player controllers to be used with the Toggle Controller button."}),UranusGraphicsSettings.attributes.add("defaultController",{type:"entity",title:"Default Controller",description:"The default controller the game will start with."}),UranusGraphicsSettings.attributes.add("grassObjects",{type:"entity",array:!0,title:"Grass Objects",description:"A list of entities to be disabled if grass is disabled in settings."}),UranusGraphicsSettings.attributes.add("terrainEntities",{type:"entity",array:!0,title:"Terrain Entities",description:"If one or more terrain entities are provided, they will be binded to the terrain shadows toggle."}),UranusGraphicsSettings.attributes.add("minTerrainLod",{type:"number",title:"Min Terrain Lod",description:"The minimum terrain LOD when no shadows are cast from the terain."}),UranusGraphicsSettings.attributes.add("soundVolume",{type:"number",default:.25,min:0,max:1,title:"Sound Volume"}),UranusGraphicsSettings.attributes.add("mapButton",{type:"boolean",default:!1,title:"Map Button"}),UranusGraphicsSettings.attributes.add("downgradePreset",{type:"json",schema:[{name:"minPreset",type:"string",default:"android",title:"Min Preset",description:"Preset to fall back to if minimum FPS threshold is crossed. Leave blank to disable the check."},{name:"minFps",type:"number",default:20,min:1,title:"Min FPS",description:"The minimum FPS limit."},{name:"minTime",type:"number",default:3,min:0,title:"Min Time",description:"The time in seconds the FPS should be lower than the limit to force a downgrade."},{name:"startTime",type:"number",default:5,min:0,title:"Start Time",description:"The time in seconds counting from the application start the downgrade check should be enabled. Set to 0 to keep it always enabled."}],title:"Downgrade Preset"}),UranusGraphicsSettings.attributes.add("presets",{type:"json",array:!0,schema:[{name:"id",type:"string",default:"mobile",title:"ID"},{name:"title",type:"string",default:"Mobile",title:"Title",description:"The title of the preset shown in the dialog."},{name:"platforms",type:"string",default:"mobile",title:"Platforms"},{name:"resolution",type:"number",min:0,max:2,default:1,title:"Resolution",description:"This defines how much the resolution will be downscaled or upscaled in relation to the viewport resolution. Leverage the browser bilinear filtering to increase performance by rendering your application in a lower resolution. Or render to a higher resolution for reducing anti alias."},{name:"devicePixelRatio",type:"number",min:0,max:1,default:0,title:"Device Pixel Ratio",description:"A normalized value 0-1 to indicate min/max device pixel ratio."},{name:"staticAo",type:"boolean",default:!1,title:"Static AO"},{name:"fogNoise",type:"boolean",default:!1,title:"Fog Noise",description:"Requires page reload."},{name:"grass",type:"boolean",default:!1,title:"Grass",description:"Requires page reload."},{name:"lights",type:"boolean",default:!1,title:"Lights"},{name:"lodMultiplier",type:"number",min:.25,max:3,default:1,title:"LOD Multiplier"},{name:"localShadows",type:"boolean",default:!1,title:"Local Shadows"},{name:"postEffects",type:"boolean",default:!1,title:"Post Effects"},{name:"postEffectsTypes",type:"string",default:"ssao,bloom,fxaa,vignette,chromaticAberration,sharpen,bokeh",title:"Post Effects Types"},{name:"planarReflections",type:"boolean",default:!1,title:"Planar Reflections"},{name:"playerParticles",type:"boolean",default:!0,title:"Player Particles"},{name:"sunShadows",type:"boolean",default:!1,title:"Sun Shadows"},{name:"shadowsCascades",type:"number",min:1,max:4,precision:0,default:2,title:"Shadows Cascades"},{name:"shadowsDistance",type:"number",min:1,max:1e3,precision:0,default:600,title:"Shadows Distance"},{name:"skyClouds",type:"boolean",default:!1,title:"Sky Clouds"},{name:"surfaceBlend",type:"boolean",default:!1,title:"Surface Blend"}]}),UranusGraphicsSettings.postEffectsTypes=["ssao","bloom","fxaa","vignette","chromaticAberration","sharpen","bokeh","hueSaturation"],UranusGraphicsSettings.prototype.initialize=function(){UranusGraphicsSettings.api=this,this.activePreset=void 0,this.dialogPane=void 0,this.dialogInputs={},this.buttons={},this.activePlayerController=this.playerControllers[0],this.gameStarted=!1,this.gameStartTime=0,this.prepare(),this.updateSettings(),this.showDialog&&(this.lobbyEntity&&(this.lobbyEntity.enabled=!0),this.startEntity&&(this.startEntity.enabled=!1),this.createDialog()),this.on("attr",((e,t)=>{"startingPreset"===e?this.setSelectedPreset(t):this.setSelectedPreset(this.startingPreset),this.updateSettings()})),this.app.on("UranusGraphicsSettings:startGame",this.startGame,this),this.app.on("UranusGraphicsSettings:setButtonState",this.setButtonState,this),this.app.on("UranusGraphicsSettings:setPreset",(function(e){e?this.setSelectedPreset(e):this.setSelectedPreset(this.startingPreset),this.updateSettings()}),this)},UranusGraphicsSettings.prototype.prepare=function(){if(!1===this.app.graphicsDevice.isWebGL2){const e=this.getScriptInstancesByType("uranusInstancerOcclusion");e.forEach((t=>{t.entity.render&&(t.entity.render.enabled=!1),e.enabled=!1}))}if(this.app.systems.sound.volume=this.soundVolume,this.autoSelectPreset){const e=this.presets.slice().reverse().find((e=>{if(!e.platforms)return!1;let t=!1;return e.platforms.split(",").forEach((e=>{!t&&pc.platform[e]&&(t=!0)})),t}));e&&(this.startingPreset=e.id)}const e=this.getPresetByName(this.startingPreset);this.activePreset=JSON.parse(JSON.stringify(e)),this.activePresetID=this.activePreset.id,this.activePreset.id=void 0},UranusGraphicsSettings.prototype.update=function(e){const t=this.downgradePreset,i=t.minPreset;if(this.gameStartTime+=e,t&&(0===t.startTime||this.gameStartTime<=t.startTime)&&i!==this.activePresetID){const a=pc.app.stats?.frame?.fps;a>0&&a<=t.minFps?(void 0===this.downgradeTimer&&(this.downgradeTimer=t.minTime),this.downgradeTimer-=e,this.downgradeTimer<=0&&(this.downgradeTimer=void 0,this.app.fire("UranusGraphicsSettings:setPreset",i))):this.downgradeTimer=void 0}},UranusGraphicsSettings.prototype.setSelectedPreset=function(e){if(e){const t=this.getPresetByName(e);for(let e in t)"id"!==e?this.activePreset[e]=t[e]:this.activePresetID=t[e]}},UranusGraphicsSettings.prototype.getPresetByName=function(e){return this.presets.find((t=>t.id===e))},UranusGraphicsSettings.prototype.getScriptInstancesByType=function(e){return this.app.root.find((t=>t.script&&t.script[e])).map((t=>t.script[e]))},UranusGraphicsSettings.prototype.getEntitiesByTag=function(e){return this.app.root.findByTag(e)},UranusGraphicsSettings.prototype.getCameras=function(){return this.app.root.findComponents("camera")},UranusGraphicsSettings.prototype.getLights=function(){return this.app.root.findComponents("light")},UranusGraphicsSettings.prototype.addComponentLayer=function(e,t){const i=this.app.scene.layers.getLayerByName(t);if(!i)return;const a=e.layers;a&&(-1===a.indexOf(i.id)&&a.push(i.id),e.layers=a)},UranusGraphicsSettings.prototype.removeComponentLayer=function(e,t){const i=this.app.scene.layers.getLayerByName(t);if(!i)return;const a=e.layers;if(!a)return;const n=a.indexOf(i.id);a.splice(n,1),e.layers=a},UranusGraphicsSettings.prototype.getDevicePixelRatio=function(e){return 1+(window.devicePixelRatio-1)*e},UranusGraphicsSettings.prototype.updateSettings=function(e){e&&this.setSelectedPreset(e);const t=this.activePreset,i=this.getScriptInstancesByType("uranusGraphicsResolution")[0];i&&(i.resolution=t.resolution),this.app.graphicsDevice.maxPixelRatio=this.getDevicePixelRatio(t.devicePixelRatio),this.grassObjects.forEach((e=>e.enabled=t.grass)),this.getScriptInstancesByType("uranusEffectsMaterialAoStatic").forEach((e=>e.active=t.staticAo)),this.gameStarted||this.getScriptInstancesByType("uranusEffectsEnvironmentFog").forEach((e=>e.fogNoise=t.fogNoise)),UranusInstancer.api&&(UranusInstancer.api.lodMultiplier=t.lodMultiplier),this.app.root.findComponents("light").forEach((e=>{if("directional"===e.type)return!0;e.enabled=t.lights})),this.getScriptInstancesByType("uranusEffectsPlanarReflections").forEach((e=>{e.reflectionLayersOriginal||(e.reflectionLayersOriginal=e.reflectionLayers.slice()),t.planarReflections?e.reflectionLayers=e.reflectionLayersOriginal:e.reflectionLayersOriginal.indexOf("SkyReflection")>-1?e.reflectionLayers=["SkyReflection"]:e.reflectionLayers=[]})),this.playerControllers.forEach((e=>{e.findComponents("particlesystem").forEach((e=>e.enabled=t.playerParticles))}));const a=this.getLights();a.forEach((e=>{if("directional"!==e.type)return!0;void 0===e.castShadowsOriginal&&(e.castShadowsOriginal=e.castShadows),e.castShadowsOriginal&&(e.castShadows=t.sunShadows,e.numCascades=t.shadowsCascades,e.shadowDistance=t.shadowsDistance)})),a.forEach((e=>{if("directional"===e.type)return!0;void 0===e.castShadowsOriginal&&(e.castShadowsOriginal=e.castShadows),e.castShadowsOriginal&&(e.castShadows=t.localShadows,e.light.castShadowsUser=t.localShadows)})),this.getCameras().forEach((e=>{const i=e.entity;UranusGraphicsSettings.postEffectsTypes.forEach((e=>{i.script&&i.script[e]&&(i.script[e].enabled=!1)})),t.postEffectsTypes.split(",").forEach((e=>{i.script&&i.script[e]&&(i.script[e].enabled=t.postEffects)}))})),this.getScriptInstancesByType("uranusEffectsSkybox").forEach((e=>e.renderClouds=t.skyClouds)),this.getScriptInstancesByType("uranusEffectsMaterialSurfaceColor").forEach((e=>{e.surfaceBlendOriginal||(e.surfaceBlendOriginal=e.surfaceBlend),e.surfaceBlendOriginal&&(e.enabled=t.surfaceBlend)})),this.app.fire("UranusGraphicsSettings:onPresetChange",this.activePresetID,t)},UranusGraphicsSettings.prototype.createDialog=function(){const e=new pcui.Container({id:"uranus-graphics-settings",grid:!1,scrollable:!0});e.style.position="absolute",e.style.right="10px",e.style.top="10px",e.style.zIndex="9999",e.style.backgroundColor="rgba(54, 67, 70, 0.64)",e.style.backdropFilter="blur(32px)",e.style.borderRadius="6px",e.style.opacity="0.8",e.style.boxShadow="2px 2px 5px rgba(0,0,0,0.3)",document.body.appendChild(e.dom);const t=new pcui.Panel({flex:!0,collapsed:!0,collapsible:!0,collapseHorizontally:!0,scrollable:!0,headerText:"Settings"}),i=t.content;t.style.width="350px",t.on("collapse",(function(){e.style.opacity="0.5"})),t.on("expand",(function(){e.style.opacity="1.0"})),e.dom.appendChild(t.dom),this.dialogPane=i.dom,this.createDialogSettings(t.content),this.addDivider(),this.createDialogButtons()},UranusGraphicsSettings.prototype.addDivider=function(){const e=new pcui.Divider;this.dialogPane.appendChild(e.dom)},UranusGraphicsSettings.prototype.createDialogSettings=function(e){this.createDialogInput(e,"SelectInput",void 0,"Graphics Preset",{options:this.presets.map(((e,t)=>({v:e.id,t:e.title}))),value:this.startingPreset},(e=>{this.updateSettings(e);for(let e in this.activePreset){const t=this.dialogInputs[e];t&&(t.value=this.activePreset[e])}})),this.createDialogInput(e,"SliderInput",void 0,"Time of Day",{min:0,max:24,precision:2,value:12},(e=>{this.app.fire("UranusEffectsSkybox:setTime",e)}));const t=new pcui.Panel({flex:!0,collapsed:!0,collapsible:!0,scrollable:!0,headerText:"Graphics"});this.dialogPane.appendChild(t.dom),this.createDialogInput(t,"SliderInput","resolution","Resolution",{min:.01,max:2,precision:2,value:this.activePreset.resolution},(e=>{this.activePreset.resolution=e,this.updateSettings()})),this.createDialogInput(t,"SliderInput","devicePixelRatio","Device Pixel Ratio",{min:0,max:2,precision:2,value:this.activePreset.devicePixelRatio},(e=>{this.app.graphicsDevice.maxPixelRatio=this.getDevicePixelRatio(e)})),this.createDialogInput(t,"BooleanInput","fogNoise","Fog Noise *",{value:this.activePreset.fogNoise},(e=>{this.activePreset.fogNoise=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","grass","Grass *",{value:this.activePreset.grass},(e=>{this.activePreset.grass=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","lights","Local Lights",{value:this.activePreset.lights},(e=>{this.activePreset.lights=e,this.updateSettings()})),this.createDialogInput(t,"SliderInput","lodMultiplier","LOD Multiplier",{min:.25,max:3,precision:2,value:this.activePreset.lodMultiplier},(e=>{this.activePreset.lodMultiplier=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","planarReflections","Planar Reflections",{value:this.activePreset.planarReflections},(e=>{this.activePreset.planarReflections=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","localShadows","Local Shadows",{value:this.activePreset.localShadows},(e=>{this.activePreset.localShadows=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","postEffects","Post Effects",{value:this.activePreset.postEffects},(e=>{this.activePreset.postEffects=e,this.updateSettings()})),this.createDialogInput(t,"TextInput","postEffectsTypes","Post Effects Types",{value:this.activePreset.postEffectsTypes},(e=>{this.activePreset.postEffectsTypes=e,this.updateSettings()})),this.createDialogInput(t,"SliderInput","shadowsCascades","Shadows Cascades",{min:1,max:4,precision:0,value:this.activePreset.shadowsCascades},(e=>{this.activePreset.shadowsCascades=e,this.updateSettings()})),this.createDialogInput(t,"SliderInput","shadowsDistance","Shadows Distance",{min:200,max:1e3,precision:0,value:this.activePreset.shadowsDistance},(e=>{this.activePreset.shadowsDistance=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","skyClouds","Sky Clouds",{value:this.activePreset.skyClouds},(e=>{this.activePreset.skyClouds=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","sunShadows","Sun Shadows",{value:this.activePreset.sunShadows},(e=>{this.activePreset.sunShadows=e,this.updateSettings()})),this.createDialogInput(t,"BooleanInput","surfaceBlend","Surface Blend",{value:this.activePreset.surfaceBlend},(e=>{this.activePreset.surfaceBlend=e,this.updateSettings()}));const i=new pcui.LabelGroup({text:"* requires reload",flexShrink:0});i.label.width=320,i.style.textAlign="right",i.style.fontSize="13px",t.dom.appendChild(i.dom)},UranusGraphicsSettings.prototype.createDialogInput=function(e,t,i,a,n,r){const s=new pcui.LabelGroup({text:a,flexShrink:0});s.label.width=150;const o=new pcui[t](n);i&&(this.dialogInputs[i]=o),o.on("change",r),s.dom.appendChild(o.dom),e.dom.appendChild(s.dom)},UranusGraphicsSettings.prototype.createDialogButtons=function(){const e=new pcui.Panel({collapsible:!1,headerText:"Actions"}),t=e.content;if(this.startEntity){const e=new pcui.Button({text:"Start Game"});this.buttons.startGame=e,e.on("click",(()=>{e.enabled=!1,window.setTimeout((()=>{this.startGame()}),200)})),t.dom.appendChild(e.dom)}if(this.playerControllers.length>1){const e=new pcui.Button({text:"Toggle Controller"});e.enabled=!1;const i="toggleController";this.buttons[i]=e,e.on("click",(()=>{this.toggleController(),this.app.fire(`UranusGraphicsSettings:onButtonClick:${i}`)})),t.dom.appendChild(e.dom)}if(this.mapButton){const e=new pcui.Button({text:"Toggle Map"});e.enabled=!1;const i="toggleMap";this.buttons[i]=e,e.on("click",(()=>{this.app.fire(`UranusGraphicsSettings:onButtonClick:${i}`)})),t.dom.appendChild(e.dom)}this.dialogPane.appendChild(e.dom)},UranusGraphicsSettings.prototype.startGame=function(){this.gameStarted=!0,this.setButtonState("startGame",!1),this.playerControllers.length>1&&this.setButtonState("toggleController",!0),this.defaultController&&this.enableController(this.defaultController),this.lobbyEntity&&(this.lobbyEntity.enabled=!1),this.startEntity&&(this.startEntity.enabled=!0),this.enableController(this.activePlayerController),this.app.fire("UranusGraphicsSettings:onGameStart")},UranusGraphicsSettings.prototype.setButtonState=function(e,t){const i=this.buttons[e];i&&(i.enabled=t)},UranusGraphicsSettings.prototype.enableController=function(e){if(!e)return;this.playerControllers.forEach((e=>e.enabled=!1)),this.app.mouse.disablePointerLock(),e.enabled=!0;const t=this.activePlayerController;this.activePlayerController=e,this.activeControllerUpdateEffects(),this.app.fire("UranusGraphicsSettings:changeController",this.activePlayerController,t)},UranusGraphicsSettings.prototype.activeControllerUpdateEffects=function(){const e=this.activePlayerController.findComponent("camera"),t=e.entity;if(this.activePreset.postEffects&&e){e.postEffects.destroy();try{e.postEffects=new pc.PostEffectQueue(this.app,t)}catch(e){}this.activePreset.postEffectsTypes.split(",").forEach((e=>{t.script&&t.script[e]&&(t.script[e].enabled=!1,t.script[e].enabled=!0)}))}},UranusGraphicsSettings.prototype.toggleController=function(e){e||(e=this.playerControllers.findIndex((e=>e===this.activePlayerController))),++e>=this.playerControllers.length&&(e=0);const t=this.playerControllers[e];!t.tags.has("settings-controller-mouse")||this.app.mouse?this.enableController(t):this.toggleController(e)};var world2reflMirror,UranusEffectsPlanarReflections=pc.createScript("uranusEffectsPlanarReflections");UranusEffectsPlanarReflections.attributes.add("inEditor",{type:"boolean",default:!0}),UranusEffectsPlanarReflections.attributes.add("activeCameras",{type:"entity",array:!0,title:"Active Cameras",description:"A list of cameras to render reflections from."}),UranusEffectsPlanarReflections.attributes.add("materialAssets",{type:"asset",assetType:"material",array:!0,description:"If apply shader is selected, this material will be updated to have the reflections map referenced on its diffuse channel. If not, a shader uniform named texture_planarReflectionMap will be added to the material scope."}),UranusEffectsPlanarReflections.attributes.add("reflectionLayers",{type:"string",array:!0,default:["WaterReflection"],title:"Reflection Layers",description:"The scene layers names that are being used by models casting reflections."}),UranusEffectsPlanarReflections.attributes.add("refractionLayers",{type:"string",array:!0,default:["WaterRefraction"],title:"Refraction Layers",description:"The scene layers names that iare being used by models casting refraction."}),UranusEffectsPlanarReflections.attributes.add("renderPreset",{type:"string",default:"Reflection",enum:[{Reflection:"Reflection"},{Refraction:"Refraction"},{Both:"Both"}],title:"Render Preset",description:"Select if a reflection or refraction map will be rendered (or both). Restart is required."}),UranusEffectsPlanarReflections.attributes.add("resolutionFactor",{type:"number",min:1,max:4,precision:0,default:1,title:"Resolution Factor",description:"Used to scale down the resolution size of the reflection render target and improve performance. Set to 1 to be equal in size with the screen size. Set to 4 to downscale the resolution 4x."}),UranusEffectsPlanarReflections.attributes.add("reflectionVector",{type:"vec3",default:[0,0,0],title:"Reflection Vector",description:"If set to non zero, then this normal will be used instead of the entity back direction."}),UranusEffectsPlanarReflections.attributes.add("reflectionOffset",{type:"vec3",default:[0,0,0],title:"Reflection Offset",description:"Add a reflection plane offset to fine adjust the exact position of the plane."}),UranusEffectsPlanarReflections.attributes.add("reflectSkybox",{type:"boolean",default:!1,title:"Reflect Skybox",description:"If selected the scene skybox will be added to the reflections."}),UranusEffectsPlanarReflections.attributes.add("updateFrequency",{title:"Update Frequency",description:"Set the frequency of the reflections rendered to skip this number of frames. If it is set to 0 it will update per frame.",type:"number",default:0,min:0}),UranusEffectsPlanarReflections.attributes.add("materialSettings",{type:"json",array:!0,schema:[{name:"applyShader",type:"boolean",default:!0,title:"Apply Shader",description:"If apply shader is selected, the referenced material will be updated to have the reflections map on its diffuse channel and the diffuse shader chunk will be updated."},{name:"uvChannel",type:"string",default:"vUv0",enum:[{UV0:"vUv0"},{UV1:"vUv1"}],title:"UV Channel",description:"When using Apply Shader set which UV channel should be used."},{name:"shaderReflectionsIntensity",type:"number",default:1,min:0,title:"Reflections Intensity",description:"Sets the intensity of the reflections map."},{name:"shaderReflectionsIndex",type:"number",default:1,min:0,title:"Reflections Index",description:"Sets the reflection index that affects the reflections viewing angle."},{name:"shaderReflectionsNormalMap",type:"asset",assetType:"texture",title:"Normal Map",description:"If a normal is provided it will be used for the reflections in the overriden shader."},{name:"shaderReflectionsNormalIntensity",type:"number",default:.05,precision:3,min:0,max:2,title:"Normal Intensity",description:"Sets the intensity of the reflections normal map."},{name:"shaderReflectionsNormalTiling",type:"vec2",default:[1,1],title:"Normal Tiling",description:"Sets the UV tiling of the reflections normal map."},{name:"shaderReflectionsMask",type:"asset",assetType:"texture",title:"Mask",description:"If a mask is provided it will be used to mask the reflections."},{name:"shaderReflectionsMaskTiling",type:"vec2",default:[1,1],title:"Mask Tiling",description:"Sets the UV tiling of the reflections mask."}]}),UranusEffectsPlanarReflections.prototype.initialize=function(){!0!==this.app.graphicsDevice.isWebGL1?(this.canvasTimeout=void 0,this.updateCount=0,this.renderReflection="Reflection"===this.renderPreset||"Both"===this.renderPreset,this.renderRefraction="Refraction"===this.renderPreset||"Both"===this.renderPreset,this.prepareCamera(),this.prepareReflections(),this.on("attr",(function(e){0!==e.indexOf("shader")?this.prepareReflections():this.updateShaderAttributes()}),this),this.on("state",(function(e){this.reflectionCamera&&(this.reflectionCamera.enabled=e),this.refractionCamera&&(this.refractionCamera.enabled=e)})),this.app.graphicsDevice.on("resizecanvas",this.onResizeCanvas,this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",this.onResizeCanvas,this),this.clearRenderTarget(),this.reflectionCamera&&this.reflectionCamera.destroy(),this.refractionCamera&&this.refractionCamera.destroy()}))):this.enabled=!1},UranusEffectsPlanarReflections.prototype.onResizeCanvas=function(){window.clearTimeout(this.canvasTimeout),this.canvasTimeout=window.setTimeout((()=>{this.reflectionCamera&&(this.reflectionCamera.camera.renderTarget=this.updateRenderTarget("Reflection")),this.refractionCamera&&(this.refractionCamera.camera.renderTarget=this.updateRenderTarget("Refraction"))}),100)},UranusEffectsPlanarReflections.prototype.getReflectionLayers=function(e){const t=[];return e.forEach((e=>{const i=this.app.scene.layers.getLayerByName(e);i&&t.push(i)})),t},UranusEffectsPlanarReflections.prototype.prepareCamera=function(){if(this.renderReflection){const e=new pc.Entity("Reflection Camera");e.addComponent("camera",{flipFaces:!0,priority:-1}),e.uranusReflectionsCamera=!1,this.reflectionCamera=e,e.enabled=!0}if(this.renderRefraction){const e=new pc.Entity("Refraction Camera");e.addComponent("camera",{priority:10}),e.uranusReflectionsCamera=!1,this.refractionCamera=e,e.enabled=!0}},UranusEffectsPlanarReflections.prototype.getActiveCamera=function(){let e;if(this.activeCameras.length>0)this.activeCameras.forEach((t=>{t.enabled&&(e=t)}));else{const t=this.app.scene.layers.cameras,i=t[t.length-1];if(!i)return;e=i.entity}return e},UranusEffectsPlanarReflections.prototype.postUpdate=function(){const e=this.getActiveCamera();if(!e)return;const t=this.reflectionCamera,i=this.refractionCamera,a=this.updateFrequency;this.updateCount--,this.updateCount<0?(this.updateCount=a,t&&(t.camera.enabled=!0,this.postUpdateCamera(t,e)),i&&(i.camera.enabled=!0,this.postUpdateCamera(i,e))):(t&&(t.camera.enabled=!1),i&&(i.camera.enabled=!1))},UranusEffectsPlanarReflections.prototype.postUpdateCamera=function(e,t){t||(t=this.getActiveCamera()),e.parent!==t&&(e.reparent(t),UranusUtilities.copyCameraProperties(e,t));const i=t.camera,a=e.camera,n=a.rect,r=i.rect;!1===r.equals(n)&&n.copy(r),a.horizontalFov=i.horizontalFov,a.fov=i.fov,a.aspectRatio=i.aspectRatio,a.farClip=i.farClip,a.nearClip=i.nearClip},UranusEffectsPlanarReflections.prototype.prepareReflections=function(){this.materialAssets.forEach(((e,t)=>{const i=this.materialSettings[t];if(!i||!i.applyShader)return;const a=e.resource;a.chunks.diffusePS=this.getShader(i),a.chunks.APIVersion=pc.CHUNKAPI_1_63,a.update()})),this.updateShaderAttributes();const e=this.entity;this.planePosW=e.getPosition().clone().add(this.reflectionOffset),!1===pc.Vec3.ZERO.equals(this.reflectionVector)?this.planeNormalW=this.reflectionVector:this.planeNormalW=e.up.scale(-1).clone();const t=this.planeNormalW.x,i=this.planeNormalW.y,a=this.planeNormalW.z,n=-this.planePosW.dot(this.planeNormalW);this.world2refl=reflectionMatrix(t,i,a,n),this.planeDW=n;const r=this,s=this.app.renderer.updateCameraFrustum.bind(this.app.renderer),o=this.reflectionCamera?.camera;if(o){o.renderTarget=this.updateRenderTarget("Reflection");const preFunctionReflection=function(){planePosWM=r.planePosW,planeNormalWM=r.planeNormalW,world2reflMirror=r.world2refl,o&&(o.calculateTransform=customTransformFuncMirror,o.calculateProjection=customProjFuncMirror,s(o.camera))},e=this.getReflectionLayers(this.reflectionLayers);e.forEach((e=>{e.onPreCull=e.onPreRender=preFunctionReflection})),o.layers=e.map((e=>e.id))}const l=this.refractionCamera?.camera;if(l){l.renderTarget=this.updateRenderTarget("Refraction");const preFunctionRefraction=function(){planePosWM=r.planePosW,planeNormalWM=r.planeNormalW,world2reflMirror=r.world2refl,l.calculateTransform=customTransformFunc,l.calculateProjection=customProjFuncMirror,s(l.camera)},e=this.getReflectionLayers(this.refractionLayers);e.forEach((e=>{e.onPreCull=e.onPreRender=preFunctionRefraction})),l.layers=e.map((e=>e.id))}},UranusEffectsPlanarReflections.prototype.clearRenderTarget=function(e){!this.rtReflection||e&&"Reflection"!==e||(this.rtReflection.colorBuffer.destroy(),this.rtReflection.destroy()),!this.rtRefraction||e&&"Refraction"!==e||(this.rtRefraction.colorBuffer.destroy(),this.rtRefraction.destroy())},UranusEffectsPlanarReflections.prototype.updateRenderTarget=function(e){this.clearRenderTarget(e);const t=this.app.graphicsDevice;let i=pc.PIXELFORMAT_R8_G8_B8_A8;t.isWebGL2&&t.extTextureFloatRenderable?i=pc.PIXELFORMAT_111110F:t.extTextureHalfFloatRenderable&&t.extTextureHalfFloatLinear&&(i=pc.PIXELFORMAT_RGBA16F);const a=new pc.Texture(t,{width:parseInt(t.width/this.resolutionFactor),height:parseInt(t.height/this.resolutionFactor),format:i,autoMipmap:!1});a.addressU=pc.ADDRESS_CLAMP_TO_EDGE,a.addressV=pc.ADDRESS_CLAMP_TO_EDGE,a.magFilter=pc.FILTER_LINEAR,a.minFilter=pc.FILTER_LINEAR;const n=new pc.RenderTarget({colorBuffer:a,depth:!0,samples:4});return this[`rt${e}`]=n,this.materialAssets.forEach((t=>this.applyRenderTarget(e,a,t.resource))),n},UranusEffectsPlanarReflections.prototype.applyRenderTarget=function(e,t,i){t&&i&&i.setParameter(`texture_planar${e}Map`,t)},UranusEffectsPlanarReflections.prototype.updateShaderAttributes=async function(){const e=this.materialSettings.map((e=>e.shaderReflectionsNormalMap)).concat(this.materialSettings.map((e=>e.shaderReflectionsMask))),t=this.app.assets.find("texture-white.jpg");this.materialAssets.forEach(((e,i)=>{const a=this.materialSettings[i];if(!a||!a.applyShader)return;const n=e.resource;a.shaderReflectionsNormalMap&&n.setParameter("texture_planarReflectionNormalMap",t.resource),a.shaderReflectionsMask&&n.setParameter("texture_planarReflectionMask",t.resource)})),await UranusUtilities.loadAssets(e),this.materialAssets.forEach(((e,t)=>{const i=this.materialSettings[t];if(!i||!i.applyShader)return;const a=e.resource;a.setParameter("reflectionsIntensity",i.shaderReflectionsIntensity),a.setParameter("reflectionsIndex",i.shaderReflectionsIndex),a.setParameter("reflectionsNormalIntensity",i.shaderReflectionsNormalIntensity),a.setParameter("reflectionsNormalTiling",i.shaderReflectionsNormalTiling.data),a.setParameter("reflectionsMaskTiling",i.shaderReflectionsMaskTiling.data),i.shaderReflectionsNormalMap&&a.setParameter("texture_planarReflectionNormalMap",i.shaderReflectionsNormalMap.resource),i.shaderReflectionsMask&&a.setParameter("texture_planarReflectionMask",i.shaderReflectionsMask.resource)}))},UranusEffectsPlanarReflections.prototype.getShader=function(e){return`\nuniform vec4 uScreenSize;\n\n#ifdef MAPCOLOR\nuniform vec3 material_diffuse;\n#endif\n\nuniform sampler2D texture_planarReflectionMap;\nuniform float reflectionsIntensity;\nuniform float reflectionsIndex;\nuniform float reflectionsNormalIntensity;\nuniform vec2 reflectionsNormalTiling;\n\n${e.shaderReflectionsNormalMap?"\nuniform sampler2D texture_planarReflectionNormalMap;\nuniform mat3 matrix_view3;\n":""}\n\n${e.shaderReflectionsMask?"\nuniform sampler2D texture_planarReflectionMask;\nuniform vec2 reflectionsMaskTiling;\n":""}\n\nfloat schlick(float cosTheta, float refIndex) \n{\n    float r0 = (1.0 - refIndex) / (1.0 + refIndex);\n    r0 = r0 * r0;\n    return r0 + (1.0 - r0) * pow(1.0 - cosTheta, 5.0);\n}\n\nvoid getAlbedo() {\n    dAlbedo = vec3(1.0);\n\n    #ifdef MAPCOLOR\n        dAlbedo *= material_diffuse.rgb;\n    #endif\n\n    #ifdef MAPTEXTURE\n        vec3 albedoBase = $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n        dAlbedo *= addAlbedoDetail(albedoBase);\n    #endif\n\n    #ifdef MAPVERTEX\n        dAlbedo *= gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n\n    vec2 reflCoords = gl_FragCoord.xy * uScreenSize.zw;\n\n    ${e.shaderReflectionsNormalMap?`\n\n    vec3 normalMap = unpackNormal(texture2D(texture_planarReflectionNormalMap, ${e.uvChannel} * reflectionsNormalTiling, textureBias));\n    normalMap = mix(vec3(0.0, 0.0, 1.0), normalMap, reflectionsNormalIntensity);\n    vec3 normalW = normalize(dTBN * normalMap);\n\n    vec3 viewDirS = matrix_view3 * normalW;\n    reflCoords.xy += viewDirS.xy * (-0.086 * reflectionsNormalIntensity);\n\n    vec2 dx = dFdx(reflCoords);\n    vec2 dy = dFdy(reflCoords);\n    float flatten = dot(abs(dy*1.0),vec2(1.0));\n\n    vec2 dudv = normalW.xz;\n    dudv.x *= 0.0;\n    dudv.y *= 2.0;\n    dudv /= flatten*3.0+1.0;\n\n    reflCoords += dudv;    \n    `:""}\n\n    ${e.shaderReflectionsMask?"\n    float mask = texture2D(texture_planarReflectionMask, $UV * reflectionsMaskTiling, textureBias).r;\n    vec3 planarReflections = mask * reflectionsIntensity * texture2D(texture_planarReflectionMap, reflCoords, textureBias).rgb;\n    ":"\n    vec3 planarReflections = reflectionsIntensity * texture2D(texture_planarReflectionMap, reflCoords, textureBias).rgb;\n    "}\n\n    float cosTheta = dot(normalize(dViewDirW), normalize(dNormalW));\n    float blendFactor = schlick(cosTheta, reflectionsIndex);\n    dAlbedo = mix(dAlbedo, planarReflections, blendFactor);\n}\n`};var planePosWM,planeNormalWM,planeAV,planeBV,planeCV,planeDV,tmpView=new pc.Mat4,planeQ=new pc.Vec4,planeV=new pc.Vec4,planePosV=new pc.Vec3,planeNormalV=new pc.Vec3,projInv=new pc.Mat4;function reflectionMatrix(e,t,i,a){var n=new pc.Mat4;return n.data[0]=1-2*e*e,n.data[1]=-2*e*t,n.data[2]=-2*e*i,n.data[3]=-2*e*a,n.data[4]=-2*e*t,n.data[5]=1-2*t*t,n.data[6]=-2*t*i,n.data[7]=-2*t*a,n.data[8]=-2*e*i,n.data[9]=-2*t*i,n.data[10]=1-2*i*i,n.data[11]=-2*i*a,n.data[12]=0,n.data[13]=0,n.data[14]=0,n.data[15]=1,n.transpose(),n}function customTransformFuncMirror(e,t){var i=this.node.getPosition(),a=this.node.getRotation();e.setTRS(i,a,pc.Vec3.ONE),e.mul2(world2reflMirror,e)}function customTransformFunc(e,t){var i=this.node.getPosition(),a=this.node.getRotation();e.setTRS(i,a,pc.Vec3.ONE)}function customProjFuncMirror(e,t){function sgn(e){return e>0?1:e<0?-1:0}if(this.projection===pc.PROJECTION_PERSPECTIVE)e.setPerspective(this.fov,this.aspectRatio,this.nearClip,this.farClip,this.horizontalFov);else{var i=this.orthoHeight,a=i*this.aspectRatio;e.setOrtho(-a,a,-i,i,this.nearClip,this.farClip)}var n=this.node.getPosition(),r=this.node.getRotation();tmpView.setTRS(n,r,pc.Vec3.ONE).invert(),tmpView.transformPoint(planePosWM,planePosV),tmpView.transformVector(planeNormalWM,planeNormalV).normalize(),planeAV=planeNormalV.x,planeBV=planeNormalV.y,planeCV=planeNormalV.z,planeDV=-planePosV.dot(planeNormalV),planeV.set(planeAV,planeBV,planeCV,planeDV),projInv.copy(e).invert(),planeQ.set(sgn(planeAV),sgn(planeBV),1,1),projInv.transformVec4(planeQ,planeQ),planeV.scale(2/planeV.dot(planeQ));var s=e.data;s[2]=planeV.x-s[3],s[6]=planeV.y-s[7],s[10]=planeV.z-s[11],s[14]=planeV.w-s[15]}var BreathingSphere=pc.createScript("breathingSphere");BreathingSphere.attributes.add("baseSpeed",{type:"number",default:.5,title:"Velocidad base"}),BreathingSphere.attributes.add("intensity",{type:"number",default:.25,title:"Intensidad de respiración"}),BreathingSphere.attributes.add("speedVariation",{type:"number",default:.3,title:"Variación máxima de velocidad"}),BreathingSphere.attributes.add("speedChangeRate",{type:"number",default:.1,title:"Velocidad de cambio de ritmo"}),BreathingSphere.attributes.add("minScale",{type:"number",default:.8,title:"Escala mínima relativa"}),BreathingSphere.prototype.noise=function(e){var t=255&Math.floor(e),i=(e-=Math.floor(e))*e*(3-2*e);return this.grad(this.perm[t],e)*(1-i)+this.grad(this.perm[t+1],e-1)*i},BreathingSphere.prototype.grad=function(e,t){return 0==(1&e)?t:-t},BreathingSphere.prototype.initialize=function(){this.time=100*Math.random(),this.speedTime=50*Math.random(),this.baseScale=this.entity.getLocalScale().clone(),this.basePosition=this.entity.getLocalPosition().clone(),this.perm=[];for(var e=0;e<256;e++)this.perm[e]=Math.floor(256*Math.random());this.perm=this.perm.concat(this.perm),this.currentSpeed=this.baseSpeed},BreathingSphere.prototype.update=function(e){this.speedTime+=e*this.speedChangeRate;var t=this.noise(this.speedTime)*this.speedVariation;this.currentSpeed=this.baseSpeed+t,this.time+=e*this.currentSpeed;var i=this.noise(this.time)*this.intensity*this.baseScale.y,a=this.baseScale.y+i,s=this.baseScale.x-.5*i,r=this.baseScale.z-.5*i;s=Math.max(s,this.baseScale.x*this.minScale),a=Math.max(a,this.baseScale.y*this.minScale),r=Math.max(r,this.baseScale.z*this.minScale),this.entity.setLocalScale(s,a,r);this.baseScale.y};var DroneFloat=pc.createScript("droneFloat");DroneFloat.attributes.add("floatHeight",{type:"number",default:5,title:"Altura base"}),DroneFloat.attributes.add("floatAmount",{type:"number",default:.25,title:"Amplitud de flotación"}),DroneFloat.attributes.add("floatSpeed",{type:"number",default:.6,title:"Velocidad de oscilación"}),DroneFloat.attributes.add("rotationAmount",{type:"number",default:2.5,title:"Amplitud de rotación"}),DroneFloat.attributes.add("noiseScale",{type:"number",default:.5,title:"Intensidad de ruido"}),DroneFloat.prototype.initialize=function(){this.basePos=this.entity.getLocalPosition().clone(),this.time=100*Math.random(),pc.noise||(pc.noise={grad3:[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],p:[],perm:[],init:function(){for(var t=0;t<256;t++)this.p[t]=Math.floor(256*Math.random());for(t=0;t<512;t++)this.perm[t]=this.p[255&t]},dot:function(t,e,i){return t[0]*e+t[1]*i},fade:function(t){return t*t*t*(t*(6*t-15)+10)},lerp:function(t,e,i){return(1-i)*t+i*e},noise2D:function(t,e){var i,o,n=this.grad3,a=this.perm,s=(t+e)*(.5*(Math.sqrt(3)-1)),r=Math.floor(t+s),l=Math.floor(e+s),h=(3-Math.sqrt(3))/6,u=(r+l)*h,d=t-(r-u),c=e-(l-u);d>c?(i=1,o=0):(i=0,o=1);var p=d-i+h,m=c-o+h,f=d-1+2*h,D=c-1+2*h,b=255&r,A=255&l,y=a[b+a[A]]%12,F=a[b+i+a[A+o]]%12,v=a[b+1+a[A+1]]%12,M=0,S=0,g=0,P=.5-d*d-c*c;P>=0&&(M=(P*=P)*P*this.dot(n[y],d,c));var L=.5-p*p-m*m;L>=0&&(S=(L*=L)*L*this.dot(n[F],p,m));var q=.5-f*f-D*D;return q>=0&&(g=(q*=q)*q*this.dot(n[v],f,D)),70*(M+S+g)}},pc.noise.init())},DroneFloat.prototype.update=function(t){this.time+=t*this.floatSpeed;var e=pc.noise.noise2D(.5*this.time,0)*this.floatAmount,i=pc.noise.noise2D(0,.5*this.time)*this.floatAmount,o=pc.noise.noise2D(.3*this.time,.7*this.time)*this.floatAmount,n=this.basePos.clone();n.x+=e*this.noiseScale,n.y+=Math.sin(this.time)*this.floatAmount+i*this.noiseScale,n.z+=o*this.noiseScale,this.entity.setLocalPosition(n);var a=pc.noise.noise2D(this.time,5)*this.rotationAmount,s=pc.noise.noise2D(10,this.time)*this.rotationAmount,r=new pc.Vec3(a,0,s);this.entity.setLocalEulerAngles(r)};class SSAOEffect extends pc.PostEffect{constructor(e,t){super(e),this.ssaoScript=t,this.needsDepthBuffer=!0;var i=[pc.shaderChunks.screenDepthPS,"","varying vec2 vUv0;","","//uniform sampler2D uColorBuffer;","uniform vec4 uResolution;","","uniform float uAspect;","","#define saturate(x) clamp(x,0.0,1.0)","","// Largely based on 'Dominant Light Shadowing'","// 'Lighting Technology of The Last of Us Part II' by Hawar Doghramachi, Naughty Dog, LLC","","const float kSSCTLog2LodRate = 3.0;","","highp float getWFromProjectionMatrix(const mat4 p, const vec3 v) {","    // this essentially returns (p * vec4(v, 1.0)).w, but we make some assumptions","    // this assumes a perspective projection","    return -v.z;","    // this assumes a perspective or ortho projection","    // return p[2][3] * v.z + p[3][3];","}","","highp float getViewSpaceZFromW(const mat4 p, const float w) {","    // this assumes a perspective projection","    return -w;","    // this assumes a perspective or ortho projection","   // return (w - p[3][3]) / p[2][3];","}","","","const float kLog2LodRate = 3.0;","","vec2 sq(const vec2 a) {","    return a * a;","}","","uniform float uInvFarPlane;","","vec2 pack(highp float depth) {","// we need 16-bits of precision","    highp float z = clamp(depth * uInvFarPlane, 0.0, 1.0);","    highp float t = floor(256.0 * z);","    mediump float hi = t * (1.0 / 256.0);   // we only need 8-bits of precision","    mediump float lo = (256.0 * z) - t;     // we only need 8-bits of precision","    return vec2(hi, lo);","}","","// random number between 0 and 1, using interleaved gradient noise","float random(const highp vec2 w) {","    const vec3 m = vec3(0.06711056, 0.00583715, 52.9829189);","    return fract(m.z * fract(dot(w, m.xy)));","}","","// returns the frag coord in the GL convention with (0, 0) at the bottom-left","highp vec2 getFragCoord() {","    return gl_FragCoord.xy;","}","","highp vec3 computeViewSpacePositionFromDepth(highp vec2 uv, highp float linearDepth) {","    return vec3((0.5 - uv) * vec2(uAspect, 1.0) * linearDepth, linearDepth);","}","","highp vec3 faceNormal(highp vec3 dpdx, highp vec3 dpdy) {","    return normalize(cross(dpdx, dpdy));","}","","// Compute normals using derivatives, which essentially results in half-resolution normals","// this creates arifacts around geometry edges.","// Note: when using the spirv optimizer, this results in much slower execution time because","//       this whole expression is inlined in the AO loop below.","highp vec3 computeViewSpaceNormal(const highp vec3 position) {","    return faceNormal(dFdx(position), dFdy(position));","}","","// Compute normals directly from the depth texture, resulting in full resolution normals","// Note: This is actually as cheap as using derivatives because the texture fetches","//       are essentially equivalent to textureGather (which we don't have on ES3.0),","//       and this is executed just once.","highp vec3 computeViewSpaceNormal(const highp vec3 position, const highp vec2 uv) {","    highp vec2 uvdx = uv + vec2(uResolution.z, 0.0);","    highp vec2 uvdy = uv + vec2(0.0, uResolution.w);","    highp vec3 px = computeViewSpacePositionFromDepth(uvdx, -getLinearScreenDepth(uvdx));","    highp vec3 py = computeViewSpacePositionFromDepth(uvdy, -getLinearScreenDepth(uvdy));","    highp vec3 dpdx = px - position;","    highp vec3 dpdy = py - position;","    return faceNormal(dpdx, dpdy);","}","","// Ambient Occlusion, largely inspired from:","// 'The Alchemy Screen-Space Ambient Obscurance Algorithm' by Morgan McGuire","// 'Scalable Ambient Obscurance' by Morgan McGuire, Michael Mara and David Luebke","","uniform vec2 uSampleCount;","uniform float uSpiralTurns;","","#define PI (3.14159)","","vec3 tapLocation(float i, const float noise) {","    float offset = ((2.0 * PI) * 2.4) * noise;","    float angle = ((i * uSampleCount.y) * uSpiralTurns) * (2.0 * PI) + offset;","    float radius = (i + noise + 0.5) * uSampleCount.y;","    return vec3(cos(angle), sin(angle), radius * radius);","}","","highp vec2 startPosition(const float noise) {","    float angle = ((2.0 * PI) * 2.4) * noise;","    return vec2(cos(angle), sin(angle));","}","","uniform vec2 uAngleIncCosSin;","","highp mat2 tapAngleStep() {","    highp vec2 t = uAngleIncCosSin;","    return mat2(t.x, t.y, -t.y, t.x);","}","","vec3 tapLocationFast(float i, vec2 p, const float noise) {","    float radius = (i + noise + 0.5) * uSampleCount.y;","    return vec3(p, radius * radius);","}","","uniform float uMaxLevel;","uniform float uInvRadiusSquared;","uniform float uMinHorizonAngleSineSquared;","uniform float uBias;","uniform float uPeak2;","","void computeAmbientOcclusionSAO(inout float occlusion, float i, float ssDiskRadius,","        const highp vec2 uv,  const highp vec3 origin, const vec3 normal,","        const vec2 tapPosition, const float noise) {","","    vec3 tap = tapLocationFast(i, tapPosition, noise);","","    float ssRadius = max(1.0, tap.z * ssDiskRadius);","","    vec2 uvSamplePos = uv + vec2(ssRadius * tap.xy) * uResolution.zw;","","    float level = clamp(floor(log2(ssRadius)) - kLog2LodRate, 0.0, float(uMaxLevel));","    highp float occlusionDepth = -getLinearScreenDepth(uvSamplePos);","    highp vec3 p = computeViewSpacePositionFromDepth(uvSamplePos, occlusionDepth);","","    // now we have the sample, compute AO","    vec3 v = p - origin;        // sample vector","    float vv = dot(v, v);       // squared distance","    float vn = dot(v, normal);  // distance * cos(v, normal)","","    // discard samples that are outside of the radius, preventing distant geometry to","    // cast shadows -- there are many functions that work and choosing one is an artistic","    // decision.","    float w = max(0.0, 1.0 - vv * uInvRadiusSquared);","    w = w*w;","","    // discard samples that are too close to the horizon to reduce shadows cast by geometry","    // not sufficiently tessellated. The goal is to discard samples that form an angle 'beta'","    // smaller than 'epsilon' with the horizon. We already have dot(v,n) which is equal to the","    // sin(beta) * |v|. So the test simplifies to vn^2 < vv * sin(epsilon)^2.","    w *= step(vv * uMinHorizonAngleSineSquared, vn * vn);","","    occlusion += w * max(0.0, vn + origin.z * uBias) / (vv + uPeak2);","}","","uniform float uProjectionScaleRadius;","uniform float uIntensity;","","float scalableAmbientObscurance(highp vec2 uv, highp vec3 origin, vec3 normal) {","    float noise = random(getFragCoord());","    highp vec2 tapPosition = startPosition(noise);","    highp mat2 angleStep = tapAngleStep();","","    // Choose the screen-space sample radius","    // proportional to the projected area of the sphere","    float ssDiskRadius = -(uProjectionScaleRadius / origin.z);","","    float occlusion = 0.0;","    for (float i = 0.0; i < uSampleCount.x; i += 1.0) {","        computeAmbientOcclusionSAO(occlusion, i, ssDiskRadius, uv, origin, normal, tapPosition, noise);","        tapPosition = angleStep * tapPosition;","    }","    return sqrt(occlusion * uIntensity);","}","","uniform float uPower;","","void main() {","    highp vec2 uv = vUv0; //variable_vertex.xy; // interpolated to pixel center","","    highp float depth = -getLinearScreenDepth(vUv0);","    highp vec3 origin = computeViewSpacePositionFromDepth(uv, depth);","    vec3 normal = computeViewSpaceNormal(origin, uv);","","    float occlusion = 0.0;","","    if (uIntensity > 0.0) {","        occlusion = scalableAmbientObscurance(uv, origin, normal);","    }","","    // occlusion to visibility","    float aoVisibility = pow(saturate(1.0 - occlusion), uPower);","","    vec4 inCol = vec4(1.0, 1.0, 1.0, 1.0); //texture2D( uColorBuffer,  uv );","","    gl_FragColor.r = aoVisibility; //postProcess.color.rgb = vec3(aoVisibility, pack(origin.z));","}","","void main_old()","{","    vec2 aspectCorrect = vec2( 1.0, uAspect );","","    float depth = getLinearScreenDepth(vUv0);","    gl_FragColor.r = fract(floor(depth*256.0*256.0)),fract(floor(depth*256.0)),fract(depth);","}"].join("\n"),o=[pc.shaderChunks.screenDepthPS,"","varying vec2 vUv0;","","uniform sampler2D uSSAOBuffer;","uniform vec4 uResolution;","","uniform float uAspect;","","uniform int uBilatSampleCount;","uniform float uFarPlaneOverEdgeDistance;","uniform float uBrightness;","","float random(const highp vec2 w) {","    const vec3 m = vec3(0.06711056, 0.00583715, 52.9829189);","    return fract(m.z * fract(dot(w, m.xy)));","}","","float bilateralWeight(in float depth, in float sampleDepth) {","    float diff = (sampleDepth - depth) * uFarPlaneOverEdgeDistance;","    return max(0.0, 1.0 - diff * diff);","}","","void tap(inout float sum, inout float totalWeight, float weight, float depth, vec2 position) {","    // ambient occlusion sample","    float ssao = texture2D( uSSAOBuffer, position ).r;","    float tdepth = -getLinearScreenDepth( position );","","    // bilateral sample","    float bilateral = bilateralWeight(depth, tdepth);","    bilateral *= weight;","    sum += ssao * bilateral;","    totalWeight += bilateral;","}","","void main() {","    highp vec2 uv = vUv0; // variable_vertex.xy; // interpolated at pixel's center","","    // we handle the center pixel separately because it doesn't participate in bilateral filtering","    float depth = -getLinearScreenDepth(vUv0); // unpack(data.gb);","    float totalWeight = 0.0; // float(uBilatSampleCount*2+1)*float(uBilatSampleCount*2+1);","    float ssao = texture2D( uSSAOBuffer, vUv0 ).r;","    float sum = ssao * totalWeight;","","    for (int x = -uBilatSampleCount; x <= uBilatSampleCount; x++) {","       for (int y = -uBilatSampleCount; y < uBilatSampleCount; y++) {","           float weight = 1.0;","           vec2 offset = vec2(x,y)*uResolution.zw;","           tap(sum, totalWeight, weight, depth, uv + offset);","       }","    }","","    float ao = sum / totalWeight;","","    // simple dithering helps a lot (assumes 8 bits target)","    // this is most useful with high quality/large blurs","    // ao += ((random(gl_FragCoord.xy) - 0.5) / 255.0);","","    ao = mix(ao, 1.0, uBrightness);","    gl_FragColor.a = ao;","}"].join("\n"),a=["varying vec2 vUv0;","uniform sampler2D uColorBuffer;","uniform sampler2D uSSAOBuffer;","","void main(void)","{","    vec4 inCol = texture2D( uColorBuffer, vUv0 );","    float ssao = texture2D( uSSAOBuffer, vUv0 ).a;","    gl_FragColor.rgb = inCol.rgb * ssao;","    gl_FragColor.a = inCol.a;","}"].join("\n"),s={aPosition:pc.SEMANTIC_POSITION};this.ssaoShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,i,"SsaoShader",s),this.blurShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,o,"SsaoBlurShader",s),this.outputShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,a,"SsaoOutputShader",s),this.radius=4,this.brightness=0,this.samples=20,this.downscale=1}_destroy(){this.target&&(this.target.destroyTextureBuffers(),this.target.destroy(),this.target=null),this.blurTarget&&(this.blurTarget.destroyTextureBuffers(),this.blurTarget.destroy(),this.blurTarget=null)}_resize(e){var t=Math.ceil(e.colorBuffer.width/this.downscale),i=Math.ceil(e.colorBuffer.height/this.downscale);if(t!==this.width||i!==this.height){this.width=t,this.height=i,this._destroy();var o=new pc.Texture(this.device,{format:pc.PIXELFORMAT_RGBA8,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,width:this.width,height:this.height,mipmaps:!1});o.name="SSAO Result",this.target=new pc.RenderTarget({name:"SSAO Result Render Target",colorBuffer:o,depth:!1});var a=new pc.Texture(this.device,{format:pc.PIXELFORMAT_RGBA8,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,width:this.width,height:this.height,mipmaps:!1});a.name="SSAO Blur",this.blurTarget=new pc.RenderTarget({name:"SSAO Blur Render Target",colorBuffer:a,depth:!1})}}render(e,t,i){this._resize(e);var o=this.device,a=o.scope,s=this.samples,r=1/(s-.5)*10*2*3.141,n=this.radius,l=.1*n,u=2*l*3.141*.125,c=.5*o.height,h=this.ssaoScript.entity.camera.farClip;a.resolve("uAspect").setValue(this.width/this.height),a.resolve("uResolution").setValue([this.width,this.height,1/this.width,1/this.height]),a.resolve("uBrightness").setValue(this.brightness),a.resolve("uInvFarPlane").setValue(1/h),a.resolve("uSampleCount").setValue([s,1/s]),a.resolve("uSpiralTurns").setValue(10),a.resolve("uAngleIncCosSin").setValue([Math.cos(r),Math.sin(r)]),a.resolve("uMaxLevel").setValue(0),a.resolve("uInvRadiusSquared").setValue(1/(n*n)),a.resolve("uMinHorizonAngleSineSquared").setValue(0),a.resolve("uBias").setValue(.001),a.resolve("uPeak2").setValue(l*l),a.resolve("uIntensity").setValue(u),a.resolve("uPower").setValue(1),a.resolve("uProjectionScaleRadius").setValue(c*n),this.drawQuad(this.target,this.ssaoShader,i),a.resolve("uSSAOBuffer").setValue(this.target.colorBuffer),a.resolve("uFarPlaneOverEdgeDistance").setValue(1),a.resolve("uBilatSampleCount").setValue(4),this.drawQuad(this.blurTarget,this.blurShader,i),a.resolve("uSSAOBuffer").setValue(this.blurTarget.colorBuffer),a.resolve("uColorBuffer").setValue(e.colorBuffer),this.drawQuad(t,this.outputShader,i)}}var SSAO=pc.createScript("ssao");SSAO.attributes.add("radius",{type:"number",default:1,min:0,max:20,title:"Radius"}),SSAO.attributes.add("brightness",{type:"number",default:0,min:0,max:1,title:"Brightness"}),SSAO.attributes.add("samples",{type:"number",default:5,min:1,max:32,title:"Samples"}),SSAO.attributes.add("downscale",{type:"number",default:3,min:1,max:4,title:"Downscale"}),SSAO.prototype.initialize=function(){this.effect=new SSAOEffect(this.app.graphicsDevice,this),this.effect.radius=this.radius,this.effect.brightness=this.brightness,this.effect.samples=this.samples,this.effect.downscale=this.downscale,this.on("attr",(function(e,t){this.effect[e]=t}),this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this.effect._destroy()}))};var NanoBot=pc.createScript("nanoBot");NanoBot.prototype.initialize=function(){},NanoBot.prototype.update=function(e){if(GameManager.checkForPlayerAndTargetEntities)return;const t=GameManager.playerEntity.rigidbody.linearVelocity.length(),a=Math.ceil(100*t)/100;GameManager.setHudParameter("linearVelocity",a.toFixed(2))};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,r,s){e[0]=computeGaussian(0,s),t[0]=0,t[1]=0;var i,a,l=e[0];for(i=0,a=Math.floor(SAMPLE_COUNT/2);i<a;i++){var u=computeGaussian(i+1,s);e[2*i]=u,e[2*i+1]=u,l+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=r*h,t[4*i+2]=-o*h,t[4*i+3]=-r*h}for(i=0,a=e.length;i<a;i++)e[i]/=l}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets["+SAMPLE_COUNT+"];","uniform float uBlurWeights["+SAMPLE_COUNT+"];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),s=["varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,o,"BloomExtractShader",t),this.blurShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,r,"BloomBlurShader",t),this.combineShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,s,"BloomCombineShader",t),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,r=e.colorBuffer.height;if(o!==this.width||r!==this.height)for(this.width=o,this.height=r,this._destroy(),t=0;t<2;t++){var s=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_RGBA8,width:o>>1,height:r>>1,mipmaps:!1});s.minFilter=pc.FILTER_LINEAR,s.magFilter=pc.FILTER_LINEAR,s.addressU=pc.ADDRESS_CLAMP_TO_EDGE,s.addressV=pc.ADDRESS_CLAMP_TO_EDGE,s.name="pe-bloom-"+t;var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:s,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var r=this.device.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(this.targets[0],this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),this.drawQuad(this.targets[1],this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),this.drawQuad(this.targets[0],this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(t,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this.effect._destroy()}))};var BillboardRotateZ=pc.createScript("billboardRotateZ");BillboardRotateZ.attributes.add("rotationSpeed",{type:"number",default:30,title:"Rotation Speed (deg/s)"}),BillboardRotateZ.prototype.initialize=function(){this.cameraEntity=this.app.root.findByName("Camera"),this.angle=0},BillboardRotateZ.prototype.update=function(t){if(this.cameraEntity){this.entity.lookAt(this.cameraEntity.getPosition()),this.angle+=this.rotationSpeed*t;var e=new pc.Quat;e.setFromAxisAngle(pc.Vec3.FORWARD,this.angle),this.entity.setRotation(this.entity.getRotation().mul(e))}};var LaserShaderFinal=pc.createScript("laserShaderFinal");LaserShaderFinal.attributes.add("coreColor",{type:"rgb",default:[.2,.8,1]}),LaserShaderFinal.attributes.add("haloColor",{type:"rgb",default:[.2,.8,1]}),LaserShaderFinal.attributes.add("intensity",{type:"number",default:4,min:0,max:20}),LaserShaderFinal.attributes.add("stripeCount",{type:"number",default:8,min:1,max:32}),LaserShaderFinal.attributes.add("speed",{type:"number",default:1,min:0,max:10}),LaserShaderFinal.attributes.add("textureWidth",{type:"number",default:64}),LaserShaderFinal.attributes.add("textureHeight",{type:"number",default:32}),LaserShaderFinal.attributes.add("updateInterval",{type:"number",default:1,min:1}),LaserShaderFinal.attributes.add("useSharedTexture",{type:"boolean",default:!0}),LaserShaderFinal.attributes.add("lightEntity",{type:"entity",title:"Optional Light"}),LaserShaderFinal._shared=LaserShaderFinal._shared||{key:null,texture:null},LaserShaderFinal.prototype.initialize=function(){function colorToArray(t){return t?"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b?[t.r,t.g,t.b]:[void 0!==t[0]?t[0]:1,void 0!==t[1]?t[1]:1,void 0!==t[2]?t[2]:1]:[1,1,1]}this._frameCounter=0,this._time=0,this._coreArr=colorToArray(this.coreColor),this._haloArr=colorToArray(this.haloColor),this._tw=Math.max(16,Math.round(this.textureWidth)),this._th=Math.max(8,Math.round(this.textureHeight));var t=["laser","w"+this._tw,"h"+this._th,"s"+Math.round(this.stripeCount),"c"+Math.round(255*this._coreArr[0])+"-"+Math.round(255*this._coreArr[1])+"-"+Math.round(255*this._coreArr[2])].join("_");this.useSharedTexture&&LaserShaderFinal._shared.key===t&&LaserShaderFinal._shared.texture?(this._texture=LaserShaderFinal._shared.texture,console.log("[Laser] reused shared texture",t)):(this._texture=this._createTexture(this._tw,this._th,this._coreArr,this.stripeCount),this.useSharedTexture?(LaserShaderFinal._shared.key=t,LaserShaderFinal._shared.texture=this._texture,console.log("[Laser] created & cached shared texture",t)):console.log("[Laser] created per-instance texture"));var e=new pc.StandardMaterial;e.useLighting=!1,e.emissive=new pc.Color(this._coreArr[0]*this.intensity,this._coreArr[1]*this.intensity,this._coreArr[2]*this.intensity),e.emissiveIntensity=1,e.emissiveMap=this._texture,e.emissiveMapChannel="rgb",e.opacityMap=this._texture,e.opacityMapChannel="a",e.opacity=.5,e.blendType=pc.BLEND_ADDITIVE,e.depthWrite=!1,e.cull=pc.CULLFACE_BACK;var a=this.entity.getLocalScale(),r=Math.max(.001,Math.abs(a.y));e.emissiveMapTiling=new pc.Vec2(1,r),e.emissiveMapOffset=new pc.Vec2(0,0),e.update(),this._material=e,this._assignMaterial()},LaserShaderFinal.prototype._createTexture=function(t,e,a,r){var i=this.app,s=document.createElement("canvas");s.width=t,s.height=e;var n=s.getContext("2d"),h=n.createImageData(t,e);function clampByte(t){return Math.max(0,Math.min(255,Math.round(t)))}function smoothstep(t,e,a){var r=Math.max(0,Math.min(1,(a-t)/(e-t)));return r*r*(3-2*r)}for(var l=a,o=Math.max(1,r),d=0;d<t;d++)for(var u=d/(t-1),m=1-smoothstep(0,1,Math.abs(u-.5)/.5),c=0;c<e;c++){var p=c/(e-1),y=.5+.5*Math.sin(p*o*Math.PI*2),_=m*(.25+.75*(y=Math.max(.15,1.2*y))),f=clampByte(l[0]*_*255),M=clampByte(l[1]*_*255),g=clampByte(l[2]*_*255),L=clampByte(255*Math.max(_,.12)),v=4*(c*t+d);h.data[v+0]=f,h.data[v+1]=M,h.data[v+2]=g,h.data[v+3]=L}n.putImageData(h,0,0);var x=new pc.Texture(i.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0});return x.setSource(s),x.minFilter=pc.FILTER_LINEAR_MIPMAP_LINEAR,x.magFilter=pc.FILTER_LINEAR,x.addressU=pc.ADDRESS_REPEAT,x.addressV=pc.ADDRESS_REPEAT,x},LaserShaderFinal.prototype._assignMaterial=function(){var t=!1;if(this.entity.model&&this.entity.model.meshInstances&&this.entity.model.meshInstances.length>0){for(var e=this.entity.model.meshInstances,a=0;a<e.length;a++)e[a].material=this._material;t=!0}else if(this.entity.render&&this.entity.render.meshInstances&&this.entity.render.meshInstances.length>0){for(var r=this.entity.render.meshInstances,i=0;i<r.length;i++)r[i].material=this._material;t=!0}if(t)return this._material.update(),void console.log("[Laser] material assigned to entity:",this.entity.name);var s=this,n=0;!function retry(){if(n++,s.entity.model&&s.entity.model.meshInstances&&s.entity.model.meshInstances.length>0){for(var t=s.entity.model.meshInstances,e=0;e<t.length;e++)t[e].material=s._material;return s._material.update(),void console.log("[Laser] material assigned (deferred) to entity:",s.entity.name)}n<60?setTimeout(retry,50):console.warn("[Laser] could not assign material to entity after retries:",s.entity.name)}()},LaserShaderFinal.prototype.update=function(t){if(this._time+=t,this._frameCounter++,this._material&&!(this._frameCounter<(this.updateInterval||1))){this._frameCounter=0;var e=this._material.emissiveMapOffset?this._material.emissiveMapOffset.clone():new pc.Vec2(0,0);e.y=-this._time*this.speed*(.35*this.stripeCount)%1,this._material.emissiveMapOffset=e;var a=this.entity.getLocalScale(),r=Math.max(.001,Math.abs(a.y));if(this._material.emissiveMapTiling=new pc.Vec2(1,r),this._material.update(),this.lightEntity&&this.lightEntity.light){var i=this._time*this.speed*10,s=.4+.3*Math.abs(Math.sin(3.1*i+.13))+.2*Math.abs(Math.sin(5.7*i+1.47))+.1*Math.abs(Math.sin(7.3*i+2.21));this.lightEntity.light.intensity=s*this.intensity}}};